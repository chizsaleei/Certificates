<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learning Dashboard | CHIZSA COACHING</title>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #1a3d2e 0%, #0f2419 100%);
      color: #f4f1e8;
      line-height: 1.6;
      min-height: 100vh;
    }

    * {
      box-sizing: border-box;
    }

    /* Header Styles */
    .settings-header {
      background: rgba(26, 61, 46, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 70px;
    }

    .brand {
      font-size: 1.5rem;
      font-weight: bold;
      color: #d4af37;
      text-decoration: none;
      letter-spacing: 1px;
    }

    .nav-links {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .nav-link {
      color: #c9d1d9;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .nav-link:hover {
      color: #d4af37;
    }

    .back-btn {
      padding: 8px 16px;
      border: 1px solid #d4af37;
      border-radius: 6px;
      background: transparent;
      color: #d4af37;
      text-decoration: none;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: #d4af37;
      color: #1a3d2e;
    }

    /* Main Container */
    .settings-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .settings-title {
      color: #d4af37;
      font-size: 2.5rem;
      margin: 0 0 15px;
      font-weight: 300;
      letter-spacing: 1px;
      text-align: center;
    }

    .settings-subtitle {
      color: #c9d1d9;
      font-size: 1.2rem;
      text-align: center;
      margin: 0 0 40px;
      font-weight: 300;
    }

    /* Settings Cards */
    .settings-grid {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .settings-card {
      background: rgba(26, 61, 46, 0.6);
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 12px;
      padding: 30px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .settings-card:hover {
      border-color: rgba(212, 175, 55, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(212, 175, 55, 0.3);
    }

    .card-icon {
      font-size: 2rem;
      color: #d4af37;
    }

    .card-title {
      color: #d4af37;
      font-size: 1.6rem;
      margin: 0;
      font-weight: 600;
    }

    .card-description {
      color: #c9d1d9;
      font-size: 1rem;
      margin: 0 0 25px;
      line-height: 1.5;
    }

    /* Quick Actions Grid */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .quick-action {
      background: rgba(15, 36, 25, 0.6);
      border: 2px solid rgba(212, 175, 55, 0.2);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      color: inherit;
    }

    .quick-action:hover {
      border-color: rgba(212, 175, 55, 0.5);
      transform: translateY(-2px);
      text-decoration: none;
      color: inherit;
    }

    .quick-action-icon {
      font-size: 2.5rem;
      color: #d4af37;
      margin-bottom: 15px;
      display: block;
    }

    .quick-action-title {
      color: #f4f1e8;
      font-weight: 600;
      margin: 0 0 8px;
      font-size: 1.1rem;
    }

    .quick-action-description {
      color: #c9d1d9;
      font-size: 0.9rem;
      margin: 0;
    }

    /* Toolkit Grid */
    .toolkit-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .toolkit-item {
      background: rgba(15, 36, 25, 0.6);
      border: 2px solid rgba(212, 175, 55, 0.2);
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
    }

    .toolkit-item:hover {
      border-color: rgba(212, 175, 55, 0.5);
      transform: translateY(-2px);
    }

    .toolkit-item.purchased {
      border-color: #3fa67a;
      background: rgba(63, 166, 122, 0.1);
    }

    .toolkit-item.locked {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .toolkit-status {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .toolkit-status.purchased {
      background: #3fa67a;
      color: white;
    }

    .toolkit-status.free {
      background: #d4af37;
      color: #1a3d2e;
    }

    .toolkit-icon {
      font-size: 2.5rem;
      margin-bottom: 15px;
      display: block;
    }

    .toolkit-title {
      color: #f4f1e8;
      font-weight: 600;
      margin: 0 0 8px;
      font-size: 1.1rem;
    }

    .toolkit-description {
      color: #c9d1d9;
      font-size: 0.9rem;
      margin: 0 0 15px;
      line-height: 1.4;
    }

    .toolkit-price {
      color: #d4af37;
      font-weight: 600;
      font-size: 1rem;
    }

    /* Goal Selection */
    .goal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .goal-option {
      background: rgba(15, 36, 25, 0.6);
      border: 2px solid rgba(212, 175, 55, 0.2);
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .goal-option:hover {
      border-color: rgba(212, 175, 55, 0.5);
      transform: translateY(-2px);
    }

    .goal-option.selected {
      border-color: #d4af37;
      background: rgba(212, 175, 55, 0.1);
    }

    .goal-icon {
      font-size: 2.5rem;
      margin-bottom: 15px;
      display: block;
    }

    .goal-title {
      color: #f4f1e8;
      font-weight: 600;
      margin: 0 0 8px;
      font-size: 1.1rem;
    }

    .goal-description {
      color: #c9d1d9;
      font-size: 0.9rem;
      margin: 0;
      line-height: 1.4;
    }

    /* Level Selection */
    .level-selector {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .level-option {
      flex: 1;
      min-width: 120px;
      padding: 15px 20px;
      background: rgba(15, 36, 25, 0.6);
      border: 2px solid rgba(212, 175, 55, 0.2);
      border-radius: 8px;
      color: #c9d1d9;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .level-option:hover {
      border-color: rgba(212, 175, 55, 0.5);
    }

    .level-option.selected {
      border-color: #d4af37;
      background: rgba(212, 175, 55, 0.1);
      color: #d4af37;
    }

    /* Practice Schedule */
    .schedule-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .schedule-option {
      background: rgba(15, 36, 25, 0.6);
      border: 2px solid rgba(212, 175, 55, 0.2);
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .schedule-option:hover {
      border-color: rgba(212, 175, 55, 0.5);
    }

    .schedule-option.selected {
      border-color: #d4af37;
      background: rgba(212, 175, 55, 0.1);
    }

    .schedule-time {
      color: #d4af37;
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0 0 8px;
    }

    .schedule-label {
      color: #f4f1e8;
      font-weight: 600;
      margin: 0 0 5px;
      font-size: 1rem;
    }

    .schedule-description {
      color: #c9d1d9;
      font-size: 0.85rem;
      margin: 0;
    }

    /* Progress Display */
    .progress-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .stat-item {
      background: rgba(15, 36, 25, 0.6);
      border: 1px solid rgba(212, 175, 55, 0.1);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      color: #d4af37;
      font-size: 2rem;
      font-weight: 600;
      margin: 0 0 8px;
    }

    .stat-label {
      color: #c9d1d9;
      font-size: 0.9rem;
      margin: 0;
    }

    /* Session Management */
    .session-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .session-card {
      background: rgba(15, 36, 25, 0.6);
      border: 1px solid rgba(212, 175, 55, 0.1);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .session-card:hover {
      border-color: rgba(212, 175, 55, 0.3);
      transform: translateY(-2px);
    }

    .session-icon {
      font-size: 2rem;
      color: #d4af37;
      margin-bottom: 15px;
    }

    .session-title {
      color: #f4f1e8;
      font-weight: 600;
      margin: 0 0 8px;
      font-size: 1rem;
    }

    .session-description {
      color: #c9d1d9;
      font-size: 0.85rem;
      margin: 0 0 15px;
    }

    /* Simple Toggle */
    .simple-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: rgba(15, 36, 25, 0.6);
      border: 1px solid rgba(212, 175, 55, 0.1);
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .toggle-info {
      flex: 1;
    }

    .toggle-title {
      color: #f4f1e8;
      font-weight: 600;
      margin: 0 0 5px;
      font-size: 1rem;
    }

    .toggle-description {
      color: #c9d1d9;
      font-size: 0.9rem;
      margin: 0;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(191, 138, 44, 0.3);
      transition: 0.3s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: #c9d1d9;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: #d4af37;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
      background-color: #1a3d2e;
    }

    /* Button Styles */
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #d4af37, #e6c55a);
      color: #1a3d2e;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
    }

    .btn-secondary {
      background: transparent;
      color: #d4af37;
      border: 1px solid #d4af37;
    }

    .btn-secondary:hover {
      background: #d4af37;
      color: #1a3d2e;
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    /* Calendly Widget */
    .calendly-widget {
      min-height: 500px;
      border-radius: 8px;
      overflow: hidden;
    }

    /* File Upload Area */
    .upload-area {
      border: 2px dashed rgba(212, 175, 55, 0.3);
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .upload-area:hover {
      border-color: rgba(212, 175, 55, 0.5);
      background: rgba(212, 175, 55, 0.05);
    }

    .upload-area.dragover {
      border-color: #d4af37;
      background: rgba(212, 175, 55, 0.1);
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(26, 61, 46, 0.95);
      border: 1px solid rgba(212, 175, 55, 0.5);
      border-radius: 8px;
      padding: 15px 20px;
      color: #f4f1e8;
      z-index: 10000;
      backdrop-filter: blur(10px);
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      border-color: #3fa67a;
    }

    .notification.error {
      border-color: #e74c3c;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: rgba(26, 61, 46, 0.95);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    }

    .modal-title {
      color: #d4af37;
      font-size: 1.5rem;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      color: #c9d1d9;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      color: #d4af37;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        height: auto;
        padding: 15px 20px;
        gap: 15px;
      }

      .nav-links {
        flex-direction: column;
        gap: 15px;
      }

      .settings-title {
        font-size: 2rem;
      }

      .settings-container {
        padding: 20px 15px;
      }

      .settings-card {
        padding: 20px;
      }

      .goal-grid, .toolkit-grid, .quick-actions {
        grid-template-columns: 1fr;
      }

      .level-selector {
        flex-direction: column;
      }

      .level-option {
        min-width: auto;
      }

      .schedule-grid, .session-actions {
        grid-template-columns: 1fr;
      }

      .progress-stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .form-actions {
        flex-direction: column;
      }

      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      .progress-stats {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="settings-header">
    <div class="header-container">
      <a class="brand" href="/">CHIZSA | COACHING</a>
      <nav class="nav-links">
        <a href="/dashboard.html" class="nav-link">Dashboard</a>
        <a href="/practice.html" class="nav-link">Practice</a>
        <a href="/sessions.html" class="nav-link">Sessions</a>
        <a href="/media.html" class="nav-link">Media</a>
        <a href="/dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="settings-container">
    <h1 class="settings-title">Learning Dashboard</h1>
    <p class="settings-subtitle">Your complete English learning command center with integrated tools and services</p>

    <div class="settings-grid">
      <!-- Quick Actions -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">‚ö°</span>
          <h2 class="card-title">Quick Actions</h2>
        </div>
        <p class="card-description">Jump into your most common activities</p>
        
        <div class="quick-actions">
          <a href="#" class="quick-action" onclick="startPracticeSession()">
            <span class="quick-action-icon">üéØ</span>
            <h3 class="quick-action-title">Start Practice</h3>
            <p class="quick-action-description">Begin your daily practice session</p>
          </a>
          
          <a href="#" class="quick-action" onclick="bookSessionModal()">
            <span class="quick-action-icon">üìÖ</span>
            <h3 class="quick-action-title">Book Session</h3>
            <p class="quick-action-description">Schedule coaching with Calendly</p>
          </a>
          
          <a href="#" class="quick-action" onclick="joinVideoCall()">
            <span class="quick-action-icon">üìπ</span>
            <h3 class="quick-action-title">Join Call</h3>
            <p class="quick-action-description">Enter your video session</p>
          </a>
          
          <a href="#" class="quick-action" onclick="uploadMaterial()">
            <span class="quick-action-icon">üìÅ</span>
            <h3 class="quick-action-title">Upload Files</h3>
            <p class="quick-action-description">Add learning materials</p>
          </a>
        </div>
      </div>

      <!-- Available Toolkits -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">üß∞</span>
          <h2 class="card-title">Learning Toolkits</h2>
        </div>
        <p class="card-description">Access powerful tools to discover your learning style and focus areas</p>
        
        <div class="toolkit-grid">
          <div class="toolkit-item" data-toolkit="archetype" onclick="accessToolkit('archetype')">
            <div class="toolkit-status free">FREE</div>
            <span class="toolkit-icon">üé≠</span>
            <h3 class="toolkit-title">Find Your Archetype</h3>
            <p class="toolkit-description">Discover your unique learning personality and style preferences</p>
            <div class="toolkit-price">Free Tool</div>
          </div>
          
          <div class="toolkit-item" data-toolkit="profile" onclick="accessToolkit('profile')">
            <span class="toolkit-icon">üë§</span>
            <h3 class="toolkit-title">Choose Your Profile</h3>
            <p class="toolkit-description">Create a personalized learning profile based on your goals</p>
            <div class="toolkit-price">$12 One-Time</div>
          </div>
          
          <div class="toolkit-item" data-toolkit="focus" onclick="accessToolkit('focus')">
            <span class="toolkit-icon">üéØ</span>
            <h3 class="toolkit-title">Select Your Focus</h3>
            <p class="toolkit-description">Identify specific areas for targeted English improvement</p>
            <div class="toolkit-price">$12 One-Time</div>
          </div>
          

          
          <div class="toolkit-item" data-toolkit="tools-pass" onclick="accessToolkit('tools-pass')">
            <span class="toolkit-icon">üé´</span>
            <h3 class="toolkit-title">Tools Pass</h3>
            <p class="toolkit-description">Unlock all web tools with progress saving and smart suggestions</p>
            <div class="toolkit-price">$10/month</div>
          </div>
        </div>
      </div>

      <!-- Session Management -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">üìÖ</span>
          <h2 class="card-title">Session Management</h2>
        </div>
        <p class="card-description">Book coaching sessions and manage your learning schedule</p>
        
        <div class="session-actions">
          <div class="session-card" onclick="bookSession25()">
            <div class="session-icon">‚è±Ô∏è</div>
            <h3 class="session-title">25-Minute Session</h3>
            <p class="session-description">Quick focused coaching session</p>
            <div class="toolkit-price">$25</div>
            <button class="btn btn-primary btn-small">Book 25min</button>
          </div>
          
          <div class="session-card" onclick="bookSession50()">
            <div class="session-icon">‚è∞</div>
            <h3 class="session-title">50-Minute Session</h3>
            <p class="session-description">Comprehensive coaching session</p>
            <div class="toolkit-price">$45</div>
            <button class="btn btn-primary btn-small">Book 50min</button>
          </div>
          
          <div class="session-card" onclick="viewUpcoming()">
            <div class="session-icon">üìã</div>
            <h3 class="session-title">Upcoming Sessions</h3>
            <p class="session-description">View and manage scheduled sessions</p>
            <button class="btn btn-secondary btn-small">View All</button>
          </div>
          
          <div class="session-card" onclick="joinVideoCall()">
            <div class="session-icon">üìπ</div>
            <h3 class="session-title">Join Video Call</h3>
            <p class="session-description">Daily.co & VooV integration</p>
            <button class="btn btn-secondary btn-small">Join Call</button>
          </div>
          
          <div class="session-card" onclick="viewHistory()">
            <div class="session-icon">üìö</div>
            <h3 class="session-title">Session History</h3>
            <p class="session-description">Review past sessions and notes</p>
            <button class="btn btn-secondary btn-small">View History</button>
          </div>
        </div>
      </div>

      <!-- Learning Goals -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">üéØ</span>
          <h2 class="card-title">Your Learning Goal</h2>
        </div>
        <p class="card-description">Choose your main focus area for English practice</p>
        
        <div class="goal-grid">
          <div class="goal-option" data-goal="medical">
            <span class="goal-icon">üè•</span>
            <h3 class="goal-title">Medical English</h3>
            <p class="goal-description">Healthcare terminology, patient communication, medical procedures</p>
          </div>
          
          <div class="goal-option" data-goal="business">
            <span class="goal-icon">üíº</span>
            <h3 class="goal-title">Business English</h3>
            <p class="goal-description">Professional communication, presentations, meetings, emails</p>
          </div>
          
          <div class="goal-option" data-goal="general">
            <span class="goal-icon">üåü</span>
            <h3 class="goal-title">General English</h3>
            <p class="goal-description">Everyday conversation, grammar, vocabulary building</p>
          </div>
        </div>
      </div>

      <!-- Current Level -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">üìä</span>
          <h2 class="card-title">Your Current Level</h2>
        </div>
        <p class="card-description">Select your current English proficiency level</p>
        
        <div class="level-selector">
          <div class="level-option" data-level="beginner">
            <div>Beginner</div>
            <small>A1-A2</small>
          </div>
          <div class="level-option" data-level="intermediate">
            <div>Intermediate</div>
            <small>B1-B2</small>
          </div>
          <div class="level-option" data-level="advanced">
            <div>Advanced</div>
            <small>C1-C2</small>
          </div>
        </div>
      </div>

      <!-- Practice Schedule -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">‚è∞</span>
          <h2 class="card-title">Practice Schedule</h2>
        </div>
        <p class="card-description">How much time can you practice each day?</p>
        
        <div class="schedule-grid">
          <div class="schedule-option" data-schedule="15">
            <div class="schedule-time">15 min</div>
            <div class="schedule-label">Quick Practice</div>
            <div class="schedule-description">Perfect for busy days</div>
          </div>
          
          <div class="schedule-option" data-schedule="30">
            <div class="schedule-time">30 min</div>
            <div class="schedule-label">Regular Practice</div>
            <div class="schedule-description">Recommended daily practice</div>
          </div>
          
          <div class="schedule-option" data-schedule="60">
            <div class="schedule-time">60 min</div>
            <div class="schedule-label">Intensive Practice</div>
            <div class="schedule-description">For faster progress</div>
          </div>
        </div>
      </div>

      <!-- Progress Tracking -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">üìà</span>
          <h2 class="card-title">Your Progress</h2>
        </div>
        <p class="card-description">Track your learning journey and achievements</p>
        
        <div class="progress-stats">
          <div class="stat-item">
            <div class="stat-value" id="days-practiced">0</div>
            <div class="stat-label">Days Practiced</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value" id="total-minutes">0</div>
            <div class="stat-label">Total Minutes</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value" id="current-streak">0</div>
            <div class="stat-label">Current Streak</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value" id="tools-completed">0</div>
            <div class="stat-label">Tools Completed</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value" id="files-uploaded">0</div>
            <div class="stat-label">Files Uploaded</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value" id="sessions-completed">0</div>
            <div class="stat-label">Sessions Done</div>
          </div>
        </div>
      </div>

      <!-- File Management -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">üìÅ</span>
          <h2 class="card-title">Learning Materials</h2>
        </div>
        <p class="card-description">Upload and manage your learning files with Supabase Storage</p>
        
        <div class="upload-area" onclick="triggerFileUpload()" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)">
          <span class="quick-action-icon">‚òÅÔ∏è</span>
          <h3>Upload Learning Materials</h3>
          <p>Drag & drop files here or click to browse</p>
          <p><small>Supports: PDF, DOC, MP3, MP4, Images</small></p>
        </div>
        
        <input type="file" id="file-upload" multiple accept=".pdf,.doc,.docx,.mp3,.mp4,.jpg,.jpeg,.png" style="display: none;">
      </div>

      <!-- Simple Preferences -->
      <div class="settings-card">
        <div class="card-header">
          <span class="card-icon">‚öôÔ∏è</span>
          <h2 class="card-title">Practice Preferences</h2>
        </div>
        <p class="card-description">Simple settings to improve your practice experience</p>
        
        <div class="simple-toggle">
          <div class="toggle-info">
            <h3 class="toggle-title">Daily Reminders</h3>
            <p class="toggle-description">Get a gentle reminder to practice each day</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="daily-reminders" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="simple-toggle">
          <div class="toggle-info">
            <h3 class="toggle-title">Progress Tracking</h3>
            <p class="toggle-description">Save your practice data and track improvement</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="progress-tracking" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="simple-toggle">
          <div class="toggle-info">
            <h3 class="toggle-title">Audio Pronunciation</h3>
            <p class="toggle-description">Enable audio for pronunciation practice</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="audio-pronunciation" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="simple-toggle">
          <div class="toggle-info">
            <h3 class="toggle-title">Video Call Notifications</h3>
            <p class="toggle-description">Get notified before scheduled video sessions</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="video-notifications" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <!-- Save Settings -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetSettings()">Reset to Default</button>
        <button type="button" class="btn btn-primary" onclick="saveSettings()">
          üíæ Save My Settings
        </button>
      </div>
    </div>
  </main>

  <!-- Calendly Booking Modal -->
  <div id="calendly-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Book Your Session</h3>
        <button class="modal-close" onclick="closeModal('calendly-modal')">&times;</button>
      </div>
      <div class="calendly-widget" id="calendly-widget"></div>
    </div>
  </div>

  <!-- Video Call Modal -->
  <div id="video-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Join Video Session</h3>
        <button class="modal-close" onclick="closeModal('video-modal')">&times;</button>
      </div>
      <div id="video-container"></div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div id="payment-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Pay What You Want</h3>
        <button class="modal-close" onclick="closeModal('payment-modal')">&times;</button>
      </div>
      <div id="payment-form"></div>
    </div>
  </div>

  <!-- External Libraries -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="https://assets.calendly.com/assets/external/widget.js"></script>
  <script src="https://unpkg.com/@daily-co/daily-js"></script>

  <!-- Core System -->
  <script src="/js/supabaseClient.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/gate.js"></script>
  <script src="/js/database.js"></script>
  <script src="/js/notifications.js"></script>
  <script src="/js/validation.js"></script>

  <!-- Commerce & Payments -->
  <script src="/js/stripe.js"></script>
  <script src="/js/payWhatYouWant.js"></script>
  <script src="/js/checkout.js"></script>
  <script src="/js/commerce.js"></script>
  <script src="/js/payments.js"></script>

  <!-- Scheduling & Video -->
  <script src="/js/calendly.js"></script>
  <script src="/js/daily.js"></script>
  <script src="/js/voov.js"></script>
  <script src="/js/videoCall.js"></script>
  <script src="/js/sessions.js"></script>
  <script src="/js/scheduler.js"></script>
  <script src="/js/calendar.js"></script>

  <!-- Storage & Media -->
  <script src="/js/supabaseStorage.js"></script>
  <script src="/js/fileUpload.js"></script>
  <script src="/js/mediaManager.js"></script>
  <script src="/js/storage.js"></script>

  <!-- Learning Platform -->
  <script src="/js/toolkits.js"></script>
  <script src="/js/practiceTools.js"></script>
  <script src="/js/progress.js"></script>
  <script src="/js/analytics.js"></script>
  <script src="/js/settings.js"></script>

  <!-- UI & Experience -->
  <script src="/js/dashboard.js"></script>
  <script src="/js/ui.js"></script>
  <script src="/js/navigation.js"></script>
  <script src="/js/modals.js"></script>

  <script>
    // Initialize comprehensive learning dashboard
    (async function() {
      // No authentication required for free access
      await initializeIntegrations();
      setupEventListeners();
      
      // Try to load user data if signed in
      try {
        const user = await Auth.getUser();
        if (user) {
          await loadUserSettings();
          await loadProgressStats();
          await loadUserToolkits();
        }
      } catch (error) {
        console.log('User not signed in - showing free access');
      }
    })();

    let currentSettings = {
      goal: 'general',
      level: 'intermediate',
      schedule: 30,
      dailyReminders: true,
      progressTracking: true,
      audioPronunciation: true,
      videoNotifications: true
    };

    async function initializeIntegrations() {
      try {
        // Initialize Stripe
        if (typeof Stripe !== 'undefined') {
          window.stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
        }

        // Initialize Daily.co
        if (typeof DailyIframe !== 'undefined') {
          window.dailyCall = DailyIframe.createCallObject();
        }

        // Initialize file upload
        setupFileUpload();

      } catch (error) {
        console.log('Some integrations not available:', error);
      }
    }

    function setupEventListeners() {
      // Goal selection
      document.querySelectorAll('.goal-option').forEach(option => {
        option.addEventListener('click', () => {
          document.querySelectorAll('.goal-option').forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          currentSettings.goal = option.dataset.goal;
        });
      });

      // Level selection
      document.querySelectorAll('.level-option').forEach(option => {
        option.addEventListener('click', () => {
          document.querySelectorAll('.level-option').forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          currentSettings.level = option.dataset.level;
        });
      });

      // Schedule selection
      document.querySelectorAll('.schedule-option').forEach(option => {
        option.addEventListener('click', () => {
          document.querySelectorAll('.schedule-option').forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          currentSettings.schedule = parseInt(option.dataset.schedule);
        });
      });

      // Toggle switches
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const setting = e.target.id.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
          currentSettings[setting] = e.target.checked;
        });
      });

      // File upload
      document.getElementById('file-upload').addEventListener('change', handleFileSelect);
    }

    // Quick Action Functions
    function startPracticeSession() {
      window.location.href = '/practice.html';
    }

    function bookSessionModal() {
      showModal('calendly-modal');
      initializeCalendly();
    }

    function joinVideoCall() {
      showModal('video-modal');
      initializeVideoCall();
    }

    function uploadMaterial() {
      document.getElementById('file-upload').click();
    }

    // Toolkit Functions
    async function accessToolkit(toolkitId) {
      if (toolkitId === 'archetype') {
        // Free tool - no sign in required
        window.location.href = `/toolkits/archetype.html`;
        return;
      }
      
      if (toolkitId === 'tools-pass') {
        // Show Tools Pass payment modal
        showModal('payment-modal');
        initializePayment('tools-pass', 'tools-pass', 10);
        return;
      }
      
      // Single tools - $12 each
      showModal('payment-modal');
      initializePayment('tool', toolkitId, 12);
    }

    // Session Functions
    function bookSession25() {
      showModal('payment-modal');
      initializePayment('session', '25', 25);
    }

    function bookSession50() {
      showModal('payment-modal');
      initializePayment('session', '50', 45);
    }

    // Session Functions
    function viewUpcoming() {
      window.location.href = '/sessions/upcoming.html';
    }

    function viewHistory() {
      window.location.href = '/sessions/history.html';
    }

    // Calendly Integration
    function initializeCalendly() {
      if (typeof Calendly !== 'undefined') {
        Calendly.initInlineWidget({
          url: 'https://calendly.com/your-calendly-link',
          parentElement: document.getElementById('calendly-widget'),
          prefill: {},
          utm: {}
        });
      }
    }

    // Video Call Integration
    function initializeVideoCall() {
      const container = document.getElementById('video-container');
      container.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <h3>Choose Your Video Platform</h3>
          <button class="btn btn-primary" onclick="joinDaily()" style="margin: 10px;">Join Daily.co</button>
          <button class="btn btn-secondary" onclick="joinVooV()" style="margin: 10px;">Join VooV</button>
        </div>
      `;
    }

    function joinDaily() {
      if (window.dailyCall) {
        window.dailyCall.join({ url: 'https://your-domain.daily.co/room-name' });
      }
    }

    function joinVooV() {
      // VooV integration
      window.open('https://voovmeeting.com/your-meeting-link', '_blank');
    }

    // Payment Integration
    function initializePayment(itemType, itemId, price) {
      const paymentForm = document.getElementById('payment-form');
      
      if (itemType === 'tools-pass') {
        paymentForm.innerHTML = `
          <div style="text-align: center;">
            <h4>Tools Pass - $10/month</h4>
            <p>Unlock all web tools with progress saving</p>
            <div style="margin: 20px 0;">
              <button class="btn btn-primary" onclick="processStripePayment('tools-pass', 10, 'subscription')" style="margin: 10px;">üí≥ Pay with Card</button>
              <button class="btn btn-secondary" onclick="processWeChatPay('tools-pass', 10)" style="margin: 10px;">üí¨ WeChat Pay</button>
            </div>
          </div>
        `;
      } else if (itemType === 'session') {
        paymentForm.innerHTML = `
          <div style="text-align: center;">
            <h4>${itemId === '25' ? '25-Minute' : '50-Minute'} Session - $${price}</h4>
            <p>1:1 English coaching session</p>
            <div style="margin: 20px 0;">
              <button class="btn btn-primary" onclick="processStripePayment('session-${itemId}', ${price}, 'payment')" style="margin: 10px;">üí≥ Pay with Card</button>
              <button class="btn btn-secondary" onclick="processAlipay('session-${itemId}', ${price})" style="margin: 10px;">üí∞ Alipay</button>
              <button class="btn btn-secondary" onclick="processWeChatPay('session-${itemId}', ${price})" style="margin: 10px;">üí¨ WeChat Pay</button>
            </div>
          </div>
        `;
      } else {
        // Single tool
        paymentForm.innerHTML = `
          <div style="text-align: center;">
            <h4>Single Tool - $12</h4>
            <p>Lifetime access to this tool</p>
            <div style="margin: 20px 0;">
              <button class="btn btn-primary" onclick="processStripePayment('${itemId}', 12, 'payment')" style="margin: 10px;">üí≥ Pay with Card</button>
              <button class="btn btn-secondary" onclick="processAlipay('${itemId}', 12)" style="margin: 10px;">üí∞ Alipay</button>
              <button class="btn btn-secondary" onclick="processWeChatPay('${itemId}', 12)" style="margin: 10px;">üí¨ WeChat Pay</button>
            </div>
          </div>
        `;
      }
    }

    // Payment Processing Functions
    async function processStripePayment(itemId, amount, mode) {
      try {
        if (!window.stripe) {
          showNotification('Payment system loading...', 'info');
          return;
        }

        const { error } = await stripe.redirectToCheckout({
          lineItems: [{
            price_data: {
              currency: 'usd',
              product_data: {
                name: getProductName(itemId),
              },
              unit_amount: amount * 100,
              recurring: mode === 'subscription' ? { interval: 'month' } : undefined,
            },
            quantity: 1,
          }],
          mode: mode,
          successUrl: `${window.location.origin}/success.html?item=${itemId}`,
          cancelUrl: window.location.href,
        });

        if (error) {
          showNotification('Payment failed. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Stripe payment error:', error);
        showNotification('Payment system unavailable', 'error');
      }
    }

    function processAlipay(itemId, amount) {
      showNotification('Redirecting to Alipay...', 'info');
      // Integrate with Alipay API
      window.open(`https://your-alipay-gateway.com/pay?item=${itemId}&amount=${amount}`, '_blank');
    }

    function processWeChatPay(itemId, amount) {
      showNotification('Redirecting to WeChat Pay...', 'info');
      // Integrate with WeChat Pay API
      window.open(`https://your-wechat-gateway.com/pay?item=${itemId}&amount=${amount}`, '_blank');
    }

    function getProductName(itemId) {
      const names = {
        'archetype': 'Find Your Archetype Tool',
        'profile': 'Choose Your Profile Tool',
        'focus': 'Select Your Focus Tool',
        'tools-pass': 'Tools Pass Monthly Subscription',
        'session-25': '25-Minute Coaching Session',
        'session-50': '50-Minute Coaching Session'
      };
      return names[itemId] || 'Learning Tool';
    }

    // File Upload Functions
    function setupFileUpload() {
      const uploadArea = document.querySelector('.upload-area');
      
      uploadArea.addEventListener('dragover', handleDragOver);
      uploadArea.addEventListener('drop', handleFileDrop);
      uploadArea.addEventListener('dragleave', handleDragLeave);
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('dragover');
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('dragover');
    }

    function handleFileDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('dragover');
      
      const files = e.dataTransfer.files;
      uploadFiles(files);
    }

    function triggerFileUpload() {
      document.getElementById('file-upload').click();
    }

    function handleFileSelect(e) {
      const files = e.target.files;
      uploadFiles(files);
    }

    async function uploadFiles(files) {
      const user = await Auth.getUser();
      if (!user) return;

      for (let file of files) {
        try {
          showNotification(`Uploading ${file.name}...`, 'info');
          
          // Upload to Supabase Storage
          const { data, error } = await supabase.storage
            .from('learning-materials')
            .upload(`${user.id}/${Date.now()}-${file.name}`, file);

          if (error) throw error;

          // Save file record to database
          await supabase
            .from('user_files')
            .insert({
              user_id: user.id,
              filename: file.name,
              file_path: data.path,
              file_size: file.size,
              file_type: file.type
            });

          showNotification(`${file.name} uploaded successfully!`, 'success');
          
          // Update stats
          updateFileStats();
          
        } catch (error) {
          console.error('Upload error:', error);
          showNotification(`Failed to upload ${file.name}`, 'error');
        }
      }
    }

    async function updateFileStats() {
      const user = await Auth.getUser();
      if (!user) return;

      const { count } = await supabase
        .from('user_files')
        .select('*', { count: 'exact', head: true })
        .eq('user_id', user.id);

      document.getElementById('files-uploaded').textContent = count || 0;
    }

    // Modal Functions
    function showModal(modalId) {
      document.getElementById(modalId).classList.add('show');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('show');
    }

    // Settings Functions
    async function loadUserSettings() {
      try {
        const user = await Auth.getUser();
        if (!user) return;

        const { data: settings } = await supabase
          .from('user_practice_settings')
          .select('*')
          .eq('user_id', user.id)
          .single();

        if (settings) {
          currentSettings = { ...currentSettings, ...settings.settings };
        }

        applySettingsToUI();

      } catch (error) {
        console.log('No existing settings found, using defaults');
        applySettingsToUI();
      }
    }

    async function loadUserToolkits() {
      try {
        const user = await Auth.getUser();
        if (!user) return;

        const { data: purchases } = await supabase
          .from('user_purchases')
          .select('toolkit_id')
          .eq('user_id', user.id);

        const purchasedToolkits = purchases ? purchases.map(p => p.toolkit_id) : [];

        document.querySelectorAll('.toolkit-item').forEach(item => {
          const toolkitId = item.dataset.toolkit;
          if (purchasedToolkits.includes(toolkitId)) {
            item.classList.add('purchased');
            const status = item.querySelector('.toolkit-status');
            if (status) {
              status.textContent = 'OWNED';
              status.className = 'toolkit-status purchased';
            }
            const price = item.querySelector('.toolkit-price');
            if (price) {
              price.textContent = 'Purchased';
            }
          }
        });

      } catch (error) {
        console.log('Error loading user toolkits:', error);
      }
    }

    function applySettingsToUI() {
      // Apply goal selection
      document.querySelectorAll('.goal-option').forEach(option => {
        if (option.dataset.goal === currentSettings.goal) {
          option.classList.add('selected');
        }
      });

      // Apply level selection
      document.querySelectorAll('.level-option').forEach(option => {
        if (option.dataset.level === currentSettings.level) {
          option.classList.add('selected');
        }
      });

      // Apply schedule selection
      document.querySelectorAll('.schedule-option').forEach(option => {
        if (parseInt(option.dataset.schedule) === currentSettings.schedule) {
          option.classList.add('selected');
        }
      });

      // Apply toggle switches
      document.getElementById('daily-reminders').checked = currentSettings.dailyReminders;
      document.getElementById('progress-tracking').checked = currentSettings.progressTracking;
      document.getElementById('audio-pronunciation').checked = currentSettings.audioPronunciation;
      document.getElementById('video-notifications').checked = currentSettings.videoNotifications;
    }

    async function loadProgressStats() {
      try {
        const user = await Auth.getUser();
        if (!user) return;

        const { data: stats } = await supabase
          .from('user_practice_stats')
          .select('*')
          .eq('user_id', user.id)
          .single();

        if (stats) {
          document.getElementById('days-practiced').textContent = stats.days_practiced || 0;
          document.getElementById('total-minutes').textContent = stats.total_minutes || 0;
          document.getElementById('current-streak').textContent = stats.current_streak || 0;
          document.getElementById('tools-completed').textContent = stats.tools_completed || 0;
          document.getElementById('sessions-completed').textContent = stats.sessions_completed || 0;
        }

        // Load file count
        await updateFileStats();

      } catch (error) {
        console.log('No practice stats found yet');
      }
    }

    async function saveSettings() {
      try {
        const user = await Auth.getUser();
        if (!user) return;

        await createPracticeTablesIfNeeded();

        const { error } = await supabase
          .from('user_practice_settings')
          .upsert({
            user_id: user.id,
            settings: currentSettings,
            updated_at: new Date().toISOString()
          });

        if (error) throw error;

        await supabase
          .from('user_activities')
          .insert({
            user_id: user.id,
            activity_type: 'settings_updated',
            description: `Updated practice settings: ${currentSettings.goal} English, ${currentSettings.level} level, ${currentSettings.schedule} min/day`
          });

        showNotification('Settings saved successfully! üéâ', 'success');

        setTimeout(() => {
          window.location.href = '/practice.html';
        }, 2000);

      } catch (error) {
        console.error('Error saving settings:', error);
        showNotification('Failed to save settings. Please try again.', 'error');
      }
    }

    async function createPracticeTablesIfNeeded() {
      try {
        await supabase.rpc('exec_sql', {
          sql: `
            CREATE TABLE IF NOT EXISTS user_practice_settings (
              id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
              user_id UUID REFERENCES auth.users(id) NOT NULL,
              settings JSONB NOT NULL,
              created_at TIMESTAMPTZ DEFAULT NOW(),
              updated_at TIMESTAMPTZ DEFAULT NOW(),
              UNIQUE(user_id)
            );

            CREATE TABLE IF NOT EXISTS user_practice_stats (
              id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
              user_id UUID REFERENCES auth.users(id) NOT NULL,
              days_practiced INTEGER DEFAULT 0,
              total_minutes INTEGER DEFAULT 0,
              current_streak INTEGER DEFAULT 0,
              tools_completed INTEGER DEFAULT 0,
              sessions_completed INTEGER DEFAULT 0,
              last_practice_date DATE,
              created_at TIMESTAMPTZ DEFAULT NOW(),
              updated_at TIMESTAMPTZ DEFAULT NOW(),
              UNIQUE(user_id)
            );

            CREATE TABLE IF NOT EXISTS user_purchases (
              id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
              user_id UUID REFERENCES auth.users(id) NOT NULL,
              toolkit_id TEXT NOT NULL,
              purchase_date TIMESTAMPTZ DEFAULT NOW(),
              amount DECIMAL(10,2),
              status TEXT DEFAULT 'completed'
            );

            CREATE TABLE IF NOT EXISTS user_files (
              id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
              user_id UUID REFERENCES auth.users(id) NOT NULL,
              filename TEXT NOT NULL,
              file_path TEXT NOT NULL,
              file_size BIGINT,
              file_type TEXT,
              uploaded_at TIMESTAMPTZ DEFAULT NOW()
            );

            -- Enable RLS
            ALTER TABLE user_practice_settings ENABLE ROW LEVEL SECURITY;
            ALTER TABLE user_practice_stats ENABLE ROW LEVEL SECURITY;
            ALTER TABLE user_purchases ENABLE ROW LEVEL SECURITY;
            ALTER TABLE user_files ENABLE ROW LEVEL SECURITY;

            -- Policies
            DROP POLICY IF EXISTS "user_practice_settings_own" ON user_practice_settings;
            CREATE POLICY "user_practice_settings_own" ON user_practice_settings
              FOR ALL USING (auth.uid() = user_id);

            DROP POLICY IF EXISTS "user_practice_stats_own" ON user_practice_stats;
            CREATE POLICY "user_practice_stats_own" ON user_practice_stats
              FOR ALL USING (auth.uid() = user_id);

            DROP POLICY IF EXISTS "user_purchases_own" ON user_purchases;
            CREATE POLICY "user_purchases_own" ON user_purchases
              FOR ALL USING (auth.uid() = user_id);

            DROP POLICY IF EXISTS "user_files_own" ON user_files;
            CREATE POLICY "user_files_own" ON user_files
              FOR ALL USING (auth.uid() = user_id);
          `
        });
      } catch (error) {
        console.log('Tables may already exist or RPC not available:', error);
      }
    }

    function resetSettings() {
      if (confirm('Are you sure you want to reset all settings to default?')) {
        currentSettings = {
          goal: 'general',
          level: 'intermediate',
          schedule: 30,
          dailyReminders: true,
          progressTracking: true,
          audioPronunciation: true,
          videoNotifications: true
        };
        
        applySettingsToUI();
        showNotification('Settings reset to default', 'success');
      }
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 4000);
    }

    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.classList.remove('show');
      }
    });
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98a4784e31dc0452',t:'MTc1OTc0NjQ4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

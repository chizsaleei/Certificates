<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CHIZSA | COACHING</title>
  <style>
    :root{
      --deep:#0f2419; --deep2:#1a3d2e;
      --gold:#d4af37; --gold2:#b8941f;
      --ink:#f4f1e8; --muted:#c9d1d9;
      --glass:rgba(26,61,46,.85);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Georgia, serif; color:var(--ink);
      background:linear-gradient(135deg,var(--deep2) 0%,var(--deep) 100%);
      line-height:1.6; min-height:100vh;
    }
    /* Header */
    .header{position:sticky;top:0;z-index:10;background:rgba(26,61,46,.95);border-bottom:1px solid rgba(212,175,55,.25);backdrop-filter:blur(10px)}
    .nav{max-width:1200px;margin:0 auto;padding:0 20px;height:70px;display:flex;align-items:center;justify-content:space-between}
    .logo{color:var(--gold);text-decoration:none;font-weight:700;letter-spacing:.5px}
    .menu{list-style:none;display:flex;gap:24px;margin:0;padding:0}
    .menu a{color:var(--ink);text-decoration:none;padding:8px 0;border-bottom:2px solid transparent;transition:.2s}
    .menu a:hover,.menu a.active{color:var(--gold);border-bottom-color:var(--gold)}
    .right{display:flex;gap:12px;align-items:center}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;text-decoration:none;font-weight:600;transition:.25s;cursor:pointer}
    .btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--deep)}
    .btn-gold:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(212,175,55,.28)}
    .btn-outline{border:2px solid var(--gold);color:var(--gold);background:transparent}
    .btn-outline:hover{background:var(--gold);color:var(--deep)}
    .link-muted{color:var(--muted);text-decoration:none}
    .link-muted:hover{color:var(--gold)}
    .hamb{display:none;flex-direction:column;gap:4px;cursor:pointer}
    .hamb span{width:26px;height:3px;background:var(--gold);border-radius:2px}
    /* Main */
    .main{max-width:1200px;margin:0 auto;padding:48px 20px}
    .hero{text-align:center;margin-bottom:44px}
    .hero h1{font-size:3rem;color:var(--gold);margin:0 0 10px}
    .hero p{max-width:680px;margin:0 auto 18px;color:var(--muted)}
    .cta{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:22px;margin:44px 0}
    .card{background:rgba(26,61,46,.6);border:1px solid rgba(212,175,55,.22);border-radius:12px;padding:22px;backdrop-filter:blur(8px);transition:.25s;position:relative}
    .card:hover{transform:translateY(-4px);border-color:rgba(212,175,55,.48);box-shadow:0 8px 26px rgba(0,0,0,.32)}
    .card h3{color:var(--gold);margin:0 0 8px}
    .card p{color:var(--muted);margin:0 0 12px}
    .tag{font-size:.75rem;padding:2px 8px;border-radius:999px;border:1px solid rgba(212,175,55,.35);color:var(--gold)}
    .lock{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(15,36,25,.45);backdrop-filter:blur(2px)}
    /* Footer */
    .footer{margin-top:48px;background:rgba(15,36,25,.9);border-top:1px solid rgba(212,175,55,.25)}
    .foot{max-width:1200px;margin:0 auto;padding:24px 20px;display:grid;grid-template-columns:1fr auto 1fr;gap:18px;align-items:center}
    .foot a{color:var(--muted);text-decoration:none}
    .foot a:hover{color:var(--gold)}
    .foot-center{display:flex;gap:12px;justify-content:center;align-items:center}
    .foot-right{display:flex;gap:14px;justify-content:flex-end;align-items:center}
    .icon{width:22px;height:22px;display:inline-block;vertical-align:middle;fill:currentColor;color:var(--muted)}
    .icon:hover{color:var(--gold)}
    /* Mobile */
    @media (max-width:980px){
      .foot{grid-template-columns:1fr;text-align:center}
      .foot-center,.foot-right{justify-content:center}
    }
    @media (max-width:768px){
      .menu{position:fixed;left:-100%;top:70px;flex-direction:column;width:100%;padding:18px 0;background:rgba(26,61,46,.98);text-align:center;transition:.25s}
      .menu.active{left:0}
      .hamb{display:flex}
      .hero h1{font-size:2.2rem}
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="nav">
      <a class="logo" href="/">CHIZSA | COACHING</a>
      <nav>
        <ul class="menu" id="menu">
          <li><a href="https://chizsaleei.com/archetype/index.html">Find Your Archetype</a></li>
          <li><a href="https://chizsaleei.com/profiles/index.html">Profile Toolkits</a></li>
          <li><a href="https://chizsaleei.com/focus/index.html">Focus Toolkits</a></li>
          <li><a href="https://chizsaleei.com/about.html">About</a></li>
          <li><a href="https://chizsaleei.com/training.html">Training</a></li>
          <li><a href="https://chizsaleei.com/testimonials.html">Testimonials</a></li>
        </ul>
      </nav>
      <div class="right">
        <a class="btn btn-gold" href="/support/">Support</a>
        <button id="btn-signin" class="btn btn-outline" type="button">Sign in</button>
        <div class="hamb" id="hamb" aria-label="Open menu" aria-expanded="false">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="main">
    <!-- HERO -->
    <section class="hero" id="top">
      <h1>Find your core and use the exact tools</h1>
      <p>Quiz is free and shows your archetype instantly. You can preview tools. Sign in to save progress and use tools. Pay monthly with Tools Pass or buy a single tool.</p>
      <div class="cta">
        <a class="btn btn-gold" href="https://chizsaleei.com/archetype/quiz/index.html">Take a quiz to find your core</a>
        <a class="btn btn-outline" href="#tools">Preview tools</a>
      </div>
      <p class="muted" style="margin-top:10px;">Result is free. Saving and using tools requires sign in. One micro tool is free to use after sign in.</p>
    </section>

    <!-- NEXT STEP CARD -->
    <section class="grid" aria-label="Next step">
      <article class="card">
        <h3>Next step</h3>
        <ol class="muted" style="padding-left:18px;margin:8px 0 0">
          <li>Take the quiz and see your archetype.</li>
          <li>Sign in to save your result and preview tools.</li>
          <li>Use the free micro tool after sign in.</li>
          <li>Unlock all tools with a monthly pass or buy a single tool.</li>
        </ol>
      </article>
    </section>

    <!-- TOOL PREVIEWS -->
    <section id="tools" class="grid" aria-label="Tool previews">
      <!-- IELTS Speaking Drills -->
      <article class="card" data-tool-id="tool-speaking-drills">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>IELTS Speaking Drills</h3>
          <span class="tag">Preview</span>
        </div>
        <p>Timed prompts, band 7 to 8 vocabulary, quick reflection.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to preview and use</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
              <button class="btn btn-gold" data-unlock-all>Unlock all tools</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
          <button class="btn btn-outline" data-buy-one="tool-speaking-drills">Buy this tool</button>
        </div>
      </article>

      <!-- Medical English Labs -->
      <article class="card" data-tool-id="tool-med-english-labs">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Medical English Labs</h3>
          <span class="tag">Preview</span>
        </div>
        <p>SBAR cases, ICU scenarios, differential drills.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to preview and use</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
              <button class="btn btn-gold" data-unlock-all>Unlock all tools</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
          <button class="btn btn-outline" data-buy-one="tool-med-english-labs">Buy this tool</button>
        </div>
      </article>

      <!-- Business Briefs -->
      <article class="card" data-tool-id="tool-business-briefs">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Business Briefs</h3>
          <span class="tag">Preview</span>
        </div>
        <p>Negotiation prompts, critical thinking, email polish.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to preview and use</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
              <button class="btn btn-gold" data-unlock-all>Unlock all tools</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
          <button class="btn btn-outline" data-buy-one="tool-business-briefs">Buy this tool</button>
        </div>
      </article>

      <!-- Free micro tool (requires sign in but no payment) -->
      <article class="card" data-tool-id="tool-free-micro">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Quick Fluency Booster</h3>
          <span class="tag">Free after sign in</span>
        </div>
        <p>One short daily drill. Saves progress for free once signed in.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to use this free tool</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
        </div>
      </article>
    </section>

    <!-- CONTACT / LEAD CAPTURE -->
    <section class="card" style="max-width:1000px;margin:38px auto 0;background:var(--glass)">
      <div class="contact-head" style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px;padding:4px 0 0">
        <h2 style="color:var(--gold);margin:0;font-size:1.5rem">Sign up for updates</h2>
        <small style="color:var(--muted)">Short form, quick reply</small>
      </div>
      <form id="contact-form" class="contact-form" style="display:grid;grid-template-columns:1fr 1fr 2fr auto;gap:12px;align-items:center;padding-bottom:8px">
        <input type="text" id="hp" name="hp" autocomplete="off" tabindex="-1" style="position:absolute;left:-9999px">
        <input id="c-name" type="text" placeholder="Full name" required aria-label="Full name">
        <input id="c-email" type="email" placeholder="Email" required aria-label="Email">
        <textarea id="c-msg" placeholder="What do you need? (tool, coaching, collab)" required aria-label="Your message"></textarea>
        <button id="contact-submit" class="btn btn-gold" type="submit">Send</button>
        <div class="row-note" style="grid-column:1 / -1"><p id="contact-status" class="helper" style="font-size:.9rem;color:var(--muted)"></p></div>
      </form>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="foot">
      <div><small>chizsaleei | 2025, All Rights Reserved</small></div>
      <div class="foot-center">
        <a href="mailto:chizsaleei@gmail.com" aria-label="Email">Gmail</a>
        <span aria-hidden="true">·</span>
        <a href="https://www.linkedin.com/in/chizsaibanez/" target="_blank" rel="noopener" aria-label="LinkedIn">LinkedIn</a>
        <span aria-hidden="true">·</span>
        <a href="https://www.instagram.com/lifebalanceq/" target="_blank" rel="noopener" aria-label="Instagram">Instagram</a>
        <span aria-hidden="true">·</span>
        <a href="/support/" aria-label="Support">Support</a>
      </div>
      <div class="foot-right">
        <a href="https://chizsaleei.com/terms.html">Terms</a>
        <a href="https://chizsaleei.com/privacy.html">Privacy</a>
        <a href="https://chizsaleei.com/accessibility.html">Accessibility</a>
      </div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
    // Mobile menu
    const hamb = document.getElementById('hamb');
    const menu = document.getElementById('menu');
    hamb.addEventListener('click', () => {
      const open = menu.classList.toggle('active');
      hamb.setAttribute('aria-expanded', open ? 'true' : 'false');
    });
    document.querySelectorAll('#menu a').forEach(a=>{
      a.addEventListener('click', ()=> menu.classList.remove('active'));
    });
  </script>

  <!-- Supabase + gating + checkout hooks -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ---------- CONFIG ----------
    const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co"; // retain your URL here
    const SUPABASE_ANON_KEY = "YOUR_PUBLIC_ANON_KEY";       // retain your anon key here

    // Stripe serverless endpoints (Netlify functions you will add)
    const API_CHECKOUT = "/api/create-checkout-session"; // POST {priceId|toolId}
    const API_PORTAL = "/api/customer-portal";           // POST {}

    // Tool path map
    const TOOL_PATH = (toolId) => `/tools/${toolId}/index.html`;

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const state = { user:null, entitlements:{ hasToolsPass:false, ownedTools:new Set(), canUseFreeMicro:false } };

    async function refreshUser(){
      const { data:{ user } } = await supabase.auth.getUser();
      state.user = user;
      const btnSignin = document.getElementById('btn-signin');
      if(user){
        btnSignin.textContent = 'Dashboard';
        btnSignin.onclick = () => window.location.href = 'https://chizsaleei.com/dashboard.html';
        await fetchEntitlements();
      } else {
        btnSignin.textContent = 'Sign in';
        btnSignin.onclick = () => window.location.href = 'https://chizsaleei.com/auth/sign-in/';
        applyLocks();
      }
    }

    supabase.auth.onAuthStateChange(()=> refreshUser());

    // Public SQL views you will create in Supabase:
    // 1) subscriptions_public(user_id uuid, status text, product text)
    //    where product='tools-pass' and status in ('active','trialing')
    // 2) purchases_public(user_id uuid, tool_id text)
    //    one row per purchased tool

    async function fetchEntitlements(){
      if(!state.user){ applyLocks(); return }
      const { data:subs } = await supabase
        .from('subscriptions_public')
        .select('status, product')
        .eq('user_id', state.user.id)
        .maybeSingle();
      state.entitlements.hasToolsPass = (subs?.product === 'tools-pass') && (subs?.status === 'active' || subs?.status === 'trialing');

      const { data:purchases } = await supabase
        .from('purchases_public')
        .select('tool_id')
        .eq('user_id', state.user.id);
      state.entitlements.ownedTools = new Set((purchases||[]).map(r=>r.tool_id));

      // Free micro tool allowed for all signed in users without payment
      state.entitlements.canUseFreeMicro = !!state.user;

      applyLocks();
    }

    function userOwns(toolId){
      if(toolId === 'tool-free-micro') return state.entitlements.canUseFreeMicro;
      return state.entitlements.hasToolsPass || state.entitlements.ownedTools.has(toolId);
    }

    function applyLocks(){
      document.querySelectorAll('[data-tool-id]').forEach(card=>{
        const toolId = card.getAttribute('data-tool-id');
        const overlay = card.querySelector('[data-lock-overlay]');
        const launchBtn = card.querySelector('[data-launch-tool]');
        const signinCtas = card.querySelectorAll('[data-signin-cta]');

        const entitled = userOwns(toolId);
        overlay.style.display = entitled ? 'none' : 'flex';

        signinCtas.forEach(btn=> btn.onclick = () => window.location.href = 'https://chizsaleei.com/auth/sign-in/');

        launchBtn.onclick = () => {
          if(!state.user){ window.location.href = 'https://chizsaleei.com/auth/sign-in/'; return }
          if(entitled){ window.location.href = TOOL_PATH(toolId); }
          else { openBuyModal(toolId); }
        };
      });

      document.querySelectorAll('[data-unlock-all]').forEach(btn=>{
        btn.onclick = () => beginCheckout({ priceId:'price_tools_pass_monthly' });
      });

      document.querySelectorAll('[data-buy-one]').forEach(btn=>{
        btn.onclick = () => beginCheckout({ toolId: btn.getAttribute('data-buy-one') });
      });
    }

    async function beginCheckout(payload){
      if(!state.user){ window.location.href = 'https://chizsaleei.com/auth/sign-in/'; return }
      try{
        const res = await fetch(API_CHECKOUT, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const data = await res.json();
        if(data?.url) window.location.href = data.url; else alert('Checkout error.');
      }catch(e){ alert('Checkout error.'); }
    }

    function openBuyModal(toolId){
      const ok = confirm('Unlock this tool. OK = buy single tool. Cancel = get Tools Pass.');
      if(ok){ beginCheckout({ toolId }); }
      else { beginCheckout({ priceId:'price_tools_pass_monthly' }); }
    }

    refreshUser();
  </script>
  <script>
    // Optional helper for Support page: open Stripe Customer Portal
    async function openBillingPortal(){
      try{
        const res = await fetch('/api/customer-portal', { method:'POST' });
        const data = await res.json();
        if(data?.url){ window.location.href = data.url; } else { alert('Unable to open billing portal.'); }
      }catch(e){ alert('Unable to open billing portal.'); }
    }
    window.openBillingPortal = openBillingPortal;
  </script>
</body>
</html>

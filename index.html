<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CHIZSA | COACHING</title>
  <style>
    :root{ --deep:#0f2419; --deep2:#1a3d2e; --gold:#d4af37; --gold2:#b8941f; --ink:#f4f1e8; --muted:#c9d1d9; --glass:rgba(26,61,46,.85); }
    *{box-sizing:border-box}
    body{ margin:0; font-family:Georgia, serif; color:var(--ink); background:linear-gradient(135deg,var(--deep2) 0%,var(--deep) 100%); line-height:1.6; min-height:100vh; }

    .main{max-width:1200px;margin:0 auto;padding:48px 20px}
    .hero{text-align:center;margin-bottom:44px}
    .hero h1{font-size:3rem;color:var(--gold);margin:0 0 10px}
    .hero p{max-width:680px;margin:0 auto 18px;color:var(--muted)}
    .cta{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;text-decoration:none;font-weight:600;transition:.25s;cursor:pointer}
    .btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--deep)}
    .btn-gold:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(212,175,55,.28)}
    .btn-outline{border:2px solid var(--gold);color:var(--gold);background:transparent}
    .btn-outline:hover{background:var(--gold);color:var(--deep)}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:22px;margin:44px 0}
    .card{background:rgba(26,61,46,.6);border:1px solid rgba(212,175,55,.22);border-radius:12px;padding:22px;backdrop-filter:blur(8px);transition:.25s;position:relative}
    .card:hover{transform:translateY(-4px);border-color:rgba(212,175,55,.48);box-shadow:0 8px 26px rgba(0,0,0,.32)}
    .card h3{color:var(--gold);margin:0 0 8px}
    .card p{color:var(--muted);margin:0 0 12px}
    .tag{font-size:.75rem;padding:2px 8px;border-radius:999px;border:1px solid rgba(212,175,55,.35);color:var(--gold)}
    .lock{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(15,36,25,.45);backdrop-filter:blur(2px)}
    .footer-spacer{height:8px}
    @media (max-width:768px){ .hero h1{font-size:2.2rem} }
  </style>
</head>
<body>

  <!-- Shared header -->
  <div id="header-slot"></div>

  <!-- MAIN -->
  <main class="main">
    <!-- HERO -->
    <section class="hero" id="top">
      <h1>Find your core and use the exact tools</h1>
      <p>Quiz is free and shows your archetype instantly. You can preview tools. Sign in to save progress and use tools. Pay monthly with Tools Pass or buy a single tool.</p>
      <div class="cta">
        <a class="btn btn-gold" href="https://chizsaleei.com/archetype/quiz/index.html">Take a quiz to find your core</a>
        <a class="btn btn-outline" href="https://chizsaleei.com/discover.html">Preview tools</a>
        <a id="hero-signin" class="btn btn-outline" href="https://chizsaleei.com/auth/index.html">Sign in</a>
      </div>
      <p class="muted" style="margin-top:10px;">Result is free. Saving and using tools requires sign in. One micro tool is free to use after sign in.</p>
    </section>

    <!-- NEXT STEP CARD -->
    <section class="grid" aria-label="Next step">
      <article class="card">
        <h3>Next step</h3>
        <ol class="muted" style="padding-left:18px;margin:8px 0 0">
          <li>Take the quiz and see your archetype.</li>
          <li>Sign in to save your result and preview tools.</li>
          <li>Use the free micro tool after sign in.</li>
          <li>Unlock all tools with a monthly pass or buy a single tool.</li>
        </ol>
      </article>
    </section>

    <!-- TOOL PREVIEWS -->
    <section id="tools" class="grid" aria-label="Tool previews">
      <!-- IELTS Speaking Drills -->
      <article class="card" data-tool-id="tool-speaking-drills">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>IELTS Speaking Drills</h3>
          <span class="tag">Preview</span>
        </div>
        <p>Timed prompts, band 7 to 8 vocabulary, quick reflection.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to preview and use</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
              <button class="btn btn-gold" data-unlock-all>Unlock all tools</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
          <button class="btn btn-outline" data-buy-one="tool-speaking-drills">Buy this tool</button>
        </div>
      </article>

      <!-- Medical English Labs -->
      <article class="card" data-tool-id="tool-med-english-labs">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Medical English Labs</h3>
          <span class="tag">Preview</span>
        </div>
        <p>SBAR cases, ICU scenarios, differential drills.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to preview and use</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
              <button class="btn btn-gold" data-unlock-all>Unlock all tools</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
          <button class="btn btn-outline" data-buy-one="tool-med-english-labs">Buy this tool</button>
        </div>
      </article>

      <!-- Business Briefs -->
      <article class="card" data-tool-id="tool-business-briefs">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Business Briefs</h3>
          <span class="tag">Preview</span>
        </div>
        <p>Negotiation prompts, critical thinking, email polish.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to preview and use</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
              <button class="btn btn-gold" data-unlock-all>Unlock all tools</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
          <button class="btn btn-outline" data-buy-one="tool-business-briefs">Buy this tool</button>
        </div>
      </article>

      <!-- Free micro tool (requires sign in but no payment) -->
      <article class="card" data-tool-id="tool-free-micro">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Quick Fluency Booster</h3>
          <span class="tag">Free after sign in</span>
        </div>
        <p>One short daily drill. Saves progress for free once signed in.</p>
        <div class="lock" data-lock-overlay>
          <div style="text-align:center">
            <div>Sign in to use this free tool</div>
            <div style="margin-top:10px">
              <button class="btn btn-outline" data-signin-cta>Sign in</button>
            </div>
          </div>
        </div>
        <div class="cta" style="justify-content:flex-start;margin-top:12px">
          <button class="btn btn-gold" data-launch-tool>Launch tool</button>
        </div>
      </article>
    </section>

    <section class="card" style="max-width:1000px;margin:38px auto 0;background:var(--glass)">
      <div class="contact-head" style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px;padding:4px 0 0">
        <h2 style="color:var(--gold);margin:0;font-size:1.5rem">Review, Request and Collaborate</h2>
        <small style="color:var(--muted)">Questions, concerns, requests, or collab ideas</small>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <p style="color:var(--muted);margin:0">Use the contact page to send your name, email, and message. It saves to Supabase and emails us so we can reply fast.</p>
        <a class="btn btn-gold" href="https://chizsaleei.com/contact.html">Go to contact page</a>
      </div>
    </section>

    <div class="footer-spacer"></div>
  </main>

  <!-- Shared footer -->
  <div id="footer-slot"></div>

  <!-- Inject header + footer partials -->
  <script>
    async function inject(id, url, fallbackHtml='') {
      const el = document.getElementById(id);
      try {
        const res = await fetch(url, { cache: 'no-store' });
        el.innerHTML = await res.text();
      } catch (e) {
        console.warn('Include failed:', url, e);
        el.innerHTML = fallbackHtml;
      }
    }
    inject('header-slot','/Coaching/partials/header.html');
    inject(
      'footer-slot',
      '/Coaching/partials/footer.html',
      '<footer style="background:#0f2419;border-top:1px solid rgba(212,175,55,.22);padding:18px 16px;text-align:center;font-family:Georgia,serif;color:#f4f1e8">'+
        '<a href="https://chizsaleei.com/terms.html" style="color:#f4f1e8;margin:0 8px">Terms</a>'+
        '<a href="https://chizsaleei.com/privacy.html" style="color:#f4f1e8;margin:0 8px">Privacy</a>'+
        '<a href="https://chizsaleei.com/accessibility.html" style="color:#f4f1e8;margin:0 8px">Accessibility</a>'+
      '</footer>'
    );
  </script>

  <!-- Supabase + gating + checkout -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // CONFIG
    const SUPABASE_URL = "https://gwlwctytwendsixwvnvu.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3bHdjdHl0d2VuZHNpeHd2bnZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1NzM2ODQsImV4cCI6MjA3NTE0OTY4NH0.0fg92ZPHU4EoLYv6KDxZzlS12y_y54qRfSQ6CPAHhpo";
    const API_CHECKOUT = "https://gwlwctytwendsixwvnvu.supabase.co/functions/v1/create-checkout-session";
    const ENTITLEMENTS_URL = "https://gwlwctytwendsixwvnvu.supabase.co/functions/v1/entitlements";
    const AUTH_URL = "https://chizsaleei.com/auth/index.html";
    const TOOL_PATH = toolId => `/tools/${toolId}/index.html`;

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    let currentUser = null;

    // Helpers
    async function requireLogin() {
      const { data:{ session } } = await supabase.auth.getSession();
      if (!session?.user) {
        window.location.href = `${AUTH_URL}?next=${encodeURIComponent(location.pathname)}`;
        return null;
      }
      return session.user;
    }

    async function checkAccess(productCode) {
      const user = currentUser || await requireLogin();
      if (!user) return { allowed:false };
      const r = await fetch(ENTITLEMENTS_URL, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({ userId: user.id, productCode })
      });
      return r.ok ? r.json() : { allowed:false };
    }

    function wireLockedCard(card, toolId) {
      const overlay = card.querySelector("[data-lock-overlay]");
      const launchBtn = card.querySelector("[data-launch-tool]");
      const buyOneBtn = card.querySelector("[data-buy-one]");
      const signins = card.querySelectorAll("[data-signin-cta]");

      // default actions
      signins.forEach(b => b.onclick = () => window.location.href = AUTH_URL);

      // decide entitlement
      checkAccess(toolId).then(({ allowed }) => {
        overlay.style.display = allowed ? "none" : "flex";
        launchBtn.onclick = async () => {
          const user = await requireLogin(); if (!user) return;
          if (allowed) window.location.href = TOOL_PATH(toolId);
          else openBuyModal(toolId);
        };
      });

      if (buyOneBtn) {
        buyOneBtn.onclick = async () => {
          const user = await requireLogin(); if (!user) return;
          beginCheckout({ toolId });
        };
      }
    }

    async function beginCheckout(payload) {
      const user = await requireLogin(); if (!user) return;
      try {
        const res = await fetch(API_CHECKOUT, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (data?.url) window.location.href = data.url;
        else alert("Checkout error");
      } catch {
        alert("Checkout error");
      }
    }

    function openBuyModal(toolId) {
      const ok = confirm("Unlock this tool. OK = buy single tool. Cancel = get Tools Pass.");
      if (ok) beginCheckout({ toolId });
      else window.location.href = AUTH_URL;
    }

    async function refreshUser() {
      const { data:{ user } } = await supabase.auth.getUser();
      currentUser = user || null;
      document.querySelectorAll("[data-tool-id]").forEach(card => {
        const toolId = card.getAttribute("data-tool-id");
        wireLockedCard(card, toolId);
      });
      document.querySelectorAll("#hero-signin,[data-unlock-all]").forEach(btn => {
        btn.onclick = () => window.location.href = AUTH_URL;
      });
    }

    supabase.auth.onAuthStateChange(() => refreshUser());
    refreshUser();
  </script>
</body>
</html>

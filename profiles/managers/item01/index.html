<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Manager Pro - General Writing Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        :root {
            --dark-green: #1a3b2e;
            --medium-green: #2d5a3d;
            --light-green: #4a7c59;
            --accent-green: #6b9080;
            --pale-green: #a4c3a2;
            --dark-gold: #b8860b;
            --medium-gold: #daa520;
            --light-gold: #f4d03f;
            --pale-gold: #fdf6e3;
            --cream: #fefcf3;
        }
        
        .bg-dark-green { background-color: var(--dark-green); }
        .bg-medium-green { background-color: var(--medium-green); }
        .bg-light-green { background-color: var(--light-green); }
        .bg-accent-green { background-color: var(--accent-green); }
        .bg-pale-green { background-color: var(--pale-green); }
        .bg-dark-gold { background-color: var(--dark-gold); }
        .bg-medium-gold { background-color: var(--medium-gold); }
        .bg-light-gold { background-color: var(--light-gold); }
        .bg-pale-gold { background-color: var(--pale-gold); }
        .bg-cream { background-color: var(--cream); }
        
        .text-dark-green { color: var(--dark-green); }
        .text-medium-green { color: var(--medium-green); }
        .text-light-green { color: var(--light-green); }
        .text-dark-gold { color: var(--dark-gold); }
        .text-medium-gold { color: var(--medium-gold); }
        
        .border-dark-green { border-color: var(--dark-green); }
        .border-medium-green { border-color: var(--medium-green); }
        .border-dark-gold { border-color: var(--dark-gold); }
        .border-medium-gold { border-color: var(--medium-gold); }
        
        .timer-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--medium-gold) 0deg, var(--pale-gold) 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: background 0.1s ease;
        }
        
        .timer-inner {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .writing-area {
            min-height: 400px;
            border: 2px solid var(--pale-gold);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            font-size: 16px;
            background: white;
            resize: none;
        }
        
        .writing-area:focus {
            outline: none;
            border-color: var(--medium-gold);
            box-shadow: 0 0 0 3px rgba(218, 165, 32, 0.1);
        }
        
        .task-card {
            background: linear-gradient(135deg, var(--pale-gold), var(--cream));
            border: 2px solid var(--medium-gold);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            background: white;
            border: 1px solid var(--pale-green);
            transition: all 0.3s ease;
        }
        
        .checklist-item:hover {
            border-color: var(--medium-gold);
            transform: translateX(4px);
        }
        
        .checklist-item.completed {
            background: var(--pale-green);
            border-color: var(--accent-green);
        }
        
        .word-counter {
            position: sticky;
            bottom: 20px;
            right: 20px;
            background: var(--medium-gold);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(184, 134, 11, 0.3);
            z-index: 100;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--pale-gold);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--medium-gold), var(--dark-gold));
            transition: width 0.3s ease;
        }
        
        .tone-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .tone-formal { background: #e3f2fd; color: #1976d2; }
        .tone-semi-formal { background: #fff3e0; color: #f57c00; }
        .tone-informal { background: #e8f5e8; color: #388e3c; }
        
        .action-button {
            background: linear-gradient(135deg, var(--medium-gold), var(--dark-gold));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(184, 134, 11, 0.3);
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(184, 134, 11, 0.4);
        }
        
        .action-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .motivational-card {
            background: linear-gradient(135deg, var(--pale-gold), var(--cream));
            border: 2px solid var(--medium-gold);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .motivational-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .recording-pulse {
            animation: recordingPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes recordingPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); 
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); 
            }
        }
        
        .voice-wave {
            width: 4px;
            height: 20px;
            background: white;
            margin: 0 2px;
            border-radius: 2px;
            animation: voiceWave 1s ease-in-out infinite;
        }
        
        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes voiceWave {
            0%, 100% { height: 4px; }
            50% { height: 20px; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .streak-flame {
            animation: flicker 2s ease-in-out infinite alternate;
        }
        
        @keyframes flicker {
            0% { transform: scale(1) rotate(-2deg); }
            100% { transform: scale(1.1) rotate(2deg); }
        }
        
        .offline-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .online { background: #4caf50; color: white; }
        .offline { background: #ff9800; color: white; }
        
        .analytics-card {
            background: linear-gradient(135deg, var(--pale-green), white);
            border: 2px solid var(--accent-green);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .task-difficulty {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .difficulty-easy { background: #e8f5e8; color: #388e3c; }
        .difficulty-medium { background: #fff3e0; color: #f57c00; }
        .difficulty-hard { background: #ffebee; color: #d32f2f; }
        
        /* Accessibility improvements */
        .focus-visible:focus {
            outline: 3px solid var(--medium-gold);
            outline-offset: 2px;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        @media (max-width: 768px) {
            .timer-circle {
                width: 100px;
                height: 100px;
            }
            
            .timer-inner {
                width: 80px;
                height: 80px;
            }
            
            .writing-area {
                min-height: 300px;
                padding: 15px;
                font-size: 14px;
            }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .checklist-item {
                border-width: 2px;
            }
            
            .action-button {
                border: 2px solid white;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="bg-cream min-h-screen">
    <!-- Offline/Online Indicator -->
    <div id="connectionStatus" class="offline-indicator online">
        <span id="statusText">Online</span>
    </div>

    <!-- Header -->
    <header class="bg-dark-green text-white shadow-xl">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-medium-gold rounded-full flex items-center justify-center">
                        <span class="text-2xl">✍️</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">IELTS Manager Pro</h1>
                        <p class="text-accent-green text-sm">General Writing Practice for Managers</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Current Streak -->
                    <div class="text-center">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl streak-flame">🔥</span>
                            <span class="text-xl font-bold text-light-gold" id="currentStreak">0</span>
                        </div>
                        <div class="text-xs text-accent-green">Day Streak</div>
                    </div>
                    
                    <!-- Navigation -->
                    <nav class="flex space-x-2">
                        <button id="dashboardBtn" class="px-4 py-2 bg-medium-green rounded-lg hover:bg-light-green transition-colors focus-visible">
                            Dashboard
                        </button>
                        <button id="practiceBtn" class="px-4 py-2 bg-medium-green rounded-lg hover:bg-light-green transition-colors focus-visible">
                            Practice
                        </button>
                        <button id="analyticsBtn" class="px-4 py-2 bg-medium-green rounded-lg hover:bg-light-green transition-colors focus-visible">
                            Analytics
                        </button>
                        <button id="settingsBtn" class="px-4 py-2 bg-medium-green rounded-lg hover:bg-light-green transition-colors focus-visible">
                            Settings
                        </button>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard View -->
        <div id="dashboardView" class="space-y-8">
            <!-- Motivational Message -->
            <div class="motivational-card fade-in">
                <h2 class="text-xl font-bold text-dark-green mb-2">Daily Motivation</h2>
                <p id="motivationalMessage" class="text-medium-green text-lg italic">
                    "Excellence in writing comes from practice under pressure."
                </p>
                <button id="newMotivationBtn" class="mt-4 px-4 py-2 bg-medium-gold text-white rounded-lg hover:bg-dark-gold transition-colors focus-visible">
                    New Message
                </button>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Focus Timer -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                    <h3 class="text-lg font-bold text-dark-green mb-4 flex items-center">
                        <span class="mr-2">⏰</span>
                        Focus Timer
                    </h3>
                    
                    <div class="flex justify-center mb-4">
                        <div class="timer-circle" id="timerCircle">
                            <div class="timer-inner">
                                <div class="text-2xl font-bold text-dark-green" id="timerDisplay">20:00</div>
                                <div class="text-xs text-medium-green">minutes</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button id="startTimerBtn" class="flex-1 action-button focus-visible">
                            Start
                        </button>
                        <button id="resetTimerBtn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors focus-visible">
                            Reset
                        </button>
                    </div>
                </div>

                <!-- Quick Practice -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                    <h3 class="text-lg font-bold text-dark-green mb-4 flex items-center">
                        <span class="mr-2">📝</span>
                        Quick Practice
                    </h3>
                    
                    <div class="space-y-3">
                        <button id="quickEmailBtn" class="w-full action-button focus-visible">
                            Practice Email
                        </button>
                        <button id="quickProposalBtn" class="w-full action-button focus-visible">
                            Practice Proposal
                        </button>
                        <button id="randomTaskBtn" class="w-full action-button focus-visible">
                            Random Task
                        </button>
                    </div>
                </div>

                <!-- Daily Actions -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                    <h3 class="text-lg font-bold text-dark-green mb-4 flex items-center">
                        <span class="mr-2">✅</span>
                        Daily Goals
                    </h3>
                    
                    <div id="dailyActions" class="space-y-2">
                        <!-- Daily actions will be populated here -->
                    </div>
                    
                    <button id="addActionBtn" class="w-full mt-4 px-4 py-2 bg-accent-green text-white rounded-lg hover:bg-medium-green transition-colors focus-visible">
                        + Add Goal
                    </button>
                </div>
            </div>

            <!-- Recent Practice Sessions -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-dark-green">Recent Practice Sessions</h3>
                    <button id="newPracticeBtn" class="action-button focus-visible">
                        + New Practice
                    </button>
                </div>
                
                <div id="recentSessions" class="space-y-3">
                    <!-- Recent sessions will be populated here -->
                </div>
            </div>
        </div>

        <!-- Practice View -->
        <div id="practiceView" class="hidden space-y-6">
            <!-- Practice Header -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-dark-green" id="practiceTitle">IELTS Writing Practice</h2>
                        <div class="flex items-center space-x-4 mt-2">
                            <span class="task-difficulty" id="taskDifficulty">Medium</span>
                            <span class="tone-indicator" id="toneIndicator">Formal</span>
                            <span class="text-sm text-medium-green" id="taskType">Email</span>
                            <span class="text-sm text-gray-600" id="practiceTimer">00:00</span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="savePracticeBtn" class="px-4 py-2 bg-accent-green text-white rounded-lg hover:bg-medium-green transition-colors focus-visible">
                            Save
                        </button>
                        <button id="exportPracticeBtn" class="px-4 py-2 bg-medium-gold text-white rounded-lg hover:bg-dark-gold transition-colors focus-visible">
                            Export PDF
                        </button>
                        <button id="backToDashboardBtn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors focus-visible">
                            Back
                        </button>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="mb-4">
                    <div class="flex justify-between text-sm text-medium-green mb-2">
                        <span>Progress</span>
                        <span id="progressText">0% Complete</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Main Practice Area -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Task & Writing Area -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Task Description -->
                    <div class="task-card">
                        <h3 class="text-lg font-bold text-dark-green mb-3">Task</h3>
                        <div id="taskDescription" class="text-medium-green mb-4">
                            <!-- Task will be loaded here -->
                        </div>
                        
                        <!-- Task Analysis -->
                        <div class="bg-white p-4 rounded-lg border border-medium-gold">
                            <h4 class="font-bold text-dark-green mb-2">Quick Analysis</h4>
                            <div id="taskAnalysis" class="text-sm text-medium-green">
                                <!-- Analysis will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Writing Area -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-dark-green">Your Response</h3>
                            <div class="flex items-center space-x-4">
                                <button id="voiceInputBtn" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors focus-visible">
                                    🎤 Voice
                                </button>
                                <button id="clearWritingBtn" class="px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors focus-visible">
                                    Clear
                                </button>
                            </div>
                        </div>
                        
                        <!-- Voice Status -->
                        <div id="voiceStatus" class="hidden text-center mb-4">
                            <div class="flex justify-center items-center space-x-1 mb-2">
                                <div class="voice-wave"></div>
                                <div class="voice-wave"></div>
                                <div class="voice-wave"></div>
                                <div class="voice-wave"></div>
                                <div class="voice-wave"></div>
                            </div>
                            <p class="text-sm text-red-600 font-semibold">Recording in progress...</p>
                        </div>
                        
                        <textarea 
                            id="writingArea" 
                            class="writing-area w-full focus-visible" 
                            placeholder="Start writing your response here..."
                            aria-label="Writing area for IELTS practice"
                        ></textarea>
                        
                        <!-- Word Counter -->
                        <div class="word-counter">
                            <span id="wordCount">0</span> words
                            <span class="text-xs opacity-75">| Target: <span id="targetWords">150</span></span>
                        </div>
                    </div>
                </div>

                <!-- Checklists & Tools -->
                <div class="space-y-6">
                    <!-- Tone Control -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                        <h3 class="text-lg font-bold text-dark-green mb-4">Tone Control</h3>
                        
                        <div class="space-y-3">
                            <div class="checklist-item" data-tone="formal">
                                <input type="radio" name="tone" value="formal" checked class="mr-3">
                                <span class="text-sm">Formal (Dear Sir/Madam, Yours faithfully)</span>
                            </div>
                            <div class="checklist-item" data-tone="semi-formal">
                                <input type="radio" name="tone" value="semi-formal" class="mr-3">
                                <span class="text-sm">Semi-formal (Dear Mr./Ms., Best regards)</span>
                            </div>
                            <div class="checklist-item" data-tone="informal">
                                <input type="radio" name="tone" value="informal" class="mr-3">
                                <span class="text-sm">Informal (Hi/Hello, Cheers/Best wishes)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Structure Checklist -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                        <h3 class="text-lg font-bold text-dark-green mb-4">Structure Checklist</h3>
                        
                        <div id="structureChecklist" class="space-y-2">
                            <!-- Checklist items will be populated based on task type -->
                        </div>
                    </div>

                    <!-- Coherence Checklist -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                        <h3 class="text-lg font-bold text-dark-green mb-4">Coherence Checklist</h3>
                        
                        <div id="coherenceChecklist" class="space-y-2">
                            <div class="checklist-item">
                                <input type="checkbox" class="mr-3 coherence-check" data-check="paragraphs">
                                <span class="text-sm">Clear paragraphs with topic sentences</span>
                            </div>
                            <div class="checklist-item">
                                <input type="checkbox" class="mr-3 coherence-check" data-check="linking">
                                <span class="text-sm">Appropriate linking words used</span>
                            </div>
                            <div class="checklist-item">
                                <input type="checkbox" class="mr-3 coherence-check" data-check="flow">
                                <span class="text-sm">Logical flow of ideas</span>
                            </div>
                            <div class="checklist-item">
                                <input type="checkbox" class="mr-3 coherence-check" data-check="conclusion">
                                <span class="text-sm">Clear conclusion/closing</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                        <h3 class="text-lg font-bold text-dark-green mb-4">Quick Actions</h3>
                        
                        <div class="space-y-3">
                            <button id="analyzeWritingBtn" class="w-full action-button focus-visible">
                                📊 Analyze Writing
                            </button>
                            <button id="doItNowBtn" class="w-full action-button focus-visible">
                                ⚡ Do It Now
                            </button>
                            <button id="newTaskBtn" class="w-full px-4 py-2 bg-accent-green text-white rounded-lg hover:bg-medium-green transition-colors focus-visible">
                                🔄 New Task
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="analyticsView" class="hidden space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                <h2 class="text-2xl font-bold text-dark-green mb-6">Writing Analytics</h2>
                
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="analytics-card">
                        <div class="text-3xl font-bold text-dark-green" id="totalPractices">0</div>
                        <div class="text-sm text-medium-green">Total Practices</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="text-3xl font-bold text-dark-green" id="totalWords">0</div>
                        <div class="text-sm text-medium-green">Words Written</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="text-3xl font-bold text-dark-green" id="averageScore">0%</div>
                        <div class="text-sm text-medium-green">Average Score</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="text-3xl font-bold text-dark-green" id="longestStreak">0</div>
                        <div class="text-sm text-medium-green">Longest Streak</div>
                    </div>
                </div>

                <!-- Progress Chart Placeholder -->
                <div class="bg-pale-gold p-6 rounded-lg border-2 border-medium-gold">
                    <h3 class="text-lg font-bold text-dark-green mb-4">Weekly Progress</h3>
                    <div class="h-64 flex items-center justify-center text-medium-green">
                        <div class="text-center">
                            <div class="text-4xl mb-2">📈</div>
                            <p>Progress visualization coming soon</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settingsView" class="hidden space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-lg border-2 border-pale-green">
                <h2 class="text-2xl font-bold text-dark-green mb-6">Settings</h2>
                
                <div class="space-y-6">
                    <!-- Data Management -->
                    <div>
                        <h3 class="text-lg font-bold text-dark-green mb-4">Data Management</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button id="backupBtn" class="action-button focus-visible">
                                💾 Backup Data
                            </button>
                            <button id="restoreBtn" class="px-4 py-2 bg-accent-green text-white rounded-lg hover:bg-medium-green transition-colors focus-visible">
                                📥 Restore Data
                            </button>
                            <button id="clearDataBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors focus-visible">
                                🗑️ Clear All Data
                            </button>
                        </div>
                    </div>

                    <!-- Preferences -->
                    <div>
                        <h3 class="text-lg font-bold text-dark-green mb-4">Preferences</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <label class="text-medium-green">Timer Duration (minutes)</label>
                                <select id="timerDurationSelect" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold">
                                    <option value="15">15</option>
                                    <option value="20" selected>20</option>
                                    <option value="25">25</option>
                                    <option value="30">30</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <label class="text-medium-green">Default Task Type</label>
                                <select id="defaultTaskSelect" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold">
                                    <option value="email">Email</option>
                                    <option value="proposal" selected>Proposal</option>
                                    <option value="random">Random</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <label class="text-medium-green">Auto-sync</label>
                                <input type="checkbox" id="autoSyncToggle" checked class="rounded border-gray-300 text-medium-gold focus:ring-medium-gold">
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <label class="text-medium-green">Sound Notifications</label>
                                <input type="checkbox" id="soundToggle" checked class="rounded border-gray-300 text-medium-gold focus:ring-medium-gold">
                            </div>
                        </div>
                    </div>

                    <!-- Custom Messages -->
                    <div>
                        <h3 class="text-lg font-bold text-dark-green mb-4">Custom Motivational Messages</h3>
                        <div class="space-y-3">
                            <textarea id="customMessageInput" placeholder="Add your own motivational message..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold" rows="3"></textarea>
                            <button id="addMessageBtn" class="action-button focus-visible">
                                Add Message
                            </button>
                        </div>
                        
                        <div id="customMessages" class="mt-4 space-y-2">
                            <!-- Custom messages will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- New Practice Modal -->
    <div id="newPracticeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-xl max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-dark-green mb-6">Start New Practice</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-medium-green mb-2">Task Type</label>
                    <select id="practiceTypeSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold">
                        <option value="email">Formal Email</option>
                        <option value="proposal">Business Proposal</option>
                        <option value="complaint">Complaint Letter</option>
                        <option value="request">Request Letter</option>
                        <option value="application">Job Application</option>
                        <option value="report">Business Report</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-medium-green mb-2">Difficulty Level</label>
                    <select id="difficultySelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-medium-green mb-2">Time Limit</label>
                    <select id="timeLimitSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold">
                        <option value="15">15 minutes</option>
                        <option value="20" selected>20 minutes</option>
                        <option value="25">25 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="0">No time limit</option>
                    </select>
                </div>
            </div>
            
            <div class="flex space-x-4 mt-6">
                <button id="startPracticeBtn" class="flex-1 action-button focus-visible">
                    Start Practice
                </button>
                <button id="cancelPracticeBtn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors focus-visible">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Add Action Modal -->
    <div id="addActionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-xl max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-dark-green mb-6">Add Daily Goal</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-medium-green mb-2">Goal Description</label>
                    <input type="text" id="actionDescInput" placeholder="e.g., Complete 2 email practice tasks" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-medium-green mb-2">Priority</label>
                    <select id="actionPrioritySelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-medium-gold focus:border-medium-gold">
                        <option value="high">High</option>
                        <option value="medium" selected>Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
            </div>
            
            <div class="flex space-x-4 mt-6">
                <button id="saveActionBtn" class="flex-1 action-button focus-visible">
                    Add Goal
                </button>
                <button id="cancelActionBtn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors focus-visible">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- File Input for Restore -->
    <input type="file" id="restoreFileInput" accept=".json" class="hidden">

    <!-- Audio element for timer alert -->
    <audio id="timerAlert" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
    </audio>

    <script>
        // Global state management
        let appState = {
            currentView: 'dashboard',
            isOnline: navigator.onLine,
            currentPractice: null,
            isRecording: false,
            practiceTimer: {
                isRunning: false,
                startTime: null,
                interval: null
            },
            focusTimer: {
                isRunning: false,
                timeLeft: 20 * 60, // 20 minutes in seconds
                interval: null,
                duration: 20 * 60
            },
            voiceRecognition: {
                recognition: null,
                isSupported: false
            },
            userData: {
                practices: [],
                dailyActions: [],
                customMessages: [],
                streak: 0,
                lastActiveDate: null,
                totalPractices: 0,
                totalWords: 0,
                averageScore: 0,
                longestStreak: 0,
                settings: {
                    timerDuration: 20,
                    defaultTaskType: 'email',
                    autoSync: true,
                    soundNotifications: true
                }
            }
        };

        // Task templates with comprehensive random topics
        const taskTemplates = {
            email: {
                formal: [
                    // Easy Email Tasks
                    {
                        difficulty: 'easy',
                        task: "You recently attended a business conference. Write an email to your manager summarizing the key points and how they could benefit your company.",
                        analysis: "• Purpose: Inform and recommend\n• Tone: Formal\n• Structure: Introduction, main points, recommendations, conclusion\n• Key elements: Conference details, benefits, action items",
                        targetWords: 150,
                        timeLimit: 20
                    },
                    {
                        difficulty: 'easy',
                        task: "Write an email to a colleague requesting information about the quarterly sales figures for your upcoming presentation.",
                        analysis: "• Purpose: Request information\n• Tone: Formal but friendly\n• Structure: Greeting, request explanation, specific details needed, deadline\n• Key elements: Clear request, specific information, timeline",
                        targetWords: 120,
                        timeLimit: 15
                    },
                    {
                        difficulty: 'easy',
                        task: "Your office will be closed for maintenance next weekend. Write an email to all staff informing them about the closure and any necessary preparations.",
                        analysis: "• Purpose: Inform and instruct\n• Tone: Formal and clear\n• Structure: Announcement, details, impact, required actions\n• Key elements: Clear dates, impact on work, preparation steps",
                        targetWords: 140,
                        timeLimit: 18
                    },
                    {
                        difficulty: 'easy',
                        task: "Write an email to your team congratulating them on successfully completing a major project and thanking them for their hard work.",
                        analysis: "• Purpose: Appreciate and motivate\n• Tone: Formal but warm\n• Structure: Congratulations, specific achievements, appreciation, future outlook\n• Key elements: Specific recognition, team achievements, positive tone",
                        targetWords: 130,
                        timeLimit: 17
                    },
                    {
                        difficulty: 'easy',
                        task: "You need to reschedule a client meeting due to an emergency. Write an email apologizing and proposing new meeting times.",
                        analysis: "• Purpose: Apologize and reschedule\n• Tone: Formal and apologetic\n• Structure: Apology, explanation, new options, confirmation request\n• Key elements: Sincere apology, brief explanation, alternative times",
                        targetWords: 125,
                        timeLimit: 16
                    },
                    
                    // Medium Email Tasks
                    {
                        difficulty: 'medium',
                        task: "Your company is considering implementing a new remote work policy. Write an email to the HR department outlining the potential benefits and challenges, and provide your recommendations.",
                        analysis: "• Purpose: Analyze and recommend\n• Tone: Formal\n• Structure: Introduction, benefits, challenges, recommendations\n• Key elements: Policy analysis, balanced view, clear recommendations",
                        targetWords: 200,
                        timeLimit: 25
                    },
                    {
                        difficulty: 'medium',
                        task: "A client has complained about delayed delivery of their order. Write an email addressing their concerns, explaining the situation, and offering compensation.",
                        analysis: "• Purpose: Address complaint and resolve issue\n• Tone: Formal and empathetic\n• Structure: Acknowledgment, explanation, apology, solution, prevention\n• Key elements: Customer focus, accountability, concrete solutions",
                        targetWords: 190,
                        timeLimit: 24
                    },
                    {
                        difficulty: 'medium',
                        task: "Write an email to your international business partner proposing a joint marketing campaign for the upcoming holiday season.",
                        analysis: "• Purpose: Propose collaboration\n• Tone: Formal and persuasive\n• Structure: Introduction, proposal details, benefits, next steps\n• Key elements: Clear proposal, mutual benefits, action plan",
                        targetWords: 210,
                        timeLimit: 26
                    },
                    {
                        difficulty: 'medium',
                        task: "Your department's budget has been reduced by 20%. Write an email to your team explaining the situation and outlining how you plan to manage the changes.",
                        analysis: "• Purpose: Inform and reassure\n• Tone: Formal but supportive\n• Structure: Situation explanation, impact assessment, management plan, team support\n• Key elements: Transparency, leadership, practical solutions",
                        targetWords: 195,
                        timeLimit: 25
                    },
                    {
                        difficulty: 'medium',
                        task: "Write an email to the IT department requesting urgent technical support for a system failure that is affecting customer service operations.",
                        analysis: "• Purpose: Request urgent assistance\n• Tone: Formal and urgent\n• Structure: Problem description, impact assessment, urgency explanation, support request\n• Key elements: Clear problem statement, business impact, urgency justification",
                        targetWords: 180,
                        timeLimit: 23
                    },
                    
                    // Hard Email Tasks
                    {
                        difficulty: 'hard',
                        task: "You are the project manager for a delayed software development project. Write an email to stakeholders explaining the delays, their impact on the timeline and budget, and your recovery plan.",
                        analysis: "• Purpose: Explain, apologize, and propose solutions\n• Tone: Formal but empathetic\n• Structure: Acknowledgment, explanation, impact assessment, recovery plan\n• Key elements: Accountability, transparency, concrete solutions",
                        targetWords: 250,
                        timeLimit: 30
                    },
                    {
                        difficulty: 'hard',
                        task: "Your company is facing a potential data security breach. Write an email to the board of directors outlining the situation, immediate actions taken, and long-term security improvements needed.",
                        analysis: "• Purpose: Crisis communication and strategic planning\n• Tone: Formal and authoritative\n• Structure: Situation summary, immediate response, impact assessment, strategic recommendations\n• Key elements: Crisis management, stakeholder communication, strategic thinking",
                        targetWords: 280,
                        timeLimit: 35
                    },
                    {
                        difficulty: 'hard',
                        task: "Write an email to a major client whose contract is up for renewal, addressing their concerns about service quality while negotiating improved terms for the new contract.",
                        analysis: "• Purpose: Address concerns and negotiate\n• Tone: Formal and diplomatic\n• Structure: Acknowledgment, service improvements, value proposition, contract terms\n• Key elements: Relationship management, negotiation skills, value demonstration",
                        targetWords: 270,
                        timeLimit: 33
                    },
                    {
                        difficulty: 'hard',
                        task: "Your company is planning to merge with a competitor. Write an email to department heads explaining the merger rationale, timeline, and expected changes to their operations.",
                        analysis: "• Purpose: Strategic communication and change management\n• Tone: Formal and reassuring\n• Structure: Merger announcement, strategic rationale, timeline, operational impact, support measures\n• Key elements: Strategic communication, change management, leadership",
                        targetWords: 290,
                        timeLimit: 36
                    }
                ]
            },
            proposal: {
                formal: [
                    // Easy Proposal Tasks
                    {
                        difficulty: 'easy',
                        task: "Write a proposal to your manager requesting approval for a team-building workshop. Include the benefits, costs, and proposed timeline.",
                        analysis: "• Purpose: Request approval\n• Tone: Formal but persuasive\n• Structure: Introduction, benefits, costs, timeline, conclusion\n• Key elements: Clear benefits, justified costs, realistic timeline",
                        targetWords: 180,
                        timeLimit: 25
                    },
                    {
                        difficulty: 'easy',
                        task: "Propose the implementation of a flexible working hours policy for your department to improve work-life balance and productivity.",
                        analysis: "• Purpose: Propose policy change\n• Tone: Formal and persuasive\n• Structure: Current situation, proposed policy, benefits, implementation\n• Key elements: Employee benefits, productivity gains, practical implementation",
                        targetWords: 170,
                        timeLimit: 23
                    },
                    {
                        difficulty: 'easy',
                        task: "Write a proposal for upgrading the office coffee machine and break room facilities to improve employee satisfaction.",
                        analysis: "• Purpose: Request facility improvement\n• Tone: Formal but practical\n• Structure: Current situation, proposed improvements, costs, benefits\n• Key elements: Employee satisfaction, cost justification, practical benefits",
                        targetWords: 160,
                        timeLimit: 22
                    },
                    {
                        difficulty: 'easy',
                        task: "Propose organizing a monthly 'lunch and learn' session where employees can share knowledge and skills with colleagues.",
                        analysis: "• Purpose: Propose learning initiative\n• Tone: Formal and enthusiastic\n• Structure: Concept introduction, format details, benefits, resource requirements\n• Key elements: Knowledge sharing, professional development, team building",
                        targetWords: 165,
                        timeLimit: 23
                    },
                    {
                        difficulty: 'easy',
                        task: "Write a proposal to implement a paperless office initiative to reduce costs and environmental impact.",
                        analysis: "• Purpose: Propose environmental initiative\n• Tone: Formal and forward-thinking\n• Structure: Current paper usage, proposed changes, cost savings, environmental benefits\n• Key elements: Cost reduction, environmental responsibility, practical implementation",
                        targetWords: 175,
                        timeLimit: 24
                    },
                    
                    // Medium Proposal Tasks
                    {
                        difficulty: 'medium',
                        task: "Your department needs new project management software. Write a proposal comparing three options, including costs, features, and implementation requirements.",
                        analysis: "• Purpose: Compare and recommend\n• Tone: Formal and analytical\n• Structure: Introduction, comparison criteria, options analysis, recommendation\n• Key elements: Objective comparison, clear criteria, justified recommendation",
                        targetWords: 220,
                        timeLimit: 30
                    },
                    {
                        difficulty: 'medium',
                        task: "Propose the creation of a customer loyalty program to increase repeat business and improve customer retention rates.",
                        analysis: "• Purpose: Propose marketing strategy\n• Tone: Formal and strategic\n• Structure: Market analysis, program design, implementation plan, expected ROI\n• Key elements: Customer analysis, program structure, financial projections",
                        targetWords: 230,
                        timeLimit: 28
                    },
                    {
                        difficulty: 'medium',
                        task: "Write a proposal for establishing a mentorship program to support junior employees' professional development and improve retention.",
                        analysis: "• Purpose: Propose HR initiative\n• Tone: Formal and developmental\n• Structure: Current challenges, program structure, benefits, implementation timeline\n• Key elements: Professional development, employee retention, structured approach",
                        targetWords: 215,
                        timeLimit: 27
                    },
                    {
                        difficulty: 'medium',
                        task: "Propose implementing a quality management system (ISO 9001) to improve processes and enhance customer satisfaction.",
                        analysis: "• Purpose: Propose quality improvement\n• Tone: Formal and technical\n• Structure: Current quality issues, ISO benefits, implementation process, costs and timeline\n• Key elements: Quality standards, process improvement, certification benefits",
                        targetWords: 240,
                        timeLimit: 29
                    },
                    {
                        difficulty: 'medium',
                        task: "Write a proposal for expanding your company's social media presence to reach younger demographics and increase brand awareness.",
                        analysis: "• Purpose: Propose marketing expansion\n• Tone: Formal and modern\n• Structure: Market opportunity, platform strategy, content plan, resource requirements\n• Key elements: Target audience analysis, platform selection, content strategy",
                        targetWords: 225,
                        timeLimit: 28
                    },
                    
                    // Hard Proposal Tasks
                    {
                        difficulty: 'hard',
                        task: "Write a comprehensive proposal for restructuring your department to improve efficiency and reduce costs by 15%. Include current challenges, proposed changes, implementation plan, and expected outcomes.",
                        analysis: "• Purpose: Propose major organizational change\n• Tone: Formal and strategic\n• Structure: Current situation, proposed changes, implementation, benefits, risks\n• Key elements: Data-driven analysis, detailed plan, risk mitigation",
                        targetWords: 300,
                        timeLimit: 35
                    },
                    {
                        difficulty: 'hard',
                        task: "Propose the acquisition of a smaller competitor to expand market share and eliminate competition. Include financial analysis, integration plan, and risk assessment.",
                        analysis: "• Purpose: Strategic business proposal\n• Tone: Formal and analytical\n• Structure: Strategic rationale, financial analysis, integration strategy, risk management\n• Key elements: Strategic thinking, financial modeling, integration planning",
                        targetWords: 320,
                        timeLimit: 38
                    },
                    {
                        difficulty: 'hard',
                        task: "Write a proposal for implementing artificial intelligence and automation in your company's customer service operations to reduce costs and improve response times.",
                        analysis: "• Purpose: Technology transformation proposal\n• Tone: Formal and innovative\n• Structure: Current challenges, AI solution, implementation roadmap, ROI analysis\n• Key elements: Technology assessment, change management, financial justification",
                        targetWords: 310,
                        timeLimit: 37
                    },
                    {
                        difficulty: 'hard',
                        task: "Propose establishing international operations in three emerging markets to diversify revenue streams and reduce dependence on domestic sales.",
                        analysis: "• Purpose: International expansion proposal\n• Tone: Formal and strategic\n• Structure: Market analysis, expansion strategy, operational requirements, financial projections\n• Key elements: Market research, international strategy, risk assessment",
                        targetWords: 330,
                        timeLimit: 40
                    },
                    {
                        difficulty: 'hard',
                        task: "Write a proposal for implementing a comprehensive sustainability program that will make your company carbon-neutral within five years while maintaining profitability.",
                        analysis: "• Purpose: Sustainability strategy proposal\n• Tone: Formal and visionary\n• Structure: Environmental assessment, sustainability roadmap, cost-benefit analysis, stakeholder impact\n• Key elements: Environmental strategy, long-term planning, stakeholder management",
                        targetWords: 315,
                        timeLimit: 38
                    }
                ]
            },
            complaint: {
                formal: [
                    {
                        difficulty: 'easy',
                        task: "Write a complaint letter to a supplier about consistently late deliveries that are affecting your production schedule.",
                        analysis: "• Purpose: Express dissatisfaction and seek resolution\n• Tone: Formal but firm\n• Structure: Problem statement, impact description, expected resolution\n• Key elements: Specific examples, business impact, clear expectations",
                        targetWords: 150,
                        timeLimit: 20
                    },
                    {
                        difficulty: 'medium',
                        task: "Your company's internet service has been unreliable for weeks. Write a complaint letter to the service provider demanding compensation and improved service.",
                        analysis: "• Purpose: Demand service improvement and compensation\n• Tone: Formal and assertive\n• Structure: Service issues, business impact, compensation request, future expectations\n• Key elements: Documentation of problems, financial impact, specific demands",
                        targetWords: 200,
                        timeLimit: 25
                    },
                    {
                        difficulty: 'hard',
                        task: "Write a formal complaint to a business partner about breach of contract terms that has resulted in significant financial losses for your company.",
                        analysis: "• Purpose: Address contract breach and seek remedies\n• Tone: Formal and legal\n• Structure: Contract reference, breach details, financial impact, legal remedies sought\n• Key elements: Legal accuracy, financial documentation, remedy requests",
                        targetWords: 250,
                        timeLimit: 30
                    }
                ]
            },
            request: {
                formal: [
                    {
                        difficulty: 'easy',
                        task: "Write a letter requesting a reference from your former manager for a new job application.",
                        analysis: "• Purpose: Request professional reference\n• Tone: Formal and respectful\n• Structure: Introduction, request explanation, job details, appreciation\n• Key elements: Professional relationship, specific request, job relevance",
                        targetWords: 140,
                        timeLimit: 18
                    },
                    {
                        difficulty: 'medium',
                        task: "Request an extension of payment terms from a key supplier due to temporary cash flow challenges your company is experiencing.",
                        analysis: "• Purpose: Request payment flexibility\n• Tone: Formal and honest\n• Structure: Situation explanation, request details, repayment plan, relationship value\n• Key elements: Transparency, specific terms, commitment to payment",
                        targetWords: 190,
                        timeLimit: 24
                    },
                    {
                        difficulty: 'hard',
                        task: "Write a request to the city council for special permits to operate your business during extended hours for a major project deadline.",
                        analysis: "• Purpose: Request regulatory approval\n• Tone: Formal and official\n• Structure: Business need, permit requirements, community impact, compliance measures\n• Key elements: Regulatory compliance, community consideration, business justification",
                        targetWords: 230,
                        timeLimit: 28
                    }
                ]
            },
            application: {
                formal: [
                    {
                        difficulty: 'easy',
                        task: "Write a job application letter for a management position in your field, highlighting your relevant experience and qualifications.",
                        analysis: "• Purpose: Apply for position\n• Tone: Formal and confident\n• Structure: Introduction, qualifications, experience, closing\n• Key elements: Relevant skills, specific examples, enthusiasm",
                        targetWords: 180,
                        timeLimit: 23
                    },
                    {
                        difficulty: 'medium',
                        task: "Apply for membership in a professional business association, explaining how your membership would benefit both you and the organization.",
                        analysis: "• Purpose: Apply for membership\n• Tone: Formal and professional\n• Structure: Introduction, qualifications, mutual benefits, commitment\n• Key elements: Professional credentials, value proposition, networking goals",
                        targetWords: 200,
                        timeLimit: 25
                    },
                    {
                        difficulty: 'hard',
                        task: "Write an application for a government grant to fund your company's research and development project in sustainable technology.",
                        analysis: "• Purpose: Apply for funding\n• Tone: Formal and persuasive\n• Structure: Project overview, funding requirements, expected outcomes, societal benefits\n• Key elements: Technical details, financial planning, impact assessment",
                        targetWords: 280,
                        timeLimit: 33
                    }
                ]
            },
            report: {
                formal: [
                    {
                        difficulty: 'easy',
                        task: "Write a brief report on your department's quarterly performance, including key achievements and areas for improvement.",
                        analysis: "• Purpose: Report performance\n• Tone: Formal and objective\n• Structure: Executive summary, achievements, challenges, recommendations\n• Key elements: Data presentation, balanced assessment, actionable insights",
                        targetWords: 200,
                        timeLimit: 25
                    },
                    {
                        difficulty: 'medium',
                        task: "Prepare a market analysis report on emerging trends in your industry and their potential impact on your company's strategy.",
                        analysis: "• Purpose: Analyze market trends\n• Tone: Formal and analytical\n• Structure: Market overview, trend analysis, strategic implications, recommendations\n• Key elements: Market research, trend identification, strategic thinking",
                        targetWords: 250,
                        timeLimit: 30
                    },
                    {
                        difficulty: 'hard',
                        task: "Write a comprehensive feasibility report on opening a new branch office in another country, including market analysis, financial projections, and risk assessment.",
                        analysis: "• Purpose: Assess business feasibility\n• Tone: Formal and comprehensive\n• Structure: Market analysis, financial modeling, risk assessment, recommendations\n• Key elements: International business analysis, financial planning, risk management",
                        targetWords: 320,
                        timeLimit: 38
                    }
                ]
            }
        };

        // Random topic generators for additional variety
        const randomTopicGenerators = {
            businessChallenges: [
                "supply chain disruption",
                "digital transformation",
                "employee retention",
                "customer satisfaction decline",
                "market competition increase",
                "regulatory compliance changes",
                "technology upgrade needs",
                "cost reduction pressure",
                "quality control issues",
                "international expansion",
                "sustainability requirements",
                "data security concerns",
                "remote work management",
                "skills gap in workforce",
                "economic uncertainty"
            ],
            businessOpportunities: [
                "new market segment",
                "strategic partnership",
                "product innovation",
                "process automation",
                "customer experience enhancement",
                "brand expansion",
                "acquisition opportunity",
                "technology adoption",
                "sustainability initiative",
                "talent development program",
                "operational efficiency improvement",
                "digital marketing expansion",
                "international collaboration",
                "research and development project",
                "community engagement program"
            ],
            businessStakeholders: [
                "board of directors",
                "senior management team",
                "department heads",
                "project stakeholders",
                "key clients",
                "business partners",
                "regulatory authorities",
                "investor group",
                "supplier network",
                "employee representatives",
                "customer advisory board",
                "industry association",
                "local community leaders",
                "media representatives",
                "consultant team"
            ],
            businessContexts: [
                "quarterly review meeting",
                "annual strategic planning",
                "crisis management situation",
                "merger and acquisition",
                "product launch campaign",
                "budget planning cycle",
                "performance improvement initiative",
                "compliance audit preparation",
                "market expansion project",
                "technology implementation",
                "organizational restructuring",
                "customer retention program",
                "sustainability reporting",
                "risk management assessment",
                "innovation workshop"
            ]
        };

        // Default motivational messages
        const defaultMotivationalMessages = [
            "Excellence in writing comes from practice under pressure.",
            "Every word you write builds your professional communication skills.",
            "Clear, concise writing is the hallmark of effective leadership.",
            "Practice today, excel tomorrow in your IELTS exam.",
            "Strong writing skills open doors to global opportunities.",
            "Consistency in practice leads to confidence in performance.",
            "Your writing reflects your thinking - make both crystal clear.",
            "Time pressure reveals true writing mastery.",
            "Professional success starts with professional communication.",
            "Every practice session brings you closer to your goals."
        ];

        // Structure checklists by task type
        const structureChecklists = {
            email: [
                { id: 'greeting', text: 'Appropriate greeting (Dear Sir/Madam, etc.)' },
                { id: 'purpose', text: 'Clear statement of purpose in opening' },
                { id: 'body', text: 'Well-organized body paragraphs' },
                { id: 'closing', text: 'Professional closing (Yours faithfully, etc.)' },
                { id: 'signature', text: 'Appropriate sign-off with name' }
            ],
            proposal: [
                { id: 'title', text: 'Clear proposal title/subject' },
                { id: 'executive', text: 'Executive summary or introduction' },
                { id: 'problem', text: 'Problem statement or background' },
                { id: 'solution', text: 'Proposed solution or approach' },
                { id: 'benefits', text: 'Benefits and expected outcomes' },
                { id: 'implementation', text: 'Implementation plan or next steps' }
            ]
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            initializeVoiceRecognition();
            loadUserData();
            updateUI();
            checkDailyStreak();
        });

        function initializeApp() {
            // Check online status
            updateConnectionStatus();
            
            // Set up offline/online event listeners
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);
            
            // Initialize daily actions if empty
            if (appState.userData.dailyActions.length === 0) {
                generateDailyActions();
            }
            
            // Set random motivational message
            updateMotivationalMessage();
        }

        function setupEventListeners() {
            // Navigation
            document.getElementById('dashboardBtn').addEventListener('click', () => showView('dashboard'));
            document.getElementById('practiceBtn').addEventListener('click', () => showView('practice'));
            document.getElementById('analyticsBtn').addEventListener('click', () => showView('analytics'));
            document.getElementById('settingsBtn').addEventListener('click', () => showView('settings'));
            document.getElementById('backToDashboardBtn').addEventListener('click', () => showView('dashboard'));

            // Dashboard actions
            document.getElementById('newMotivationBtn').addEventListener('click', updateMotivationalMessage);
            document.getElementById('quickEmailBtn').addEventListener('click', () => startQuickPractice('email'));
            document.getElementById('quickProposalBtn').addEventListener('click', () => startQuickPractice('proposal'));
            document.getElementById('randomTaskBtn').addEventListener('click', () => startQuickPractice('random'));
            document.getElementById('newPracticeBtn').addEventListener('click', showNewPracticeModal);
            document.getElementById('addActionBtn').addEventListener('click', showAddActionModal);

            // Timer controls
            document.getElementById('startTimerBtn').addEventListener('click', toggleFocusTimer);
            document.getElementById('resetTimerBtn').addEventListener('click', resetFocusTimer);

            // Practice controls
            document.getElementById('voiceInputBtn').addEventListener('click', toggleVoiceInput);
            document.getElementById('clearWritingBtn').addEventListener('click', clearWriting);
            document.getElementById('savePracticeBtn').addEventListener('click', saveCurrentPractice);
            document.getElementById('exportPracticeBtn').addEventListener('click', exportPracticeToPdf);
            document.getElementById('analyzeWritingBtn').addEventListener('click', analyzeWriting);
            document.getElementById('doItNowBtn').addEventListener('click', executeDoItNow);
            document.getElementById('newTaskBtn').addEventListener('click', generateNewTask);

            // Modal controls
            document.getElementById('startPracticeBtn').addEventListener('click', startNewPractice);
            document.getElementById('cancelPracticeBtn').addEventListener('click', hideNewPracticeModal);
            document.getElementById('saveActionBtn').addEventListener('click', saveNewAction);
            document.getElementById('cancelActionBtn').addEventListener('click', hideAddActionModal);

            // Settings
            document.getElementById('backupBtn').addEventListener('click', backupData);
            document.getElementById('restoreBtn').addEventListener('click', () => document.getElementById('restoreFileInput').click());
            document.getElementById('restoreFileInput').addEventListener('change', restoreData);
            document.getElementById('clearDataBtn').addEventListener('click', clearAllData);
            document.getElementById('timerDurationSelect').addEventListener('change', updateTimerDuration);
            document.getElementById('defaultTaskSelect').addEventListener('change', updateDefaultTask);
            document.getElementById('autoSyncToggle').addEventListener('change', updateAutoSync);
            document.getElementById('soundToggle').addEventListener('change', updateSoundSettings);
            document.getElementById('addMessageBtn').addEventListener('click', addCustomMessage);

            // Writing area
            document.getElementById('writingArea').addEventListener('input', updateWordCount);
            document.getElementById('writingArea').addEventListener('input', updateProgress);

            // Tone control
            document.querySelectorAll('input[name="tone"]').forEach(radio => {
                radio.addEventListener('change', updateToneIndicator);
            });

            // Checklist items
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('coherence-check') || e.target.type === 'checkbox') {
                    updateProgress();
                }
            });
        }

        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                appState.voiceRecognition.recognition = new SpeechRecognition();
                appState.voiceRecognition.isSupported = true;

                const recognition = appState.voiceRecognition.recognition;
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    console.log('Voice recognition started');
                };

                recognition.onresult = function(event) {
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        }
                    }

                    if (finalTranscript) {
                        const writingArea = document.getElementById('writingArea');
                        writingArea.value += finalTranscript;
                        updateWordCount();
                        updateProgress();
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    showNotification('Voice recognition error: ' + event.error, 'error');
                    stopVoiceInput();
                };

                recognition.onend = function() {
                    if (appState.isRecording) {
                        try {
                            recognition.start();
                        } catch (e) {
                            console.log('Recognition restart failed:', e);
                            stopVoiceInput();
                        }
                    }
                };
            } else {
                appState.voiceRecognition.isSupported = false;
                console.log('Speech recognition not supported');
            }
        }

        function loadUserData() {
            const savedData = localStorage.getItem('ieltsManagerData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    appState.userData = { ...appState.userData, ...parsedData };
                } catch (e) {
                    console.error('Error loading user data:', e);
                }
            }
        }

        function saveUserData() {
            try {
                localStorage.setItem('ieltsManagerData', JSON.stringify(appState.userData));
                if (appState.userData.settings.autoSync && appState.isOnline) {
                    console.log('Auto-sync triggered');
                }
            } catch (e) {
                console.error('Error saving user data:', e);
                showNotification('Error saving data', 'error');
            }
        }

        function updateConnectionStatus() {
            appState.isOnline = navigator.onLine;
            const statusElement = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            if (appState.isOnline) {
                statusElement.className = 'offline-indicator online';
                statusText.textContent = 'Online';
            } else {
                statusElement.className = 'offline-indicator offline';
                statusText.textContent = 'Offline';
            }
        }

        function showView(viewName) {
            // Hide all views
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('practiceView').classList.add('hidden');
            document.getElementById('analyticsView').classList.add('hidden');
            document.getElementById('settingsView').classList.add('hidden');

            // Show selected view
            document.getElementById(viewName + 'View').classList.remove('hidden');
            appState.currentView = viewName;

            // Update navigation buttons
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('bg-light-green');
                btn.classList.add('bg-medium-green');
            });

            const activeBtn = document.getElementById(viewName + 'Btn');
            if (activeBtn) {
                activeBtn.classList.remove('bg-medium-green');
                activeBtn.classList.add('bg-light-green');
            }

            // Load view-specific data
            if (viewName === 'analytics') {
                updateAnalytics();
            } else if (viewName === 'settings') {
                loadSettings();
            }
        }

        function updateUI() {
            updateDashboard();
            updateStreak();
            updateFocusTimerDisplay();
        }

        function updateDashboard() {
            // Update recent practices
            const recentPracticesContainer = document.getElementById('recentSessions');
            const recentPractices = appState.userData.practices.slice(-5).reverse();

            if (recentPractices.length === 0) {
                recentPracticesContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">📝</div>
                        <p>No practice sessions yet. Start your first practice!</p>
                    </div>
                `;
            } else {
                recentPracticesContainer.innerHTML = recentPractices.map(practice => `
                    <div class="flex items-center justify-between p-4 bg-pale-gold rounded-lg border border-medium-gold">
                        <div>
                            <div class="font-semibold text-dark-green">${practice.title || practice.type}</div>
                            <div class="text-sm text-medium-green">
                                ${new Date(practice.date).toLocaleDateString()} • 
                                ${practice.wordCount} words • 
                                <span class="task-difficulty difficulty-${practice.difficulty}">${practice.difficulty}</span>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="reviewPractice('${practice.id}')" class="px-3 py-1 bg-accent-green text-white rounded text-sm hover:bg-medium-green transition-colors">
                                Review
                            </button>
                            <button onclick="deletePractice('${practice.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600 transition-colors">
                                Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            // Update daily actions
            updateDailyActions();
        }

        function updateDailyActions() {
            const dailyActionsContainer = document.getElementById('dailyActions');
            const actions = appState.userData.dailyActions;

            if (actions.length === 0) {
                dailyActionsContainer.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p class="text-sm">No goals for today</p>
                    </div>
                `;
            } else {
                dailyActionsContainer.innerHTML = actions.map(action => `
                    <div class="flex items-center justify-between p-3 bg-pale-gold rounded-lg border border-medium-gold">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" ${action.completed ? 'checked' : ''} 
                                   onchange="toggleAction('${action.id}')"
                                   class="rounded border-gray-300 text-medium-gold focus:ring-medium-gold">
                            <span class="text-sm ${action.completed ? 'line-through text-gray-500' : 'text-dark-green'}">${action.description}</span>
                            <span class="text-xs px-2 py-1 rounded ${getPriorityClass(action.priority)}">${action.priority}</span>
                        </div>
                        <button onclick="deleteAction('${action.id}')" class="text-red-500 hover:text-red-700 text-sm">
                            ✕
                        </button>
                    </div>
                `).join('');
            }
        }

        function getPriorityClass(priority) {
            switch (priority) {
                case 'high': return 'bg-red-100 text-red-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'low': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function updateStreak() {
            document.getElementById('currentStreak').textContent = appState.userData.streak;
        }

        function checkDailyStreak() {
            const today = new Date().toDateString();
            const lastActive = appState.userData.lastActiveDate;

            if (lastActive) {
                const lastActiveDate = new Date(lastActive).toDateString();
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayString = yesterday.toDateString();

                if (lastActiveDate === today) {
                    return;
                } else if (lastActiveDate === yesterdayString) {
                    return;
                } else {
                    appState.userData.streak = 0;
                }
            }

            appState.userData.lastActiveDate = today;
            saveUserData();
        }

        function updateMotivationalMessage() {
            const allMessages = [...defaultMotivationalMessages, ...appState.userData.customMessages];
            const randomMessage = allMessages[Math.floor(Math.random() * allMessages.length)];
            document.getElementById('motivationalMessage').textContent = randomMessage;
        }

        function generateDailyActions() {
            const defaultActions = [
                { description: "Complete 1 email writing practice", priority: "high" },
                { description: "Practice formal tone in business writing", priority: "medium" },
                { description: "Review coherence checklist", priority: "medium" },
                { description: "Write a proposal under time pressure", priority: "high" },
                { description: "Analyze writing structure", priority: "low" }
            ];

            const todayActions = defaultActions.slice(0, 3).map(action => ({
                id: generateId(),
                ...action,
                completed: false,
                date: new Date().toDateString()
            }));

            appState.userData.dailyActions = todayActions;
            saveUserData();
        }

        // Focus Timer Functions
        function toggleFocusTimer() {
            if (appState.focusTimer.isRunning) {
                pauseFocusTimer();
            } else {
                startFocusTimer();
            }
        }

        function startFocusTimer() {
            appState.focusTimer.isRunning = true;
            document.getElementById('startTimerBtn').textContent = 'Pause';
            
            appState.focusTimer.interval = setInterval(() => {
                appState.focusTimer.timeLeft--;
                updateFocusTimerDisplay();
                
                if (appState.focusTimer.timeLeft <= 0) {
                    completeFocusTimer();
                }
            }, 1000);
        }

        function pauseFocusTimer() {
            appState.focusTimer.isRunning = false;
            document.getElementById('startTimerBtn').textContent = 'Start';
            clearInterval(appState.focusTimer.interval);
        }

        function resetFocusTimer() {
            pauseFocusTimer();
            appState.focusTimer.timeLeft = appState.focusTimer.duration;
            updateFocusTimerDisplay();
        }

        function completeFocusTimer() {
            pauseFocusTimer();
            
            if (appState.userData.settings.soundNotifications) {
                playTimerAlert();
            }
            
            showNotification('Focus session completed! Great work!', 'success');
            
            appState.focusTimer.timeLeft = appState.focusTimer.duration;
            updateFocusTimerDisplay();
        }

        function updateFocusTimerDisplay() {
            const minutes = Math.floor(appState.focusTimer.timeLeft / 60);
            const seconds = appState.focusTimer.timeLeft % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timerDisplay').textContent = display;
            
            const progress = (appState.focusTimer.duration - appState.focusTimer.timeLeft) / appState.focusTimer.duration;
            const degrees = progress * 360;
            const timerCircle = document.getElementById('timerCircle');
            timerCircle.style.background = `conic-gradient(var(--medium-gold) ${degrees}deg, var(--pale-gold) ${degrees}deg)`;
        }

        function playTimerAlert() {
            const audio = document.getElementById('timerAlert');
            audio.play().catch(e => console.log('Could not play alert sound:', e));
        }

        // Practice Management
        function startQuickPractice(type) {
            let taskType = type;
            if (type === 'random') {
                const types = ['email', 'proposal'];
                taskType = types[Math.floor(Math.random() * types.length)];
            }
            
            const practiceData = {
                type: taskType,
                difficulty: 'medium',
                timeLimit: appState.userData.settings.timerDuration
            };
            
            createNewPractice(practiceData);
        }

        function showNewPracticeModal() {
            document.getElementById('newPracticeModal').classList.remove('hidden');
            document.getElementById('newPracticeModal').classList.add('flex');
        }

        function hideNewPracticeModal() {
            document.getElementById('newPracticeModal').classList.add('hidden');
            document.getElementById('newPracticeModal').classList.remove('flex');
        }

        function startNewPractice() {
            const type = document.getElementById('practiceTypeSelect').value;
            const difficulty = document.getElementById('difficultySelect').value;
            const timeLimit = parseInt(document.getElementById('timeLimitSelect').value);
            
            const practiceData = {
                type: type,
                difficulty: difficulty,
                timeLimit: timeLimit
            };
            
            createNewPractice(practiceData);
            hideNewPracticeModal();
        }

        function createNewPractice(practiceData) {
            const task = getRandomTask(practiceData.type, practiceData.difficulty);
            
            appState.currentPractice = {
                id: generateId(),
                ...practiceData,
                task: task,
                startTime: new Date(),
                content: '',
                wordCount: 0,
                checkedItems: []
            };
            
            showView('practice');
            loadPracticeData();
            
            if (practiceData.timeLimit > 0) {
                startPracticeTimer(practiceData.timeLimit);
            }
        }

        function getRandomTask(type, difficulty) {
            const tasks = taskTemplates[type]?.formal || [];
            const filteredTasks = tasks.filter(task => task.difficulty === difficulty);
            
            if (filteredTasks.length === 0) {
                return tasks[0] || getDefaultTask(type);
            }
            
            return filteredTasks[Math.floor(Math.random() * filteredTasks.length)];
        }

        function getDefaultTask(type) {
            return {
                difficulty: 'medium',
                task: `Write a professional ${type} addressing a business situation.`,
                analysis: "• Focus on clear structure\n• Use appropriate tone\n• Include all necessary elements",
                targetWords: 200,
                timeLimit: 25
            };
        }

        function loadPracticeData() {
            const practice = appState.currentPractice;
            const task = practice.task;
            
            // Update practice header
            document.getElementById('practiceTitle').textContent = `${practice.type.charAt(0).toUpperCase() + practice.type.slice(1)} Practice`;
            document.getElementById('taskDifficulty').textContent = practice.difficulty.charAt(0).toUpperCase() + practice.difficulty.slice(1);
            document.getElementById('taskDifficulty').className = `task-difficulty difficulty-${practice.difficulty}`;
            document.getElementById('taskType').textContent = practice.type.charAt(0).toUpperCase() + practice.type.slice(1);
            
            // Load task
            document.getElementById('taskDescription').innerHTML = `<p class="mb-4">${task.task}</p>`;
            document.getElementById('taskAnalysis').innerHTML = task.analysis.replace(/\n/g, '<br>');
            
            // Update target words
            document.getElementById('targetWords').textContent = task.targetWords;
            
            // Load structure checklist
            loadStructureChecklist(practice.type);
            
            // Reset writing area
            document.getElementById('writingArea').value = '';
            updateWordCount();
            updateProgress();
            
            // Reset tone to formal
            document.querySelector('input[name="tone"][value="formal"]').checked = true;
            updateToneIndicator();
        }

        function loadStructureChecklist(taskType) {
            const checklist = structureChecklists[taskType] || [];
            const container = document.getElementById('structureChecklist');
            
            container.innerHTML = checklist.map(item => `
                <div class="checklist-item">
                    <input type="checkbox" class="mr-3 structure-check" data-check="${item.id}">
                    <span class="text-sm">${item.text}</span>
                </div>
            `).join('');
        }

        function startPracticeTimer(minutes) {
            appState.practiceTimer.startTime = new Date();
            appState.practiceTimer.isRunning = true;
            
            const updateTimer = () => {
                const elapsed = Math.floor((new Date() - appState.practiceTimer.startTime) / 1000);
                const totalSeconds = minutes * 60;
                const remaining = Math.max(0, totalSeconds - elapsed);
                
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                document.getElementById('practiceTimer').textContent = 
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                if (remaining <= 0) {
                    completePracticeTimer();
                }
            };
            
            updateTimer();
            appState.practiceTimer.interval = setInterval(updateTimer, 1000);
        }

        function completePracticeTimer() {
            appState.practiceTimer.isRunning = false;
            clearInterval(appState.practiceTimer.interval);
            
            if (appState.userData.settings.soundNotifications) {
                playTimerAlert();
            }
            
            showNotification('Time\'s up! Review your writing and save your practice.', 'warning');
        }

        // Writing Functions
        function updateWordCount() {
            const writingArea = document.getElementById('writingArea');
            const text = writingArea.value.trim();
            const wordCount = text ? text.split(/\s+/).length : 0;
            
            document.getElementById('wordCount').textContent = wordCount;
            
            if (appState.currentPractice) {
                appState.currentPractice.wordCount = wordCount;
                appState.currentPractice.content = text;
            }
        }

        function updateProgress() {
            if (!appState.currentPractice) return;
            
            let progress = 0;
            let totalItems = 0;
            
            // Check word count progress (40% weight)
            const targetWords = appState.currentPractice.task.targetWords;
            const currentWords = appState.currentPractice.wordCount;
            const wordProgress = Math.min(currentWords / targetWords, 1) * 0.4;
            progress += wordProgress;
            totalItems += 0.4;
            
            // Check structure checklist (30% weight)
            const structureChecks = document.querySelectorAll('.structure-check:checked');
            const totalStructureChecks = document.querySelectorAll('.structure-check').length;
            if (totalStructureChecks > 0) {
                const structureProgress = (structureChecks.length / totalStructureChecks) * 0.3;
                progress += structureProgress;
            }
            totalItems += 0.3;
            
            // Check coherence checklist (30% weight)
            const coherenceChecks = document.querySelectorAll('.coherence-check:checked');
            const totalCoherenceChecks = document.querySelectorAll('.coherence-check').length;
            if (totalCoherenceChecks > 0) {
                const coherenceProgress = (coherenceChecks.length / totalCoherenceChecks) * 0.3;
                progress += coherenceProgress;
            }
            totalItems += 0.3;
            
            const progressPercentage = Math.round((progress / totalItems) * 100);
            
            document.getElementById('progressFill').style.width = `${progressPercentage}%`;
            document.getElementById('progressText').textContent = `${progressPercentage}% Complete`;
        }

        function updateToneIndicator() {
            const selectedTone = document.querySelector('input[name="tone"]:checked').value;
            const indicator = document.getElementById('toneIndicator');
            
            indicator.textContent = selectedTone.charAt(0).toUpperCase() + selectedTone.slice(1);
            indicator.className = `tone-indicator tone-${selectedTone}`;
        }

        function toggleVoiceInput() {
            if (!appState.voiceRecognition.isSupported) {
                showNotification('Voice recognition not supported in this browser', 'error');
                return;
            }
            
            if (appState.isRecording) {
                stopVoiceInput();
            } else {
                startVoiceInput();
            }
        }

        function startVoiceInput() {
            appState.isRecording = true;
            
            const voiceBtn = document.getElementById('voiceInputBtn');
            voiceBtn.classList.add('recording-pulse');
            voiceBtn.innerHTML = '⏹️ Stop';
            
            document.getElementById('voiceStatus').classList.remove('hidden');
            
            try {
                appState.voiceRecognition.recognition.start();
            } catch (e) {
                console.error('Error starting recognition:', e);
                stopVoiceInput();
                showNotification('Could not start voice recognition', 'error');
                return;
            }
            
            showNotification('Voice input started', 'success');
        }

        function stopVoiceInput() {
            appState.isRecording = false;
            
            const voiceBtn = document.getElementById('voiceInputBtn');
            voiceBtn.classList.remove('recording-pulse');
            voiceBtn.innerHTML = '🎤 Voice';
            
            document.getElementById('voiceStatus').classList.add('hidden');
            
            if (appState.voiceRecognition.recognition) {
                appState.voiceRecognition.recognition.stop();
            }
            
            showNotification('Voice input stopped', 'success');
        }

        function clearWriting() {
            if (confirm('Are you sure you want to clear all your writing?')) {
                document.getElementById('writingArea').value = '';
                updateWordCount();
                updateProgress();
            }
        }

        function analyzeWriting() {
            const writingArea = document.getElementById('writingArea');
            const text = writingArea.value.trim();
            
            if (!text) {
                showNotification('No text to analyze', 'warning');
                return;
            }
            
            const wordCount = text.split(/\s+/).length;
            const sentenceCount = text.split(/[.!?]+/).length - 1;
            const paragraphCount = text.split(/\n\s*\n/).length;
            const avgWordsPerSentence = sentenceCount > 0 ? Math.round(wordCount / sentenceCount) : 0;
            
            const analysis = `
                Writing Analysis:
                • Word count: ${wordCount}
                • Sentences: ${sentenceCount}
                • Paragraphs: ${paragraphCount}
                • Average words per sentence: ${avgWordsPerSentence}
                • Estimated reading time: ${Math.round(wordCount / 200)} minutes
            `;
            
            showNotification(analysis, 'info');
        }

        function generateNewTask() {
            if (appState.currentPractice) {
                let newTask;
                
                // 30% chance to generate a completely random task using topic generators
                if (Math.random() < 0.3) {
                    newTask = generateRandomTask(appState.currentPractice.type, appState.currentPractice.difficulty);
                } else {
                    newTask = getRandomTask(appState.currentPractice.type, appState.currentPractice.difficulty);
                }
                
                appState.currentPractice.task = newTask;
                
                document.getElementById('taskDescription').innerHTML = `<p class="mb-4">${newTask.task}</p>`;
                document.getElementById('taskAnalysis').innerHTML = newTask.analysis.replace(/\n/g, '<br>');
                document.getElementById('targetWords').textContent = newTask.targetWords;
                
                showNotification('New task generated!', 'success');
            }
        }

        function generateRandomTask(type, difficulty) {
            const challenge = randomTopicGenerators.businessChallenges[Math.floor(Math.random() * randomTopicGenerators.businessChallenges.length)];
            const opportunity = randomTopicGenerators.businessOpportunities[Math.floor(Math.random() * randomTopicGenerators.businessOpportunities.length)];
            const stakeholder = randomTopicGenerators.businessStakeholders[Math.floor(Math.random() * randomTopicGenerators.businessStakeholders.length)];
            const context = randomTopicGenerators.businessContexts[Math.floor(Math.random() * randomTopicGenerators.businessContexts.length)];
            
            let task, analysis, targetWords, timeLimit;
            
            // Generate task based on type and difficulty
            if (type === 'email') {
                if (difficulty === 'easy') {
                    task = `Write an email to ${stakeholder} regarding ${challenge} that your department is currently facing. Explain the situation and request their support or guidance.`;
                    analysis = "• Purpose: Request support\n• Tone: Formal and respectful\n• Structure: Situation explanation, impact description, support request\n• Key elements: Clear problem statement, specific request, professional tone";
                    targetWords = 140;
                    timeLimit = 18;
                } else if (difficulty === 'medium') {
                    task = `During ${context}, you've identified ${opportunity} for your company. Write an email to ${stakeholder} proposing this opportunity and outlining the potential benefits and next steps.`;
                    analysis = "• Purpose: Propose opportunity\n• Tone: Formal and persuasive\n• Structure: Opportunity introduction, benefits analysis, implementation steps\n• Key elements: Opportunity assessment, benefit articulation, action plan";
                    targetWords = 200;
                    timeLimit = 25;
                } else {
                    task = `Your company is dealing with ${challenge} while simultaneously pursuing ${opportunity}. Write an email to ${stakeholder} providing a comprehensive analysis of both situations and your strategic recommendations for moving forward.`;
                    analysis = "• Purpose: Strategic analysis and recommendation\n• Tone: Formal and analytical\n• Structure: Situation analysis, strategic assessment, recommendations, implementation\n• Key elements: Complex analysis, strategic thinking, balanced perspective";
                    targetWords = 280;
                    timeLimit = 33;
                }
            } else if (type === 'proposal') {
                if (difficulty === 'easy') {
                    task = `Write a proposal to address ${challenge} in your department by implementing ${opportunity}. Include the current situation, proposed solution, and expected benefits.`;
                    analysis = "• Purpose: Propose solution\n• Tone: Formal and solution-focused\n• Structure: Problem identification, solution proposal, benefits, implementation\n• Key elements: Problem-solution fit, clear benefits, practical approach";
                    targetWords = 170;
                    timeLimit = 23;
                } else if (difficulty === 'medium') {
                    task = `During ${context}, propose a comprehensive plan to ${stakeholder} for leveraging ${opportunity} while mitigating risks associated with ${challenge}. Include timeline, resources, and success metrics.`;
                    analysis = "• Purpose: Comprehensive planning proposal\n• Tone: Formal and strategic\n• Structure: Context analysis, opportunity assessment, risk mitigation, implementation plan\n• Key elements: Strategic planning, risk management, resource allocation";
                    targetWords = 230;
                    timeLimit = 28;
                } else {
                    task = `Write a strategic proposal for ${stakeholder} outlining how your organization can transform ${challenge} into ${opportunity} through ${context}. Include market analysis, competitive advantages, financial projections, and implementation roadmap.`;
                    analysis = "• Purpose: Strategic transformation proposal\n• Tone: Formal and visionary\n• Structure: Market analysis, transformation strategy, competitive positioning, financial modeling\n• Key elements: Strategic vision, market understanding, financial planning";
                    targetWords = 320;
                    timeLimit = 38;
                }
            } else {
                // Default fallback for other types
                task = `Write a ${type} addressing ${challenge} in the context of ${context}. Focus on providing clear analysis and actionable recommendations for ${stakeholder}.`;
                analysis = "• Purpose: Address business challenge\n• Tone: Formal and analytical\n• Structure: Problem analysis, recommendations, implementation\n• Key elements: Clear analysis, practical solutions, stakeholder focus";
                targetWords = difficulty === 'easy' ? 150 : difficulty === 'medium' ? 200 : 250;
                timeLimit = difficulty === 'easy' ? 20 : difficulty === 'medium' ? 25 : 30;
            }
            
            return {
                difficulty: difficulty,
                task: task,
                analysis: analysis,
                targetWords: targetWords,
                timeLimit: timeLimit,
                isRandomGenerated: true
            };
        }

        function saveCurrentPractice() {
            if (!appState.currentPractice) return;
            
            const practice = appState.currentPractice;
            practice.endTime = new Date();
            practice.duration = Math.floor((practice.endTime - practice.startTime) / 1000);
            practice.date = practice.startTime.toISOString();
            practice.title = `${practice.type.charAt(0).toUpperCase() + practice.type.slice(1)} Practice`;
            
            // Stop practice timer
            if (appState.practiceTimer.interval) {
                clearInterval(appState.practiceTimer.interval);
                appState.practiceTimer.isRunning = false;
            }
            
            // Calculate score based on progress
            const progressText = document.getElementById('progressText').textContent;
            const score = parseInt(progressText.replace('% Complete', ''));
            practice.score = score;
            
            // Add to user data
            appState.userData.practices.push(practice);
            appState.userData.totalPractices++;
            appState.userData.totalWords += practice.wordCount;
            
            // Update average score
            const totalScore = appState.userData.practices.reduce((sum, p) => sum + (p.score || 0), 0);
            appState.userData.averageScore = Math.round(totalScore / appState.userData.practices.length);
            
            // Update streak
            updatePracticeStreak();
            
            saveUserData();
            showNotification('Practice saved successfully', 'success');
        }

        function updatePracticeStreak() {
            const today = new Date().toDateString();
            const lastActive = appState.userData.lastActiveDate;
            
            if (lastActive !== today) {
                appState.userData.streak++;
                appState.userData.lastActiveDate = today;
                
                if (appState.userData.streak > appState.userData.longestStreak) {
                    appState.userData.longestStreak = appState.userData.streak;
                }
                
                updateStreak();
                saveUserData();
            }
        }

        function exportPracticeToPdf() {
            if (!appState.currentPractice) return;
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.text('IELTS Manager Pro - Practice Report', 20, 30);
                
                // Practice details
                doc.setFontSize(12);
                doc.text(`Task Type: ${appState.currentPractice.type}`, 20, 50);
                doc.text(`Difficulty: ${appState.currentPractice.difficulty}`, 20, 60);
                doc.text(`Date: ${new Date(appState.currentPractice.startTime).toLocaleDateString()}`, 20, 70);
                doc.text(`Word Count: ${appState.currentPractice.wordCount}`, 20, 80);
                doc.text(`Duration: ${Math.floor(appState.currentPractice.duration / 60)} minutes`, 20, 90);
                
                // Task
                doc.text('Task:', 20, 110);
                const taskText = doc.splitTextToSize(appState.currentPractice.task.task, 170);
                doc.text(taskText, 20, 120);
                
                // Response
                const responseY = 120 + (taskText.length * 5) + 20;
                doc.text('Response:', 20, responseY);
                const responseText = doc.splitTextToSize(appState.currentPractice.content || 'No response written', 170);
                doc.text(responseText, 20, responseY + 10);
                
                // Save
                doc.save(`ielts-practice-${appState.currentPractice.id}.pdf`);
                showNotification('PDF exported successfully', 'success');
            } catch (error) {
                console.error('PDF export error:', error);
                showNotification('Error exporting PDF', 'error');
            }
        }

        function executeDoItNow() {
            const actions = appState.userData.dailyActions.filter(action => !action.completed);
            
            if (actions.length === 0) {
                showNotification('All goals completed! Great work!', 'success');
                return;
            }
            
            const nextAction = actions[0];
            const confirmed = confirm(`Execute this goal now?\n\n"${nextAction.description}"`);
            
            if (confirmed) {
                toggleAction(nextAction.id);
                showNotification('Goal marked as completed!', 'success');
            }
        }

        // Daily Actions Management
        function showAddActionModal() {
            document.getElementById('addActionModal').classList.remove('hidden');
            document.getElementById('addActionModal').classList.add('flex');
        }

        function hideAddActionModal() {
            document.getElementById('addActionModal').classList.add('hidden');
            document.getElementById('addActionModal').classList.remove('flex');
            
            document.getElementById('actionDescInput').value = '';
            document.getElementById('actionPrioritySelect').value = 'medium';
        }

        function saveNewAction() {
            const description = document.getElementById('actionDescInput').value.trim();
            const priority = document.getElementById('actionPrioritySelect').value;
            
            if (!description) {
                showNotification('Please enter a goal description', 'warning');
                return;
            }
            
            const newAction = {
                id: generateId(),
                description: description,
                priority: priority,
                completed: false,
                date: new Date().toDateString()
            };
            
            appState.userData.dailyActions.push(newAction);
            saveUserData();
            updateDailyActions();
            hideAddActionModal();
            
            showNotification('Goal added successfully', 'success');
        }

        function toggleAction(actionId) {
            const action = appState.userData.dailyActions.find(a => a.id === actionId);
            if (action) {
                action.completed = !action.completed;
                saveUserData();
                updateDailyActions();
            }
        }

        function deleteAction(actionId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                appState.userData.dailyActions = appState.userData.dailyActions.filter(a => a.id !== actionId);
                saveUserData();
                updateDailyActions();
                showNotification('Goal deleted', 'success');
            }
        }

        // Practice Management Functions
        function reviewPractice(practiceId) {
            const practice = appState.userData.practices.find(p => p.id === practiceId);
            if (practice) {
                appState.currentPractice = practice;
                showView('practice');
                loadPracticeData();
                
                if (practice.content) {
                    document.getElementById('writingArea').value = practice.content;
                    updateWordCount();
                }
            }
        }

        function deletePractice(practiceId) {
            if (confirm('Are you sure you want to delete this practice session?')) {
                appState.userData.practices = appState.userData.practices.filter(p => p.id !== practiceId);
                appState.userData.totalPractices = appState.userData.practices.length;
                
                appState.userData.totalWords = appState.userData.practices.reduce((total, practice) => {
                    return total + (practice.wordCount || 0);
                }, 0);
                
                const totalScore = appState.userData.practices.reduce((sum, p) => sum + (p.score || 0), 0);
                appState.userData.averageScore = appState.userData.practices.length > 0 ? 
                    Math.round(totalScore / appState.userData.practices.length) : 0;
                
                saveUserData();
                updateDashboard();
                showNotification('Practice session deleted', 'success');
            }
        }

        // Analytics Functions
        function updateAnalytics() {
            document.getElementById('totalPractices').textContent = appState.userData.totalPractices;
            document.getElementById('totalWords').textContent = appState.userData.totalWords.toLocaleString();
            document.getElementById('averageScore').textContent = Math.round(appState.userData.averageScore) + '%';
            document.getElementById('longestStreak').textContent = appState.userData.longestStreak;
        }

        // Settings Functions
        function loadSettings() {
            document.getElementById('timerDurationSelect').value = appState.userData.settings.timerDuration;
            document.getElementById('defaultTaskSelect').value = appState.userData.settings.defaultTaskType;
            document.getElementById('autoSyncToggle').checked = appState.userData.settings.autoSync;
            document.getElementById('soundToggle').checked = appState.userData.settings.soundNotifications;
            
            loadCustomMessages();
        }

        function updateTimerDuration() {
            const duration = parseInt(document.getElementById('timerDurationSelect').value);
            appState.userData.settings.timerDuration = duration;
            appState.focusTimer.duration = duration * 60;
            appState.focusTimer.timeLeft = duration * 60;
            updateFocusTimerDisplay();
            saveUserData();
        }

        function updateDefaultTask() {
            appState.userData.settings.defaultTaskType = document.getElementById('defaultTaskSelect').value;
            saveUserData();
        }

        function updateAutoSync() {
            appState.userData.settings.autoSync = document.getElementById('autoSyncToggle').checked;
            saveUserData();
        }

        function updateSoundSettings() {
            appState.userData.settings.soundNotifications = document.getElementById('soundToggle').checked;
            saveUserData();
        }

        function addCustomMessage() {
            const messageInput = document.getElementById('customMessageInput');
            const message = messageInput.value.trim();
            
            if (!message) {
                showNotification('Please enter a message', 'warning');
                return;
            }
            
            appState.userData.customMessages.push(message);
            messageInput.value = '';
            saveUserData();
            loadCustomMessages();
            
            showNotification('Custom message added', 'success');
        }

        function loadCustomMessages() {
            const container = document.getElementById('customMessages');
            const messages = appState.userData.customMessages;
            
            if (messages.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No custom messages yet</p>';
            } else {
                container.innerHTML = messages.map((message, index) => `
                    <div class="flex items-center justify-between p-3 bg-pale-gold rounded-lg border border-medium-gold">
                        <span class="text-sm text-dark-green">${message}</span>
                        <button onclick="deleteCustomMessage(${index})" class="text-red-500 hover:text-red-700 text-sm">
                            ✕
                        </button>
                    </div>
                `).join('');
            }
        }

        function deleteCustomMessage(index) {
            if (confirm('Are you sure you want to delete this message?')) {
                appState.userData.customMessages.splice(index, 1);
                saveUserData();
                loadCustomMessages();
                showNotification('Message deleted', 'success');
            }
        }

        // Data Management Functions
        function backupData() {
            try {
                const dataStr = JSON.stringify(appState.userData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `ielts-manager-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showNotification('Data backup downloaded', 'success');
            } catch (error) {
                console.error('Backup error:', error);
                showNotification('Error creating backup', 'error');
            }
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all current data. Are you sure?')) {
                        appState.userData = { ...appState.userData, ...data };
                        saveUserData();
                        updateUI();
                        showNotification('Data restored successfully', 'success');
                    }
                } catch (error) {
                    console.error('Restore error:', error);
                    showNotification('Error restoring data', 'error');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        function clearAllData() {
            const confirmed = confirm('This will permanently delete all your data. Are you sure?');
            if (confirmed) {
                const doubleConfirm = confirm('This action cannot be undone. Are you absolutely sure?');
                if (doubleConfirm) {
                    localStorage.removeItem('ieltsManagerData');
                    
                    appState.userData = {
                        practices: [],
                        dailyActions: [],
                        customMessages: [],
                        streak: 0,
                        lastActiveDate: null,
                        totalPractices: 0,
                        totalWords: 0,
                        averageScore: 0,
                        longestStreak: 0,
                        settings: {
                            timerDuration: 20,
                            defaultTaskType: 'email',
                            autoSync: true,
                            soundNotifications: true
                        }
                    };
                    
                    generateDailyActions();
                    updateUI();
                    showNotification('All data cleared', 'success');
                }
            }
        }

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 fade-in ${
                type === 'error' ? 'bg-red-600 text-white' : 
                type === 'warning' ? 'bg-yellow-600 text-white' : 
                type === 'info' ? 'bg-blue-600 text-white' :
                'bg-green-600 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Initialize focus timer display
        document.addEventListener('DOMContentLoaded', function() {
            updateFocusTimerDisplay();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'987382f4605bb9fb',t:'MTc1OTIzMzExOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OET Nursing Speaking Practice - Patient Care Communication</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        :root {
            --primary-green: #1e3a2e;
            --medium-green: #2d5a3d;
            --light-green: #4a7c59;
            --accent-green: #6b9080;
            --primary-gold: #d4af37;
            --medium-gold: #b8941f;
            --light-gold: #f4e4a6;
            --pale-gold: #faf6e8;
        }
        
        .bg-primary-green { background-color: var(--primary-green); }
        .bg-medium-green { background-color: var(--medium-green); }
        .bg-light-green { background-color: var(--light-green); }
        .bg-accent-green { background-color: var(--accent-green); }
        .bg-primary-gold { background-color: var(--primary-gold); }
        .bg-medium-gold { background-color: var(--medium-gold); }
        .bg-light-gold { background-color: var(--light-gold); }
        .bg-pale-gold { background-color: var(--pale-gold); }
        
        .text-primary-green { color: var(--primary-green); }
        .text-medium-green { color: var(--medium-green); }
        .text-primary-gold { color: var(--primary-gold); }
        .text-medium-gold { color: var(--medium-gold); }
        
        .border-primary-green { border-color: var(--primary-green); }
        .border-primary-gold { border-color: var(--primary-gold); }
        
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .recording-pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .scenario-card {
            background: linear-gradient(135deg, var(--pale-gold) 0%, #ffffff 100%);
            border: 2px solid var(--light-gold);
            transition: all 0.3s ease;
        }
        
        .scenario-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
            border-color: var(--primary-gold);
        }
        
        .nursing-badge {
            background: linear-gradient(45deg, var(--medium-green), var(--light-green));
            color: white;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .score-band {
            height: 8px;
            border-radius: 4px;
            transition: width 0.8s ease;
        }
        
        .band-1 { background: linear-gradient(90deg, #dc2626, #ef4444); }
        .band-2 { background: linear-gradient(90deg, #ea580c, #f97316); }
        .band-3 { background: linear-gradient(90deg, #ca8a04, #eab308); }
        .band-4 { background: linear-gradient(90deg, #16a34a, #22c55e); }
        .band-5 { background: linear-gradient(90deg, #059669, #10b981); }
        
        .phrase-card {
            background: linear-gradient(135deg, var(--pale-gold) 0%, #f8fafc 100%);
            border: 1px solid var(--light-gold);
            transition: all 0.3s ease;
        }
        
        .phrase-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.15);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
            background: rgba(30, 58, 46, 0.7);
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .nursing-input {
            border: 2px solid var(--light-gold);
            border-radius: 8px;
            padding: 12px;
            transition: border-color 0.3s ease;
        }
        
        .nursing-input:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .patient-dialogue {
            background: linear-gradient(135deg, var(--medium-green) 0%, var(--light-green) 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            position: relative;
        }
        
        .patient-dialogue::before {
            content: 'ü§í';
            position: absolute;
            top: -10px;
            left: 20px;
            background: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .nurse-response {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--medium-gold) 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            position: relative;
        }
        
        .nurse-response::before {
            content: 'üë©‚Äç‚öïÔ∏è';
            position: absolute;
            top: -10px;
            right: 20px;
            background: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .empathy-highlight {
            background: linear-gradient(45deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--primary-gold);
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
        }
        
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-primary-green text-white shadow-xl">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-14 h-14 bg-primary-gold rounded-full flex items-center justify-center">
                        <span class="text-2xl">üë©‚Äç‚öïÔ∏è</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold">OET Nursing Speaking Practice</h1>
                        <p class="text-accent-green font-medium">Patient Education ‚Ä¢ Empathy ‚Ä¢ Discharge Instructions</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <div class="text-sm text-accent-green">Practice Sessions</div>
                        <div class="text-2xl font-bold text-primary-gold" id="totalSessions">0</div>
                    </div>
                    <button id="createScenarioBtn" class="bg-medium-gold hover:bg-primary-gold px-4 py-2 rounded-lg transition-colors font-semibold mr-3">
                        ‚ûï Create Scenario
                    </button>
                    <button id="phraseBankBtn" class="bg-medium-gold hover:bg-primary-gold px-4 py-2 rounded-lg transition-colors font-semibold">
                        üí¨ Phrase Bank
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Scenario Selection -->
        <div id="scenarioSelection" class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-primary-green mb-8 text-center">Choose Your Nursing Scenario</h2>
            
            <!-- Scenario Categories -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                <h3 class="text-xl font-bold text-primary-green mb-4">Practice Areas</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    <button class="category-btn bg-medium-gold text-white px-4 py-3 rounded-lg hover:bg-primary-gold transition-colors font-semibold" data-category="all">
                        üé≤ All Scenarios
                    </button>
                    <button class="category-btn bg-light-green text-white px-4 py-3 rounded-lg hover:bg-medium-green transition-colors" data-category="patient-education">
                        üìö Patient Education
                    </button>
                    <button class="category-btn bg-light-green text-white px-4 py-3 rounded-lg hover:bg-medium-green transition-colors" data-category="discharge-planning">
                        üè† Discharge Planning
                    </button>
                    <button class="category-btn bg-light-green text-white px-4 py-3 rounded-lg hover:bg-medium-green transition-colors" data-category="medication-management">
                        üíä Medication Management
                    </button>
                    <button class="category-btn bg-light-green text-white px-4 py-3 rounded-lg hover:bg-medium-green transition-colors" data-category="emotional-support">
                        üíù Emotional Support
                    </button>
                    <button class="category-btn bg-light-green text-white px-4 py-3 rounded-lg hover:bg-medium-green transition-colors" data-category="family-communication">
                        üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Communication
                    </button>
                    <button class="category-btn bg-light-green text-white px-4 py-3 rounded-lg hover:bg-medium-green transition-colors" data-category="pain-management">
                        ü©π Pain Management
                    </button>
                    <button class="category-btn bg-light-green text-white px-4 py-3 rounded-lg hover:bg-medium-green transition-colors" data-category="post-operative">
                        üè• Post-Operative Care
                    </button>
                </div>
            </div>

            <!-- Available Scenarios -->
            <div id="scenariosContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Scenarios will be populated here -->
            </div>
        </div>

        <!-- Active Role-Play -->
        <div id="activeRolePlay" class="hidden max-w-6xl mx-auto">
            <!-- Role-Play Header -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-primary-green" id="scenarioTitle">Nursing Communication Practice</h2>
                        <div class="flex items-center space-x-4 mt-2">
                            <span class="nursing-badge" id="scenarioCategory">Patient Education</span>
                            <span class="text-sm text-gray-600">Phase: <span id="currentPhase">Preparation</span></span>
                            <span class="text-sm text-gray-600">Time: <span class="timer-display text-primary-gold" id="phaseTimer">5:00</span></span>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="pauseBtn" class="bg-medium-gold text-white px-4 py-2 rounded-lg hover:bg-primary-gold transition-colors">
                            ‚è∏Ô∏è Pause
                        </button>
                        <button id="endRolePlayBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                            üõë End
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Scenario Information -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Patient Information -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-lg font-bold text-primary-green mb-4">üë§ Patient Information</h3>
                        <div class="bg-pale-gold p-4 rounded-lg border-l-4 border-primary-gold">
                            <div id="patientInfo">Loading scenario...</div>
                        </div>
                    </div>

                    <!-- Key Phrases -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-lg font-bold text-primary-green mb-4">üí° Key Phrases</h3>
                        <div class="space-y-3" id="keyPhrases">
                            <!-- Key phrases will be populated here -->
                        </div>
                    </div>

                    <!-- Empathy Guidelines -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-lg font-bold text-primary-green mb-4">üíù Empathy Guidelines</h3>
                        <div class="space-y-3">
                            <div class="empathy-highlight">
                                <div class="font-semibold text-primary-green text-sm">Active Listening</div>
                                <div class="text-xs text-medium-green mt-1">Use reflective responses and acknowledge feelings</div>
                            </div>
                            <div class="empathy-highlight">
                                <div class="font-semibold text-primary-green text-sm">Validation</div>
                                <div class="text-xs text-medium-green mt-1">Normalize concerns and validate emotions</div>
                            </div>
                            <div class="empathy-highlight">
                                <div class="font-semibold text-primary-green text-sm">Reassurance</div>
                                <div class="text-xs text-medium-green mt-1">Provide comfort while being realistic</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Role-Play Area -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Phase 1: Preparation -->
                    <div id="preparationPhase" class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-primary-green mb-4">üìã Preparation Phase</h3>
                        
                        <div class="mb-6">
                            <h4 class="font-semibold text-primary-green mb-3">Scenario Context</h4>
                            <div id="scenarioContext" class="bg-light-gold p-4 rounded-lg">
                                <!-- Context will be loaded here -->
                            </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="font-semibold text-primary-green mb-3">Your Objectives</h4>
                            <div id="nursingObjectives" class="space-y-2">
                                <!-- Objectives will be loaded here -->
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-primary-green mb-2">Preparation Notes</label>
                            <textarea id="preparationNotes" class="nursing-input w-full h-24 resize-none" placeholder="Write your key points and approach for this conversation..."></textarea>
                        </div>

                        <button id="startRolePlay" class="w-full bg-medium-green text-white py-3 rounded-lg hover:bg-primary-green transition-colors font-semibold">
                            üé¨ Start Role-Play ‚Üí
                        </button>
                    </div>

                    <!-- Phase 2: Role-Play Conversation -->
                    <div id="conversationPhase" class="bg-white p-6 rounded-xl shadow-lg hidden">
                        <h3 class="text-xl font-bold text-primary-green mb-4">üó£Ô∏è Patient Conversation</h3>
                        
                        <!-- Conversation Area -->
                        <div id="conversationArea" class="mb-6 max-h-96 overflow-y-auto">
                            <!-- Conversation will be populated here -->
                        </div>

                        <!-- Response Controls -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-primary-green mb-2">Your Response</label>
                                <textarea id="nurseResponse" class="nursing-input w-full h-24 resize-none" placeholder="Type your response to the patient..."></textarea>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button id="recordResponse" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-semibold">
                                    üé§ Record Response
                                </button>
                                <button id="stopRecording" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors font-semibold hidden">
                                    ‚èπÔ∏è Stop Recording
                                </button>
                                <button id="submitResponse" class="flex-1 bg-primary-gold text-white py-3 rounded-lg hover:bg-medium-gold transition-colors font-semibold">
                                    Send Response ‚Üí
                                </button>
                            </div>
                            
                            <div id="recordingStatus" class="text-center text-sm text-gray-600"></div>
                        </div>
                    </div>

                    <!-- Phase 3: Feedback & Assessment -->
                    <div id="feedbackPhase" class="bg-white p-6 rounded-xl shadow-lg hidden">
                        <h3 class="text-xl font-bold text-primary-green mb-6">üìä Communication Assessment</h3>
                        
                        <!-- OET Criteria Scores -->
                        <div class="mb-8">
                            <h4 class="text-lg font-semibold text-primary-green mb-4">OET Speaking Criteria</h4>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700">Linguistic Resources</span>
                                        <span class="text-sm font-bold text-primary-gold" id="linguisticBand">Band 0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="score-band h-2 rounded-full" id="linguisticBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700">Appropriateness of Language</span>
                                        <span class="text-sm font-bold text-primary-gold" id="appropriatenessBand">Band 0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="score-band h-2 rounded-full" id="appropriatenessBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700">Discourse Management</span>
                                        <span class="text-sm font-bold text-primary-gold" id="discourseBand">Band 0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="score-band h-2 rounded-full" id="discourseBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-700">Intelligibility</span>
                                        <span class="text-sm font-bold text-primary-gold" id="intelligibilityBand">Band 0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="score-band h-2 rounded-full" id="intelligibilityBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Strengths & Areas for Improvement -->
                        <div class="mb-8">
                            <h4 class="text-lg font-semibold text-primary-green mb-4">üìù Detailed Feedback</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-semibold text-green-700 mb-3">‚úÖ Strengths</h5>
                                    <div id="strengths" class="space-y-2">
                                        <!-- Strengths will be populated here -->
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-orange-700 mb-3">üéØ Areas for Improvement</h5>
                                    <div id="improvements" class="space-y-2">
                                        <!-- Improvements will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recommended Phrases -->
                        <div class="mb-8">
                            <h4 class="text-lg font-semibold text-primary-green mb-4">üí¨ Recommended Phrases for Practice</h4>
                            <div id="recommendedPhrases" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <!-- Recommended phrases will be populated here -->
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex space-x-4">
                            <button id="exportReport" class="flex-1 bg-primary-gold text-white py-3 rounded-lg hover:bg-medium-gold transition-colors font-semibold">
                                üìÑ Export Report
                            </button>
                            <button id="newScenario" class="flex-1 bg-medium-green text-white py-3 rounded-lg hover:bg-primary-green transition-colors font-semibold">
                                üîÑ New Scenario
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Create Scenario Modal -->
    <div id="createScenarioModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-primary-green mb-6">Create Custom Nursing Scenario</h3>
            
            <form id="createScenarioForm" class="space-y-6">
                <!-- Basic Information -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-primary-green mb-2">Scenario Title *</label>
                        <input type="text" id="newScenarioTitle" class="nursing-input w-full" placeholder="e.g., Post-Surgery Discharge Education" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-primary-green mb-2">Category *</label>
                        <select id="newScenarioCategory" class="nursing-input w-full" required>
                            <option value="">Select category...</option>
                            <option value="patient-education">Patient Education</option>
                            <option value="discharge-planning">Discharge Planning</option>
                            <option value="medication-management">Medication Management</option>
                            <option value="emotional-support">Emotional Support</option>
                            <option value="family-communication">Family Communication</option>
                            <option value="pain-management">Pain Management</option>
                            <option value="post-operative">Post-Operative Care</option>
                        </select>
                    </div>
                </div>

                <!-- Patient Information -->
                <div>
                    <label class="block text-sm font-semibold text-primary-green mb-2">Patient Information *</label>
                    <textarea id="newPatientInfo" class="nursing-input w-full h-24 resize-none" placeholder="Describe the patient's background, condition, and current situation..." required></textarea>
                </div>

                <!-- Scenario Context -->
                <div>
                    <label class="block text-sm font-semibold text-primary-green mb-2">Scenario Context *</label>
                    <textarea id="newScenarioContext" class="nursing-input w-full h-24 resize-none" placeholder="Set the scene - where does this conversation take place and what's the situation?" required></textarea>
                </div>

                <!-- Nursing Objectives -->
                <div>
                    <label class="block text-sm font-semibold text-primary-green mb-2">Nursing Objectives *</label>
                    <div id="objectivesList" class="space-y-2 mb-3">
                        <div class="flex items-center space-x-2">
                            <input type="text" class="nursing-input flex-1 text-sm objective-input" placeholder="Enter nursing objective...">
                            <button type="button" onclick="removeObjective(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">‚úï</button>
                        </div>
                    </div>
                    <button type="button" id="addObjective" class="bg-light-green text-white px-4 py-2 rounded-lg hover:bg-medium-green transition-colors text-sm">
                        + Add Objective
                    </button>
                </div>

                <!-- Patient Dialogue -->
                <div>
                    <label class="block text-sm font-semibold text-primary-green mb-2">Patient Dialogue Points *</label>
                    <div id="dialogueList" class="space-y-2 mb-3">
                        <div class="flex items-center space-x-2">
                            <input type="text" class="nursing-input flex-1 text-sm dialogue-input" placeholder="Enter what the patient might say...">
                            <button type="button" onclick="removeDialogue(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">‚úï</button>
                        </div>
                    </div>
                    <button type="button" id="addDialogue" class="bg-light-green text-white px-4 py-2 rounded-lg hover:bg-medium-green transition-colors text-sm">
                        + Add Dialogue
                    </button>
                </div>

                <!-- Key Phrases -->
                <div>
                    <label class="block text-sm font-semibold text-primary-green mb-2">Key Phrases for This Scenario</label>
                    <div id="keyPhrasesList" class="space-y-2 mb-3">
                        <div class="flex items-center space-x-2">
                            <input type="text" class="nursing-input flex-1 text-sm key-phrase-input" placeholder="Enter key nursing phrase...">
                            <button type="button" onclick="removeKeyPhrase(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">‚úï</button>
                        </div>
                    </div>
                    <button type="button" id="addKeyPhrase" class="bg-light-green text-white px-4 py-2 rounded-lg hover:bg-medium-green transition-colors text-sm">
                        + Add Phrase
                    </button>
                </div>
            </form>

            <div class="flex space-x-4 mt-8 pt-6 border-t border-gray-200">
                <button id="saveScenario" class="flex-1 bg-primary-gold text-white py-3 rounded-lg hover:bg-medium-gold transition-colors font-semibold">
                    üíæ Save Scenario
                </button>
                <button id="previewScenario" class="px-6 py-3 bg-medium-green text-white rounded-lg hover:bg-primary-green transition-colors">
                    üëÅÔ∏è Preview
                </button>
                <button id="closeCreateScenario" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Phrase Bank Modal -->
    <div id="phraseBankModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-primary-green mb-6">Nursing Communication Phrase Bank</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="phraseBankContent">
                <!-- Phrase bank content will be populated here -->
            </div>

            <div class="flex justify-center mt-8 pt-6 border-t border-gray-200">
                <button id="closePhraseBank" class="px-8 py-3 bg-medium-green text-white rounded-lg hover:bg-primary-green transition-colors">
                    Close Phrase Bank
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state management
        let appState = {
            currentScenario: null,
            currentPhase: 'selection',
            selectedCategory: 'all',
            timer: null,
            timeRemaining: 300, // 5 minutes default
            isRecording: false,
            mediaRecorder: null,
            recordedChunks: [],
            conversationHistory: [],
            
            // Performance tracking
            completedSessions: JSON.parse(localStorage.getItem('nursing_sessions') || '[]'),
            currentSession: {
                startTime: null,
                preparationNotes: '',
                responses: [],
                recordings: [],
                scores: {},
                feedback: {}
            }
        };

        // Nursing scenario database
        const nursingScenarios = {
            'patient-education': [
                {
                    id: 'edu_001',
                    title: 'Diabetes Self-Management Education',
                    category: 'patient-education',
                    patientInfo: 'Mrs. Sarah Chen, 58 years old, newly diagnosed with Type 2 diabetes. She seems overwhelmed and worried about lifestyle changes. She works full-time and has two teenage children.',
                    context: 'You are providing diabetes education before discharge. Mrs. Chen has expressed concerns about managing her condition while maintaining her busy lifestyle.',
                    objectives: [
                        'Explain blood glucose monitoring in simple terms',
                        'Discuss dietary modifications and meal planning',
                        'Address her concerns about lifestyle changes',
                        'Ensure she understands medication timing',
                        'Provide emotional support and reassurance'
                    ],
                    patientDialogue: [
                        'I don\'t understand how I got diabetes. I\'m not even that overweight.',
                        'How am I supposed to check my blood sugar at work? It\'s embarrassing.',
                        'My kids love pasta and rice. Do I have to stop cooking these foods?',
                        'What if I forget to take my medication? Will something bad happen?',
                        'I\'m scared this will get worse no matter what I do.'
                    ],
                    keyPhrases: [
                        'I understand this feels overwhelming right now',
                        'Many people successfully manage diabetes while working full-time',
                        'Let\'s break this down into manageable steps',
                        'You\'re not alone in this journey',
                        'Small changes can make a big difference'
                    ]
                },
                {
                    id: 'edu_002',
                    title: 'Heart Failure Lifestyle Education',
                    category: 'patient-education',
                    patientInfo: 'Mr. Robert Johnson, 72 years old, diagnosed with heart failure. He lives alone and is concerned about managing his condition independently. He has a history of not following medical advice.',
                    context: 'You are educating Mr. Johnson about heart failure management before his discharge. He has been non-compliant with medications in the past.',
                    objectives: [
                        'Explain the importance of daily weight monitoring',
                        'Discuss fluid and sodium restrictions',
                        'Emphasize medication compliance',
                        'Teach recognition of worsening symptoms',
                        'Build motivation for lifestyle changes'
                    ],
                    patientDialogue: [
                        'I\'ve been fine without taking pills regularly before.',
                        'Why do I need to weigh myself every day? That seems excessive.',
                        'I can\'t give up my coffee and the foods I enjoy.',
                        'How will I know if my condition is getting worse?',
                        'Living alone makes all of this seem impossible.'
                    ],
                    keyPhrases: [
                        'Your heart needs extra support right now',
                        'These changes will help you feel stronger',
                        'I\'ll help you create a routine that works for you',
                        'Let\'s identify warning signs together',
                        'You have more control over this than you think'
                    ]
                }
            ],
            'discharge-planning': [
                {
                    id: 'dis_001',
                    title: 'Post-Surgical Hip Replacement Discharge',
                    category: 'discharge-planning',
                    patientInfo: 'Mrs. Margaret Williams, 68 years old, had a total hip replacement 3 days ago. She lives in a two-story house with her husband who has mobility issues. She\'s anxious about managing at home.',
                    context: 'You are preparing Mrs. Williams for discharge home. She needs comprehensive instructions about mobility, wound care, and safety precautions.',
                    objectives: [
                        'Review hip precautions and movement restrictions',
                        'Explain wound care and infection prevention',
                        'Discuss pain management strategies',
                        'Arrange appropriate home support services',
                        'Address safety concerns about home environment'
                    ],
                    patientDialogue: [
                        'I\'m worried about falling at home. Our house has so many stairs.',
                        'How will I shower safely? I\'m scared of slipping.',
                        'My husband can\'t help me much. He has arthritis in his hands.',
                        'When can I drive again? I have a doctor\'s appointment next week.',
                        'The pain medication makes me feel dizzy and confused.'
                    ],
                    keyPhrases: [
                        'Your safety at home is our top priority',
                        'We\'ll arrange support to help you during recovery',
                        'These precautions are temporary but very important',
                        'Let\'s problem-solve these challenges together',
                        'Recovery takes time, and that\'s completely normal'
                    ]
                }
            ],
            'medication-management': [
                {
                    id: 'med_001',
                    title: 'Complex Medication Regimen Education',
                    category: 'medication-management',
                    patientInfo: 'Mr. David Park, 75 years old, has multiple chronic conditions requiring 8 different medications. He lives alone and has mild cognitive impairment. His daughter visits weekly.',
                    context: 'You are reviewing Mr. Park\'s medication regimen before discharge. He has been confused about his medications and missed doses during his hospital stay.',
                    objectives: [
                        'Simplify medication schedule and instructions',
                        'Explain the purpose of each medication',
                        'Set up medication organization system',
                        'Involve family in medication management',
                        'Identify potential side effects and interactions'
                    ],
                    patientDialogue: [
                        'I can\'t remember which pills to take when.',
                        'Some of these medications are new. Why do I need so many?',
                        'What happens if I accidentally take a pill twice?',
                        'My daughter wants to help, but she doesn\'t live nearby.',
                        'These medications are very expensive. Can I skip some?'
                    ],
                    keyPhrases: [
                        'Let\'s organize this in a way that makes sense for you',
                        'Each medication has an important job in keeping you healthy',
                        'We can set up systems to prevent confusion',
                        'Your daughter can be part of your support team',
                        'Never stop medications without talking to your doctor first'
                    ]
                }
            ],
            'emotional-support': [
                {
                    id: 'emo_001',
                    title: 'Cancer Diagnosis Emotional Support',
                    category: 'emotional-support',
                    patientInfo: 'Ms. Jennifer Adams, 42 years old, recently diagnosed with breast cancer. She is a single mother of two young children and is overwhelmed by fear and uncertainty about the future.',
                    context: 'Ms. Adams has just received her treatment plan and is struggling emotionally. She needs support to process her diagnosis and concerns about her children.',
                    objectives: [
                        'Provide emotional validation and support',
                        'Help her process fears and concerns',
                        'Discuss support resources available',
                        'Address concerns about her children',
                        'Encourage hope while being realistic'
                    ],
                    patientDialogue: [
                        'I can\'t stop thinking about what will happen to my children.',
                        'I feel like my whole world has fallen apart.',
                        'How do I tell my kids about this? They\'re so young.',
                        'I don\'t have family nearby to help me.',
                        'I\'m scared I won\'t be here to see them grow up.'
                    ],
                    keyPhrases: [
                        'Your feelings are completely understandable',
                        'You don\'t have to face this alone',
                        'Let\'s talk about what support is available',
                        'You\'re being incredibly strong for your children',
                        'We\'ll help you through each step of this journey'
                    ]
                }
            ],
            'family-communication': [
                {
                    id: 'fam_001',
                    title: 'End-of-Life Family Discussion',
                    category: 'family-communication',
                    patientInfo: 'Mr. Thomas Brown, 78 years old, has advanced COPD and is declining. His adult children disagree about his care. His daughter wants aggressive treatment while his son supports comfort care.',
                    context: 'You are facilitating a family meeting to discuss Mr. Brown\'s wishes and care goals. The family is emotional and conflicted about the best approach.',
                    objectives: [
                        'Facilitate open communication between family members',
                        'Help clarify the patient\'s wishes and values',
                        'Provide information about care options',
                        'Support the family through difficult decisions',
                        'Ensure everyone feels heard and respected'
                    ],
                    patientDialogue: [
                        'I don\'t want to be a burden on my family.',
                        'My children can\'t agree on what\'s best for me.',
                        'I\'m tired of fighting this disease.',
                        'I want to be comfortable, but I don\'t want to give up.',
                        'How do I help my family understand what I want?'
                    ],
                    keyPhrases: [
                        'Your wishes are the most important thing here',
                        'It\'s natural for families to have different perspectives',
                        'Let\'s focus on what matters most to you',
                        'There\'s no right or wrong choice, only what\'s right for you',
                        'We\'re here to support whatever decision you make'
                    ]
                }
            ],
            'pain-management': [
                {
                    id: 'pain_001',
                    title: 'Chronic Pain Management Education',
                    category: 'pain-management',
                    patientInfo: 'Mrs. Lisa Rodriguez, 45 years old, has chronic back pain following a work injury. She\'s concerned about opioid dependence but struggles with daily activities due to pain.',
                    context: 'You are discussing pain management strategies with Mrs. Rodriguez. She has fears about addiction but needs effective pain control to function.',
                    objectives: [
                        'Educate about different pain management approaches',
                        'Address concerns about medication dependence',
                        'Discuss non-pharmacological pain strategies',
                        'Set realistic expectations for pain control',
                        'Develop a comprehensive pain management plan'
                    ],
                    patientDialogue: [
                        'I\'m afraid of becoming addicted to pain medication.',
                        'The pain is affecting my ability to work and care for my family.',
                        'I\'ve tried physical therapy, but it doesn\'t seem to help much.',
                        'How do I know if the medication is working properly?',
                        'Will I ever be able to live without pain medication?'
                    ],
                    keyPhrases: [
                        'Your concerns about medication are very valid',
                        'Pain management is about finding the right balance',
                        'There are many tools we can use besides medication',
                        'You deserve to have your pain taken seriously',
                        'We\'ll work together to find what works best for you'
                    ]
                }
            ],
            'post-operative': [
                {
                    id: 'post_001',
                    title: 'Post-Operative Cardiac Surgery Care',
                    category: 'post-operative',
                    patientInfo: 'Mr. James Wilson, 62 years old, had coronary artery bypass surgery 5 days ago. He\'s ready for discharge but anxious about activity restrictions and recovery timeline.',
                    context: 'You are providing post-operative education before Mr. Wilson\'s discharge. He needs clear instructions about activity, wound care, and when to seek help.',
                    objectives: [
                        'Review activity restrictions and progression',
                        'Explain incision care and infection prevention',
                        'Discuss cardiac rehabilitation importance',
                        'Identify warning signs requiring immediate attention',
                        'Address anxiety about recovery process'
                    ],
                    patientDialogue: [
                        'When can I return to my normal activities?',
                        'I\'m worried about my chest incision opening up.',
                        'How will I know if something is wrong at home?',
                        'Can I drive myself to my follow-up appointments?',
                        'This recovery seems like it will take forever.'
                    ],
                    keyPhrases: [
                        'Recovery is a gradual process that takes time',
                        'Your body has been through major surgery and needs time to heal',
                        'We\'ll give you clear guidelines to follow',
                        'It\'s normal to feel anxious about going home',
                        'You\'ve made excellent progress so far'
                    ]
                }
            ]
        };

        // Comprehensive phrase bank
        const phraseBank = {
            'empathy-validation': [
                'I can see this is really concerning for you',
                'Your feelings about this are completely understandable',
                'It sounds like you\'re feeling overwhelmed right now',
                'Many patients have similar concerns',
                'You\'re not alone in feeling this way',
                'That must be really difficult for you',
                'I hear how worried you are about this',
                'Your concerns are very valid'
            ],
            'reassurance-support': [
                'We\'re here to support you through this',
                'You don\'t have to manage this alone',
                'We\'ll work together to address your concerns',
                'You\'re taking important steps for your health',
                'It\'s okay to take this one step at a time',
                'You have more strength than you realize',
                'We believe in your ability to manage this',
                'You\'re doing better than you think'
            ],
            'education-explanation': [
                'Let me explain this in a way that makes sense',
                'I\'d like to break this down into smaller parts',
                'The most important thing to remember is...',
                'Think of it this way...',
                'Here\'s what this means for you specifically',
                'Let me give you an example',
                'The key point is...',
                'What questions do you have about this?'
            ],
            'collaboration-involvement': [
                'What are your thoughts about this plan?',
                'How does this fit with your daily routine?',
                'What concerns do you have about this approach?',
                'Let\'s figure out what works best for you',
                'Your input is really important here',
                'What would make this easier for you?',
                'How can we adapt this to your situation?',
                'What support do you need to make this work?'
            ],
            'safety-instructions': [
                'For your safety, it\'s important that you...',
                'This precaution helps prevent complications',
                'Please don\'t hesitate to call if you notice...',
                'Watch for these warning signs...',
                'If you experience any of these symptoms...',
                'Your safety is our top priority',
                'These guidelines are designed to protect you',
                'When in doubt, always contact us'
            ],
            'discharge-follow-up': [
                'Before you go home, let\'s review...',
                'You have a follow-up appointment scheduled for...',
                'Here\'s what to expect in the next few days',
                'Remember to take your medications as prescribed',
                'Don\'t hesitate to call if you have questions',
                'We\'ve arranged for... to help you at home',
                'Your recovery is progressing well',
                'You\'re ready for the next step in your recovery'
            ]
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadCustomScenarios();
            updateDisplays();
            loadScenarios();
            checkMicrophonePermission();
        });

        function setupEventListeners() {
            // Category selection
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => selectCategory(e.target.dataset.category));
            });

            // Role-play controls
            document.getElementById('startRolePlay').addEventListener('click', startRolePlay);
            document.getElementById('recordResponse').addEventListener('click', startRecording);
            document.getElementById('stopRecording').addEventListener('click', stopRecording);
            document.getElementById('submitResponse').addEventListener('click', submitResponse);
            
            // Session controls
            document.getElementById('pauseBtn').addEventListener('click', pauseSession);
            document.getElementById('endRolePlayBtn').addEventListener('click', endRolePlay);
            
            // Results actions
            document.getElementById('exportReport').addEventListener('click', exportReport);
            document.getElementById('newScenario').addEventListener('click', newScenario);
            
            // Modal controls
            document.getElementById('createScenarioBtn').addEventListener('click', openCreateScenarioModal);
            document.getElementById('closeCreateScenario').addEventListener('click', closeCreateScenarioModal);
            document.getElementById('saveScenario').addEventListener('click', saveNewScenario);
            document.getElementById('previewScenario').addEventListener('click', previewNewScenario);
            
            document.getElementById('phraseBankBtn').addEventListener('click', openPhraseBankModal);
            document.getElementById('closePhraseBank').addEventListener('click', closePhraseBankModal);
            
            // Dynamic form controls
            document.getElementById('addObjective').addEventListener('click', addObjectiveField);
            document.getElementById('addDialogue').addEventListener('click', addDialogueField);
            document.getElementById('addKeyPhrase').addEventListener('click', addKeyPhraseField);
        }

        async function checkMicrophonePermission() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
            } catch (error) {
                console.error('Microphone permission denied:', error);
                showNotification('Microphone access is required for recording. Please enable it in your browser settings.', 'error');
            }
        }

        function selectCategory(category) {
            appState.selectedCategory = category;
            
            // Update UI
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-primary-gold', 'text-white');
                btn.classList.add('bg-light-green', 'text-white');
            });
            
            const selectedBtn = document.querySelector(`[data-category="${category}"]`);
            selectedBtn.classList.remove('bg-light-green');
            selectedBtn.classList.add('bg-primary-gold');
            
            loadScenarios();
        }

        function loadScenarios() {
            const container = document.getElementById('scenariosContainer');
            let scenariosToShow = [];
            
            if (appState.selectedCategory === 'all') {
                // Get scenarios from all categories
                Object.values(nursingScenarios).forEach(categoryScenarios => {
                    scenariosToShow = scenariosToShow.concat(categoryScenarios);
                });
            } else {
                scenariosToShow = nursingScenarios[appState.selectedCategory] || [];
            }
            
            container.innerHTML = scenariosToShow.map(scenario => `
                <div class="scenario-card p-6 rounded-xl cursor-pointer" onclick="selectScenario('${scenario.id}')">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-bold text-primary-green">${scenario.title}</h3>
                        <span class="nursing-badge">${formatCategory(scenario.category)}</span>
                    </div>
                    <p class="text-sm text-gray-700 mb-4">${scenario.patientInfo.substring(0, 120)}...</p>
                    <div class="flex justify-between items-center text-xs text-gray-600">
                        <span>üéØ ${scenario.objectives.length} objectives</span>
                        <span>‚è±Ô∏è ~10 min</span>
                    </div>
                </div>
            `).join('');
            
            if (scenariosToShow.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üë©‚Äç‚öïÔ∏è</div>
                        <p class="text-lg">No scenarios available for this category</p>
                        <p class="text-sm">Try creating custom scenarios or select a different category</p>
                    </div>
                `;
            }
        }

        function formatCategory(category) {
            return category.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function selectScenario(scenarioId) {
            // Find the scenario
            let selectedScenario = null;
            Object.values(nursingScenarios).forEach(categoryScenarios => {
                const found = categoryScenarios.find(s => s.id === scenarioId);
                if (found) selectedScenario = found;
            });
            
            if (!selectedScenario) return;
            
            appState.currentScenario = selectedScenario;
            appState.currentPhase = 'preparation';
            appState.conversationHistory = [];
            appState.currentSession = {
                startTime: new Date(),
                scenarioId: scenarioId,
                preparationNotes: '',
                responses: [],
                recordings: [],
                scores: {},
                feedback: {}
            };
            
            startSession();
        }

        function startSession() {
            // Hide scenario selection, show role-play
            document.getElementById('scenarioSelection').classList.add('hidden');
            document.getElementById('activeRolePlay').classList.remove('hidden');
            
            // Load scenario data
            loadScenarioData();
            
            // Start timer
            startTimer(300); // 5 minutes preparation
            
            showNotification('Scenario loaded! Take time to prepare your approach.');
        }

        function loadScenarioData() {
            const scenario = appState.currentScenario;
            
            // Update header
            document.getElementById('scenarioTitle').textContent = scenario.title;
            document.getElementById('scenarioCategory').textContent = formatCategory(scenario.category);
            document.getElementById('currentPhase').textContent = 'Preparation';
            
            // Load patient information
            document.getElementById('patientInfo').innerHTML = `
                <div class="text-sm text-primary-green">${scenario.patientInfo}</div>
            `;
            
            // Load scenario context
            document.getElementById('scenarioContext').innerHTML = `
                <div class="text-sm text-primary-green">${scenario.context}</div>
            `;
            
            // Load objectives
            const objectivesContainer = document.getElementById('nursingObjectives');
            objectivesContainer.innerHTML = scenario.objectives.map(objective => `
                <div class="flex items-start space-x-2">
                    <span class="text-primary-gold font-bold">‚Ä¢</span>
                    <span class="text-sm text-primary-green">${objective}</span>
                </div>
            `).join('');
            
            // Load key phrases
            loadKeyPhrases();
        }

        function loadKeyPhrases() {
            const container = document.getElementById('keyPhrases');
            const phrases = appState.currentScenario.keyPhrases;
            
            container.innerHTML = phrases.map(phrase => `
                <div class="phrase-card p-3 rounded-lg cursor-pointer" onclick="copyPhrase('${phrase}')">
                    <div class="text-xs font-medium text-primary-green">"${phrase}"</div>
                    <div class="text-xs text-medium-green mt-1">Click to copy</div>
                </div>
            `).join('');
        }

        function startTimer(seconds) {
            appState.timeRemaining = seconds;
            
            appState.timer = setInterval(() => {
                appState.timeRemaining--;
                updateTimerDisplay();
                
                if (appState.timeRemaining <= 0) {
                    clearInterval(appState.timer);
                    if (appState.currentPhase === 'preparation') {
                        showNotification('Preparation time is up! You can still continue or start the role-play.', 'warning');
                    } else {
                        showNotification('Role-play time completed! Proceeding to feedback.', 'warning');
                        proceedToFeedback();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(appState.timeRemaining / 60);
            const seconds = appState.timeRemaining % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('phaseTimer').textContent = display;
            
            // Change color when time is running low
            const timerElement = document.getElementById('phaseTimer');
            if (appState.timeRemaining < 60) { // Less than 1 minute
                timerElement.classList.add('text-red-600');
                timerElement.classList.remove('text-primary-gold');
            }
        }

        function startRolePlay() {
            // Save preparation notes
            appState.currentSession.preparationNotes = document.getElementById('preparationNotes').value;
            
            // Update phase
            appState.currentPhase = 'conversation';
            document.getElementById('currentPhase').textContent = 'Patient Conversation';
            
            // Show conversation phase
            document.getElementById('preparationPhase').classList.add('hidden');
            document.getElementById('conversationPhase').classList.remove('hidden');
            
            // Start conversation timer
            if (appState.timer) clearInterval(appState.timer);
            startTimer(600); // 10 minutes for conversation
            
            // Initialize conversation
            initializeConversation();
            
            showNotification('Role-play started! The patient is ready to talk with you.');
        }

        function initializeConversation() {
            const scenario = appState.currentScenario;
            const firstPatientMessage = scenario.patientDialogue[0];
            
            appState.conversationHistory = [
                {
                    speaker: 'patient',
                    message: firstPatientMessage,
                    timestamp: new Date()
                }
            ];
            
            updateConversationDisplay();
        }

        function updateConversationDisplay() {
            const container = document.getElementById('conversationArea');
            
            container.innerHTML = appState.conversationHistory.map(entry => {
                if (entry.speaker === 'patient') {
                    return `
                        <div class="patient-dialogue">
                            <div class="font-semibold mb-2">Patient:</div>
                            <div>${entry.message}</div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="nurse-response">
                            <div class="font-semibold mb-2">You:</div>
                            <div>${entry.message}</div>
                        </div>
                    `;
                }
            }).join('');
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });
                
                appState.mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'audio/webm;codecs=opus'
                });
                
                appState.recordedChunks = [];
                
                appState.mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        appState.recordedChunks.push(event.data);
                    }
                };
                
                appState.mediaRecorder.onstop = () => {
                    const blob = new Blob(appState.recordedChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(blob);
                    
                    appState.currentSession.recordings.push({
                        url: audioUrl,
                        timestamp: new Date()
                    });
                    
                    // Stop all tracks
                    stream.getTracks().forEach(track => track.stop());
                    
                    showNotification('Response recorded successfully!');
                };
                
                // Start recording
                appState.mediaRecorder.start(100);
                appState.isRecording = true;
                
                // Update UI
                document.getElementById('recordResponse').classList.add('hidden');
                document.getElementById('stopRecording').classList.remove('hidden');
                document.getElementById('recordingStatus').innerHTML = `
                    <div class="recording-pulse text-red-600">üî¥ Recording your response...</div>
                `;
                
                showNotification('Recording started! Speak your response to the patient.');
                
            } catch (error) {
                console.error('Error starting recording:', error);
                showNotification('Failed to start recording. Please check microphone permissions.', 'error');
            }
        }

        function stopRecording() {
            if (appState.mediaRecorder && appState.isRecording) {
                appState.mediaRecorder.stop();
                appState.isRecording = false;
                
                // Update UI
                document.getElementById('recordResponse').classList.remove('hidden');
                document.getElementById('stopRecording').classList.add('hidden');
                document.getElementById('recordingStatus').innerHTML = `
                    <div class="text-green-600">‚úÖ Response recorded</div>
                `;
            }
        }

        function submitResponse() {
            const responseText = document.getElementById('nurseResponse').value.trim();
            
            if (!responseText) {
                showNotification('Please type your response before submitting.', 'warning');
                return;
            }
            
            // Add nurse response to conversation
            appState.conversationHistory.push({
                speaker: 'nurse',
                message: responseText,
                timestamp: new Date()
            });
            
            // Save response to session
            appState.currentSession.responses.push({
                text: responseText,
                timestamp: new Date()
            });
            
            // Generate patient response
            generatePatientResponse();
            
            // Clear input
            document.getElementById('nurseResponse').value = '';
            
            // Update display
            updateConversationDisplay();
        }

        function generatePatientResponse() {
            const scenario = appState.currentScenario;
            const responseIndex = appState.conversationHistory.filter(entry => entry.speaker === 'patient').length;
            
            if (responseIndex < scenario.patientDialogue.length) {
                const nextPatientMessage = scenario.patientDialogue[responseIndex];
                
                setTimeout(() => {
                    appState.conversationHistory.push({
                        speaker: 'patient',
                        message: nextPatientMessage,
                        timestamp: new Date()
                    });
                    
                    updateConversationDisplay();
                    showNotification('Patient has responded. Continue the conversation.');
                }, 2000);
            } else {
                // Conversation complete
                setTimeout(() => {
                    showNotification('Conversation completed! Proceeding to feedback.', 'success');
                    proceedToFeedback();
                }, 2000);
            }
        }

        function proceedToFeedback() {
            // Stop timer
            if (appState.timer) {
                clearInterval(appState.timer);
            }
            
            // Calculate scores
            calculateScores();
            
            // Update phase
            appState.currentPhase = 'feedback';
            document.getElementById('currentPhase').textContent = 'Performance Feedback';
            
            // Show feedback phase
            document.getElementById('conversationPhase').classList.add('hidden');
            document.getElementById('feedbackPhase').classList.remove('hidden');
            
            // Display feedback
            displayFeedback();
            
            // Save session
            appState.currentSession.completedAt = new Date();
            appState.completedSessions.push(appState.currentSession);
            saveToStorage();
            updateDisplays();
        }

        function calculateScores() {
            // Mock scoring algorithm based on OET criteria
            const scores = {
                linguistic: calculateLinguisticScore(),
                appropriateness: calculateAppropriatenessScore(),
                discourse: calculateDiscourseScore(),
                intelligibility: calculateIntelligibilityScore()
            };
            
            appState.currentSession.scores = scores;
            
            // Generate feedback
            generateFeedback(scores);
        }

        function calculateLinguisticScore() {
            // Mock scoring based on response complexity and variety
            const responses = appState.currentSession.responses;
            let score = 3; // Base score
            
            if (responses.length > 3) score += 1;
            if (responses.some(r => r.text.length > 100)) score += 1;
            
            return Math.min(5, score);
        }

        function calculateAppropriatenessScore() {
            // Mock scoring based on empathy phrases and professional language
            const responses = appState.currentSession.responses;
            const empathyPhrases = phraseBank['empathy-validation'];
            
            let score = 3;
            let empathyCount = 0;
            
            responses.forEach(response => {
                empathyPhrases.forEach(phrase => {
                    if (response.text.toLowerCase().includes(phrase.toLowerCase().substring(0, 10))) {
                        empathyCount++;
                    }
                });
            });
            
            if (empathyCount > 0) score += 1;
            if (empathyCount > 2) score += 1;
            
            return Math.min(5, score);
        }

        function calculateDiscourseScore() {
            // Mock scoring based on conversation flow and structure
            const responses = appState.currentSession.responses;
            let score = 3;
            
            if (responses.length >= appState.currentScenario.patientDialogue.length) score += 1;
            if (appState.currentSession.preparationNotes.length > 50) score += 1;
            
            return Math.min(5, score);
        }

        function calculateIntelligibilityScore() {
            // Mock scoring based on recordings and clarity
            const recordings = appState.currentSession.recordings;
            let score = 4; // Assume good intelligibility
            
            if (recordings.length > 0) score += 1;
            
            return Math.min(5, score);
        }

        function generateFeedback(scores) {
            const feedback = {
                strengths: [],
                improvements: [],
                recommendedPhrases: []
            };
            
            // Generate strengths based on scores
            if (scores.appropriateness >= 4) {
                feedback.strengths.push('Excellent use of empathetic language');
            }
            if (scores.discourse >= 4) {
                feedback.strengths.push('Good conversation flow and structure');
            }
            if (scores.linguistic >= 4) {
                feedback.strengths.push('Strong vocabulary and expression');
            }
            
            // Generate improvements
            if (scores.appropriateness < 4) {
                feedback.improvements.push('Include more empathetic and validating responses');
                feedback.recommendedPhrases = feedback.recommendedPhrases.concat(
                    phraseBank['empathy-validation'].slice(0, 3)
                );
            }
            if (scores.discourse < 4) {
                feedback.improvements.push('Work on conversation structure and flow');
                feedback.recommendedPhrases = feedback.recommendedPhrases.concat(
                    phraseBank['collaboration-involvement'].slice(0, 2)
                );
            }
            
            // Add category-specific phrases
            const category = appState.currentScenario.category;
            if (category === 'patient-education') {
                feedback.recommendedPhrases = feedback.recommendedPhrases.concat(
                    phraseBank['education-explanation'].slice(0, 2)
                );
            } else if (category === 'discharge-planning') {
                feedback.recommendedPhrases = feedback.recommendedPhrases.concat(
                    phraseBank['discharge-follow-up'].slice(0, 2)
                );
            }
            
            appState.currentSession.feedback = feedback;
        }

        function displayFeedback() {
            const scores = appState.currentSession.scores;
            const feedback = appState.currentSession.feedback;
            
            // Display scores
            displayScores(scores);
            
            // Display strengths and improvements
            displayStrengthsAndImprovements(feedback);
            
            // Display recommended phrases
            displayRecommendedPhrases(feedback.recommendedPhrases);
        }

        function displayScores(scores) {
            const criteria = ['linguistic', 'appropriateness', 'discourse', 'intelligibility'];
            
            criteria.forEach(criterion => {
                const score = scores[criterion];
                const band = `Band ${score}`;
                const percentage = (score / 5) * 100;
                
                document.getElementById(`${criterion}Band`).textContent = band;
                document.getElementById(`${criterion}Bar`).style.width = `${percentage}%`;
                document.getElementById(`${criterion}Bar`).className = `score-band h-2 rounded-full band-${score}`;
            });
        }

        function displayStrengthsAndImprovements(feedback) {
            // Display strengths
            const strengthsContainer = document.getElementById('strengths');
            if (feedback.strengths.length === 0) {
                strengthsContainer.innerHTML = `
                    <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                        <div class="text-green-800 text-sm">Keep practicing to develop your strengths!</div>
                    </div>
                `;
            } else {
                strengthsContainer.innerHTML = feedback.strengths.map(strength => `
                    <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                        <div class="text-green-800 text-sm">‚úÖ ${strength}</div>
                    </div>
                `).join('');
            }
            
            // Display improvements
            const improvementsContainer = document.getElementById('improvements');
            if (feedback.improvements.length === 0) {
                improvementsContainer.innerHTML = `
                    <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="text-blue-800 text-sm">Great job! Continue practicing to maintain your skills.</div>
                    </div>
                `;
            } else {
                improvementsContainer.innerHTML = feedback.improvements.map(improvement => `
                    <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                        <div class="text-orange-800 text-sm">üéØ ${improvement}</div>
                    </div>
                `).join('');
            }
        }

        function displayRecommendedPhrases(phrases) {
            const container = document.getElementById('recommendedPhrases');
            
            container.innerHTML = phrases.map(phrase => `
                <div class="phrase-card p-4 rounded-lg cursor-pointer" onclick="copyPhrase('${phrase}')">
                    <div class="text-sm font-medium text-primary-green">"${phrase}"</div>
                    <div class="text-xs text-medium-green mt-1">Click to copy</div>
                </div>
            `).join('');
        }

        function copyPhrase(phrase) {
            navigator.clipboard.writeText(phrase).then(() => {
                showNotification('Phrase copied to clipboard!');
            });
        }

        function pauseSession() {
            if (appState.timer) {
                clearInterval(appState.timer);
                appState.timer = null;
                showNotification('Session paused. Click any action to resume.');
            }
        }

        function endRolePlay() {
            if (confirm('Are you sure you want to end this role-play? Your progress will be saved.')) {
                if (appState.timer) {
                    clearInterval(appState.timer);
                }
                
                // Save partial session
                appState.currentSession.completedAt = new Date();
                appState.currentSession.isPartial = true;
                appState.completedSessions.push(appState.currentSession);
                saveToStorage();
                
                newScenario();
            }
        }

        function newScenario() {
            // Reset state
            appState.currentScenario = null;
            appState.currentPhase = 'selection';
            appState.conversationHistory = [];
            appState.currentSession = {};
            
            if (appState.timer) {
                clearInterval(appState.timer);
            }
            
            // Show scenario selection
            document.getElementById('activeRolePlay').classList.add('hidden');
            document.getElementById('scenarioSelection').classList.remove('hidden');
            
            // Reset forms
            document.getElementById('preparationNotes').value = '';
            document.getElementById('nurseResponse').value = '';
            
            updateDisplays();
        }

        function exportReport() {
            const { jsPDF } = window.jsPdf;
            const doc = new jsPDF();
            
            const session = appState.currentSession;
            const scenario = appState.currentScenario;
            
            // Title
            doc.setFontSize(18);
            doc.text('OET Nursing Speaking Practice Report', 20, 30);
            
            // Scenario information
            doc.setFontSize(12);
            doc.text(`Scenario: ${scenario.title}`, 20, 50);
            doc.text(`Category: ${formatCategory(scenario.category)}`, 20, 60);
            doc.text(`Date: ${new Date(session.startTime).toLocaleDateString()}`, 20, 70);
            doc.text(`Duration: ${calculateDuration(session)}`, 20, 80);
            
            // Scores
            doc.text('OET Speaking Scores:', 20, 100);
            let yPos = 110;
            Object.entries(session.scores).forEach(([criterion, score]) => {
                doc.text(`${criterion.charAt(0).toUpperCase() + criterion.slice(1)}: Band ${score}/5`, 30, yPos);
                yPos += 10;
            });
            
            // Feedback
            yPos += 10;
            doc.text('Strengths:', 20, yPos);
            yPos += 10;
            session.feedback.strengths.forEach(strength => {
                const lines = doc.splitTextToSize(`‚Ä¢ ${strength}`, 170);
                doc.text(lines, 30, yPos);
                yPos += lines.length * 5 + 5;
            });
            
            yPos += 10;
            if (yPos > 250) {
                doc.addPage();
                yPos = 30;
            }
            doc.text('Areas for Improvement:', 20, yPos);
            yPos += 10;
            session.feedback.improvements.forEach(improvement => {
                const lines = doc.splitTextToSize(`‚Ä¢ ${improvement}`, 170);
                doc.text(lines, 30, yPos);
                yPos += lines.length * 5 + 5;
            });
            
            doc.save(`OET_Nursing_Practice_${scenario.category}_${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function calculateDuration(session) {
            if (!session.completedAt) return 'Incomplete';
            
            const start = new Date(session.startTime);
            const end = new Date(session.completedAt);
            const minutes = Math.round((end - start) / (1000 * 60));
            
            return `${minutes} minutes`;
        }

        // Create scenario functionality
        function openCreateScenarioModal() {
            document.getElementById('createScenarioModal').classList.remove('hidden');
            document.getElementById('createScenarioModal').classList.add('flex');
            resetCreateScenarioForm();
        }

        function closeCreateScenarioModal() {
            document.getElementById('createScenarioModal').classList.add('hidden');
            document.getElementById('createScenarioModal').classList.remove('flex');
        }

        function resetCreateScenarioForm() {
            document.getElementById('createScenarioForm').reset();
            
            // Reset dynamic fields
            resetDynamicFields('objectivesList', 'objective-input', 'Enter nursing objective...');
            resetDynamicFields('dialogueList', 'dialogue-input', 'Enter what the patient might say...');
            resetDynamicFields('keyPhrasesList', 'key-phrase-input', 'Enter key nursing phrase...');
        }

        function resetDynamicFields(containerId, inputClass, placeholder, count = 1) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const fieldHtml = `
                    <div class="flex items-center space-x-2">
                        <input type="text" class="nursing-input flex-1 text-sm ${inputClass}" placeholder="${placeholder}">
                        <button type="button" onclick="remove${inputClass.split('-')[0].charAt(0).toUpperCase() + inputClass.split('-')[0].slice(1)}${inputClass.includes('objective') ? '' : inputClass.includes('dialogue') ? '' : inputClass.includes('phrase') ? '' : ''}(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">‚úï</button>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', fieldHtml);
            }
        }

        // Dynamic field management
        function addObjectiveField() {
            const container = document.getElementById('objectivesList');
            const fieldHtml = `
                <div class="flex items-center space-x-2">
                    <input type="text" class="nursing-input flex-1 text-sm objective-input" placeholder="Enter nursing objective...">
                    <button type="button" onclick="removeObjective(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">‚úï</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', fieldHtml);
        }

        function removeObjective(button) {
            const container = document.getElementById('objectivesList');
            if (container.children.length > 1) {
                button.parentElement.remove();
            } else {
                showNotification('At least one objective is required.', 'warning');
            }
        }

        function addDialogueField() {
            const container = document.getElementById('dialogueList');
            const fieldHtml = `
                <div class="flex items-center space-x-2">
                    <input type="text" class="nursing-input flex-1 text-sm dialogue-input" placeholder="Enter what the patient might say...">
                    <button type="button" onclick="removeDialogue(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">‚úï</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', fieldHtml);
        }

        function removeDialogue(button) {
            const container = document.getElementById('dialogueList');
            if (container.children.length > 1) {
                button.parentElement.remove();
            } else {
                showNotification('At least one dialogue point is required.', 'warning');
            }
        }

        function addKeyPhraseField() {
            const container = document.getElementById('keyPhrasesList');
            const fieldHtml = `
                <div class="flex items-center space-x-2">
                    <input type="text" class="nursing-input flex-1 text-sm key-phrase-input" placeholder="Enter key nursing phrase...">
                    <button type="button" onclick="removeKeyPhrase(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">‚úï</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', fieldHtml);
        }

        function removeKeyPhrase(button) {
            button.parentElement.remove();
        }

        function collectScenarioFormData() {
            const formData = {
                title: document.getElementById('newScenarioTitle').value.trim(),
                category: document.getElementById('newScenarioCategory').value,
                patientInfo: document.getElementById('newPatientInfo').value.trim(),
                context: document.getElementById('newScenarioContext').value.trim(),
                objectives: [],
                patientDialogue: [],
                keyPhrases: []
            };

            // Collect objectives
            document.querySelectorAll('.objective-input').forEach(input => {
                if (input.value.trim()) {
                    formData.objectives.push(input.value.trim());
                }
            });

            // Collect dialogue
            document.querySelectorAll('.dialogue-input').forEach(input => {
                if (input.value.trim()) {
                    formData.patientDialogue.push(input.value.trim());
                }
            });

            // Collect key phrases
            document.querySelectorAll('.key-phrase-input').forEach(input => {
                if (input.value.trim()) {
                    formData.keyPhrases.push(input.value.trim());
                }
            });

            return formData;
        }

        function validateScenarioData(data) {
            const errors = [];

            if (!data.title) errors.push('Scenario title is required');
            if (!data.category) errors.push('Category is required');
            if (!data.patientInfo) errors.push('Patient information is required');
            if (!data.context) errors.push('Scenario context is required');
            if (data.objectives.length === 0) errors.push('At least one objective is required');
            if (data.patientDialogue.length === 0) errors.push('At least one dialogue point is required');

            return errors;
        }

        function saveNewScenario() {
            const formData = collectScenarioFormData();
            const errors = validateScenarioData(formData);

            if (errors.length > 0) {
                showNotification(`Please fix the following errors:\n‚Ä¢ ${errors.join('\n‚Ä¢ ')}`, 'error');
                return;
            }

            // Create scenario object
            const newScenario = {
                id: `custom_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                title: formData.title,
                category: formData.category,
                patientInfo: formData.patientInfo,
                context: formData.context,
                objectives: formData.objectives,
                patientDialogue: formData.patientDialogue,
                keyPhrases: formData.keyPhrases.length > 0 ? formData.keyPhrases : [
                    'I understand your concerns',
                    'Let\'s work together on this',
                    'You\'re doing great',
                    'This is a normal part of the process',
                    'I\'m here to support you'
                ]
            };

            // Add to appropriate category
            if (!nursingScenarios[formData.category]) {
                nursingScenarios[formData.category] = [];
            }
            nursingScenarios[formData.category].push(newScenario);

            // Save to localStorage
            const customScenarios = JSON.parse(localStorage.getItem('custom_nursing_scenarios') || '{}');
            if (!customScenarios[formData.category]) {
                customScenarios[formData.category] = [];
            }
            customScenarios[formData.category].push(newScenario);
            localStorage.setItem('custom_nursing_scenarios', JSON.stringify(customScenarios));

            showNotification(`Scenario "${formData.title}" created successfully!`);
            closeCreateScenarioModal();
            
            // Refresh display if viewing this category
            if (appState.selectedCategory === formData.category || appState.selectedCategory === 'all') {
                loadScenarios();
            }
        }

        function previewNewScenario() {
            const formData = collectScenarioFormData();
            const errors = validateScenarioData(formData);

            if (errors.length > 0) {
                showNotification(`Please fix the following errors before previewing:\n‚Ä¢ ${errors.join('\n‚Ä¢ ')}`, 'warning');
                return;
            }

            // Create preview modal
            const previewModal = document.createElement('div');
            previewModal.className = 'fixed inset-0 modal-backdrop flex items-center justify-center z-50';
            previewModal.innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-2xl font-bold text-primary-green mb-6">Scenario Preview: ${formData.title}</h3>
                    
                    <div class="space-y-6">
                        <div class="scenario-card p-6 rounded-xl">
                            <div class="flex justify-between items-start mb-4">
                                <h4 class="text-lg font-bold text-primary-green">${formData.title}</h4>
                                <span class="nursing-badge">${formatCategory(formData.category)}</span>
                            </div>
                            <div class="mb-4">
                                <h5 class="font-semibold text-primary-green mb-2">Patient Information</h5>
                                <p class="text-sm text-gray-700">${formData.patientInfo}</p>
                            </div>
                            <div class="mb-4">
                                <h5 class="font-semibold text-primary-green mb-2">Context</h5>
                                <p class="text-sm text-gray-700">${formData.context}</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="font-semibold text-primary-green mb-2">Objectives (${formData.objectives.length})</h5>
                                <ul class="text-sm space-y-1">
                                    ${formData.objectives.map(obj => `<li>‚Ä¢ ${obj}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div>
                                <h5 class="font-semibold text-primary-green mb-2">Patient Dialogue (${formData.patientDialogue.length})</h5>
                                <ul class="text-sm space-y-1">
                                    ${formData.patientDialogue.map(dialogue => `<li>‚Ä¢ "${dialogue}"</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        ${formData.keyPhrases.length > 0 ? `
                        <div>
                            <h5 class="font-semibold text-primary-green mb-2">Key Phrases (${formData.keyPhrases.length})</h5>
                            <ul class="text-sm space-y-1">
                                ${formData.keyPhrases.map(phrase => `<li>‚Ä¢ "${phrase}"</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="flex space-x-4 mt-8 pt-6 border-t border-gray-200">
                        <button onclick="this.closest('.modal-backdrop').remove()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors">
                            Close Preview
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(previewModal);
        }

        // Phrase Bank functionality
        function openPhraseBankModal() {
            document.getElementById('phraseBankModal').classList.remove('hidden');
            document.getElementById('phraseBankModal').classList.add('flex');
            loadPhraseBank();
        }

        function closePhraseBankModal() {
            document.getElementById('phraseBankModal').classList.add('hidden');
            document.getElementById('phraseBankModal').classList.remove('flex');
        }

        function loadPhraseBank() {
            const container = document.getElementById('phraseBankContent');
            
            container.innerHTML = Object.entries(phraseBank).map(([category, phrases]) => `
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h4 class="text-lg font-bold text-primary-green mb-4">${formatCategory(category)}</h4>
                    <div class="space-y-2">
                        ${phrases.map(phrase => `
                            <div class="phrase-card p-3 rounded-lg cursor-pointer" onclick="copyPhrase('${phrase}')">
                                <div class="text-sm text-primary-green">"${phrase}"</div>
                                <div class="text-xs text-medium-green mt-1">Click to copy</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Load custom scenarios on initialization
        function loadCustomScenarios() {
            const customScenarios = JSON.parse(localStorage.getItem('custom_nursing_scenarios') || '{}');
            
            Object.entries(customScenarios).forEach(([category, scenarios]) => {
                if (!nursingScenarios[category]) {
                    nursingScenarios[category] = [];
                }
                
                scenarios.forEach(customScenario => {
                    const exists = nursingScenarios[category].some(existingScenario => existingScenario.id === customScenario.id);
                    if (!exists) {
                        nursingScenarios[category].push(customScenario);
                    }
                });
            });
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 fade-in ${
                type === 'error' ? 'bg-red-600 text-white' : 
                type === 'warning' ? 'bg-yellow-600 text-white' : 
                'bg-green-600 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        function updateDisplays() {
            document.getElementById('totalSessions').textContent = appState.completedSessions.length;
        }

        function saveToStorage() {
            localStorage.setItem('nursing_sessions', JSON.stringify(appState.completedSessions));
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9872eaf343d0b9fb',t:'MTc1OTIyNjg5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>


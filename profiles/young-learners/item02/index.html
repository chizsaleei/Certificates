<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabGrow - Daily Vocabulary Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .bg-primary { background: linear-gradient(135deg, #1a3b2e, #2d5a3d, #1f4a35); }
        .bg-accent { background-color: #d4af37; }
        .text-accent { color: #d4af37; }
        .border-accent { border-color: #d4af37; }
        .hover-accent:hover { background-color: #f4d03f; }
        
        .vocab-card {
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .vocab-card:hover {
            background: rgba(212, 175, 55, 0.15);
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            border-color: #d4af37;
        }
        
        .vocab-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #d4af37, #f4d03f);
        }
        
        .nav-btn {
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, #d4af37, #f4d03f);
            color: #000;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }
        
        .nav-btn:not(.active) {
            background: transparent;
            color: #d4af37;
            border: 2px solid rgba(212, 175, 55, 0.6);
        }
        
        .word-card {
            background: rgba(26, 59, 46, 0.9);
            border: 2px solid rgba(212, 175, 55, 0.4);
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .word-card:hover {
            border-color: #d4af37;
            transform: scale(1.02);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .word-card.mastered {
            border-color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
        }
        
        .word-card.learning {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }
        
        .word-card.new {
            border-color: #f87171;
            background: rgba(248, 113, 113, 0.1);
        }
        
        .pronunciation-btn {
            background: linear-gradient(135deg, #d4af37, #f4d03f);
            color: #000;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .pronunciation-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
        }
        
        .streak-counter {
            background: linear-gradient(135deg, #ff6b35, #ff8c42);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        
        .progress-ring {
            width: 120px;
            height: 120px;
            border: 8px solid rgba(212, 175, 55, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1), transparent);
        }
        
        .progress-fill {
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            border: 8px solid transparent;
            border-top-color: #d4af37;
            transition: transform 0.5s ease;
        }
        
        .breathing-circle {
            width: 200px;
            height: 200px;
            border: 6px solid #d4af37;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            transition: transform 4s ease-in-out;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.15), transparent);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }
        
        .breathing-circle.inhale { transform: scale(1.4); }
        .breathing-circle.exhale { transform: scale(1); }
        
        .mini-task {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #d4af37;
            border-radius: 12px;
            padding: 20px;
            margin: 12px 0;
            transition: all 0.3s ease;
        }
        
        .mini-task:hover {
            background: rgba(212, 175, 55, 0.1);
            transform: translateY(-2px);
        }
        
        .recording-indicator {
            width: 20px;
            height: 20px;
            background: #ff4444;
            border-radius: 50%;
            animation: recordingPulse 1s infinite;
        }
        
        @keyframes recordingPulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #d4af37, #f4d03f);
            color: #000;
            padding: 30px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
            z-index: 2000;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            animation: achievementBounce 0.6s ease-out;
        }
        
        @keyframes achievementBounce {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .offline-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #ff4444;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }
        
        .online-indicator {
            background: #44ff44;
            color: #000;
        }
        
        .floating-add-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #d4af37, #f4d03f);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .floating-add-btn:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 12px 35px rgba(212, 175, 55, 0.6);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(26, 59, 46, 0.8);
            border: 2px solid rgba(212, 175, 55, 0.4);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            border-color: #d4af37;
            transform: translateY(-5px);
        }
        
        .difficulty-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .difficulty-easy { background: #4ade80; color: #000; }
        .difficulty-medium { background: #fbbf24; color: #000; }
        .difficulty-hard { background: #f87171; color: #000; }
        
        .spaced-review-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #8b5cf6;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-primary min-h-screen text-white">
    <!-- Connection Status -->
    <div id="connectionStatus" class="offline-indicator online-indicator">🟢 Online</div>

    <!-- Header -->
    <header class="p-6 text-center border-b-2 border-accent">
        <h1 class="text-4xl font-bold text-accent mb-2">📚 VocabGrow</h1>
        <p class="text-lg text-gray-300 mb-4">Build Your Vocabulary Daily!</p>
        
        <!-- Daily Progress -->
        <div class="flex justify-center items-center gap-8 flex-wrap">
            <div class="streak-counter">
                <span class="text-2xl">🔥</span>
                <span><span id="currentStreak">0</span> Day Streak</span>
            </div>
            <div class="text-center">
                <div class="progress-ring mb-2">
                    <div class="progress-fill" id="dailyProgressFill"></div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-accent" id="dailyProgress">0/10</div>
                        <div class="text-xs text-gray-400">Today</div>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-accent" id="totalWordsLearned">0</div>
                <div class="text-sm text-gray-400">Words Mastered</div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="p-4 flex justify-center gap-3 flex-wrap">
        <button onclick="showScreen('daily')" id="dailyBtn" class="nav-btn active">Daily Words</button>
        <button onclick="showScreen('practice')" id="practiceBtn" class="nav-btn">Practice</button>
        <button onclick="showScreen('review')" id="reviewBtn" class="nav-btn">Review</button>
        <button onclick="showScreen('phrases')" id="phrasesBtn" class="nav-btn">Phrases</button>
        <button onclick="showScreen('focus')" id="focusBtn" class="nav-btn">Focus</button>
        <button onclick="showScreen('progress')" id="progressBtn" class="nav-btn">Progress</button>
    </nav>

    <!-- Floating Add Button -->
    <div onclick="quickAddWord()" class="floating-add-btn" title="Quick Add Word">+</div>

    <!-- Daily Words Screen -->
    <div id="dailyScreen" class="screen p-6">
        <div class="max-w-4xl mx-auto space-y-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-accent mb-4">📅 Today's 10 Words</h2>
                <p class="text-gray-300 mb-6">Learn these words to maintain your streak!</p>
            </div>

            <!-- Daily Words List -->
            <div id="dailyWordsList" class="space-y-6">
                <!-- Daily words will be populated here -->
            </div>

            <!-- Mini Tasks -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">🎯 Today's Mini Tasks</h3>
                <div id="miniTasksList" class="space-y-4">
                    <!-- Mini tasks will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Practice Screen -->
    <div id="practiceScreen" class="screen hidden p-6">
        <div class="max-w-4xl mx-auto space-y-8">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-accent">🎮 Practice Mode</h2>
                <div class="flex gap-3">
                    <button onclick="startRandomPractice()" class="bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold">
                        🎲 Random Practice
                    </button>
                    <button onclick="startAudioPractice()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold">
                        🎤 Audio Practice
                    </button>
                </div>
            </div>

            <!-- Practice Categories -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="vocab-card cursor-pointer" onclick="startPracticeMode('pronunciation')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🗣️</div>
                        <div class="font-bold text-accent text-lg mb-2">Pronunciation</div>
                        <div class="text-gray-300 text-sm">Practice saying words correctly</div>
                    </div>
                </div>
                
                <div class="vocab-card cursor-pointer" onclick="startPracticeMode('spelling')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">✏️</div>
                        <div class="font-bold text-accent text-lg mb-2">Spelling</div>
                        <div class="text-gray-300 text-sm">Test your spelling skills</div>
                    </div>
                </div>
                
                <div class="vocab-card cursor-pointer" onclick="startPracticeMode('meaning')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🧠</div>
                        <div class="font-bold text-accent text-lg mb-2">Meaning</div>
                        <div class="text-gray-300 text-sm">Match words with definitions</div>
                    </div>
                </div>
                
                <div class="vocab-card cursor-pointer" onclick="startPracticeMode('sentences')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">📝</div>
                        <div class="font-bold text-accent text-lg mb-2">Sentence Builder</div>
                        <div class="text-gray-300 text-sm">Create sentences with new words</div>
                    </div>
                </div>
                
                <div class="vocab-card cursor-pointer" onclick="startPracticeMode('storytelling')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">📚</div>
                        <div class="font-bold text-accent text-lg mb-2">Story Practice</div>
                        <div class="text-gray-300 text-sm">Use words in creative stories</div>
                    </div>
                </div>
                
                <div class="vocab-card cursor-pointer" onclick="startPracticeMode('phrases')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💬</div>
                        <div class="font-bold text-accent text-lg mb-2">Phrase Practice</div>
                        <div class="text-gray-300 text-sm">Practice power phrases in context</div>
                    </div>
                </div>
            </div>

            <!-- Practice Session -->
            <div id="practiceSession" class="hidden">
                <div class="vocab-card">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-accent mb-2" id="practiceTitle">Practice Session</h3>
                        <div class="text-gray-400">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></div>
                    </div>
                    
                    <div id="practiceContent" class="text-center">
                        <!-- Practice content will be loaded here -->
                    </div>
                    
                    <div class="flex justify-center gap-4 mt-6">
                        <button onclick="skipQuestion()" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold">
                            ⏭️ Skip
                        </button>
                        <button onclick="endPractice()" class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold">
                            ⏹️ End Practice
                        </button>
                    </div>
                </div>
            </div>

            <!-- Offline Practice Lists -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">📱 Offline Practice Lists</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="generateOfflineList('recent')" class="bg-green-600 text-white p-4 rounded-lg font-bold">
                        📋 Recent Words (Last 50)
                    </button>
                    <button onclick="generateOfflineList('difficult')" class="bg-orange-600 text-white p-4 rounded-lg font-bold">
                        🔥 Difficult Words
                    </button>
                    <button onclick="generateOfflineList('favorites')" class="bg-purple-600 text-white p-4 rounded-lg font-bold">
                        ⭐ Favorite Words
                    </button>
                    <button onclick="generateOfflineList('custom')" class="bg-blue-600 text-white p-4 rounded-lg font-bold">
                        ✨ Custom List
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Screen -->
    <div id="reviewScreen" class="screen hidden p-6">
        <div class="max-w-4xl mx-auto space-y-8">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-accent">🔄 Spaced Review</h2>
                <div class="text-accent font-bold">
                    <span id="reviewWordsCount">0</span> words due for review
                </div>
            </div>

            <!-- Review Categories -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="text-3xl text-red-400 mb-2">🆕</div>
                    <div class="text-2xl font-bold text-white" id="newWordsCount">0</div>
                    <div class="text-gray-400">New Words</div>
                </div>
                
                <div class="stat-card">
                    <div class="text-3xl text-yellow-400 mb-2">📚</div>
                    <div class="text-2xl font-bold text-white" id="learningWordsCount">0</div>
                    <div class="text-gray-400">Learning</div>
                </div>
                
                <div class="stat-card">
                    <div class="text-3xl text-green-400 mb-2">✅</div>
                    <div class="text-2xl font-bold text-white" id="masteredWordsCount">0</div>
                    <div class="text-gray-400">Mastered</div>
                </div>
            </div>

            <!-- Words Due for Review -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">📝 Review Queue</h3>
                <div id="reviewWordsList" class="space-y-4">
                    <!-- Review words will be populated here -->
                </div>
                <div class="text-center mt-6">
                    <button onclick="startReviewSession()" class="bg-accent text-black px-8 py-4 rounded-lg font-bold text-lg">
                        🚀 Start Review Session
                    </button>
                </div>
            </div>

            <!-- Review Session -->
            <div id="reviewSession" class="hidden">
                <div class="vocab-card">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-accent mb-2">Review Session</h3>
                        <div class="text-gray-400">Card <span id="reviewCurrentCard">1</span> of <span id="reviewTotalCards">0</span></div>
                    </div>
                    
                    <div id="reviewCard" class="text-center mb-6">
                        <!-- Review card content -->
                    </div>
                    
                    <div class="flex justify-center gap-4">
                        <button onclick="reviewAnswer('hard')" class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold">
                            😰 Hard
                        </button>
                        <button onclick="reviewAnswer('good')" class="bg-yellow-600 text-white px-6 py-3 rounded-lg font-bold">
                            😊 Good
                        </button>
                        <button onclick="reviewAnswer('easy')" class="bg-green-600 text-white px-6 py-3 rounded-lg font-bold">
                            😎 Easy
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Phrases Screen -->
    <div id="phrasesScreen" class="screen hidden p-6">
        <div class="max-w-4xl mx-auto space-y-8">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-accent">💬 Power Phrases</h2>
                <button onclick="getRandomPhrase()" class="bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold">
                    🎲 Random Phrase
                </button>
            </div>

            <!-- Phrase Categories -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="vocab-card">
                    <h3 class="text-xl font-bold text-accent mb-4">🔗 Transitions</h3>
                    <div class="space-y-3" id="transitionPhrases">
                        <!-- Transition phrases will be populated here -->
                    </div>
                </div>

                <div class="vocab-card">
                    <h3 class="text-xl font-bold text-accent mb-4">💪 Power Expressions</h3>
                    <div class="space-y-3" id="powerExpressions">
                        <!-- Power expressions will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Custom Phrases -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">✨ Your Custom Phrases</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="flex gap-2">
                        <input type="text" id="newPhrase" placeholder="Enter new phrase..." 
                               class="flex-1 p-3 rounded-lg bg-gray-800 border border-accent text-white">
                        <button onclick="startVoiceInput('newPhrase')" class="voice-input-btn bg-blue-600 text-white px-3 py-2 rounded-lg font-bold">
                            🎤
                        </button>
                    </div>
                    <input type="text" id="newPhraseCategory" placeholder="Category..." 
                           class="w-full p-3 rounded-lg bg-gray-800 border border-accent text-white">
                </div>
                <button onclick="saveCustomPhrase()" class="w-full bg-accent text-black p-3 rounded-lg font-bold mb-4">
                    💾 Save Phrase
                </button>
                <div id="customPhrasesList" class="space-y-3">
                    <!-- Custom phrases will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Focus Screen -->
    <div id="focusScreen" class="screen hidden p-6">
        <div class="max-w-2xl mx-auto text-center space-y-8">
            <h2 class="text-3xl font-bold text-accent">🧘 Focus & Reset</h2>
            
            <div class="breathing-circle" id="breathingCircle">
                <div class="text-accent font-bold text-2xl" id="breathingInstruction">Ready to Focus</div>
            </div>
            
            <div class="text-accent text-5xl font-bold" id="focusTimer">25:00</div>
            
            <div id="motivationalMessage" class="text-white text-xl italic px-6 min-h-16 flex items-center justify-center bg-black bg-opacity-40 rounded-lg">
                "Every word you learn opens new doors of understanding!"
            </div>
            
            <div class="flex justify-center gap-4">
                <button onclick="startFocusSession()" id="startFocusBtn" 
                        class="bg-accent text-black px-8 py-4 rounded-lg font-bold text-lg">
                    ▶️ Start Focus Session
                </button>
                <button onclick="stopFocusSession()" id="stopFocusBtn" 
                        class="bg-red-600 text-white px-8 py-4 rounded-lg font-bold text-lg" disabled>
                    ⏹️ Stop Session
                </button>
            </div>
            
            <!-- Custom Motivational Messages -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">💭 Your Motivational Messages</h3>
                <div class="flex gap-3 mb-4">
                    <input type="text" id="newMotivationalMessage" placeholder="Add your motivational message..." 
                           class="flex-1 p-3 rounded-lg bg-gray-800 border border-accent text-white">
                    <button onclick="startVoiceInput('newMotivationalMessage')" class="voice-input-btn bg-blue-600 text-white px-3 py-3 rounded-lg font-bold">
                        🎤
                    </button>
                    <button onclick="addMotivationalMessage()" class="bg-accent text-black px-6 py-3 rounded-lg font-bold">
                        Add
                    </button>
                </div>
                <div id="customMotivationalMessages" class="space-y-2">
                    <!-- Custom messages will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Screen -->
    <div id="progressScreen" class="screen hidden p-6">
        <div class="max-w-6xl mx-auto space-y-8">
            <h2 class="text-3xl font-bold text-accent text-center">📊 Your Learning Journey</h2>
            
            <!-- Stats Overview -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="text-4xl text-accent mb-2">📚</div>
                    <div class="text-2xl font-bold text-white" id="totalWordsStats">0</div>
                    <div class="text-gray-400">Total Words</div>
                </div>
                
                <div class="stat-card">
                    <div class="text-4xl text-accent mb-2">🔥</div>
                    <div class="text-2xl font-bold text-white" id="longestStreakStats">0</div>
                    <div class="text-gray-400">Longest Streak</div>
                </div>
                
                <div class="stat-card">
                    <div class="text-4xl text-accent mb-2">⏱️</div>
                    <div class="text-2xl font-bold text-white" id="studyTimeStats">0</div>
                    <div class="text-gray-400">Hours Studied</div>
                </div>
                
                <div class="stat-card">
                    <div class="text-4xl text-accent mb-2">🎯</div>
                    <div class="text-2xl font-bold text-white" id="accuracyStats">0%</div>
                    <div class="text-gray-400">Accuracy</div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">💾 Data Management</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <button onclick="exportProgressPDF()" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">
                        📄 Export PDF
                    </button>
                    <button onclick="backupData()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold">
                        💾 Backup Data
                    </button>
                    <button onclick="importData()" class="bg-green-600 text-white px-6 py-3 rounded-lg font-bold">
                        📥 Import Data
                    </button>
                    <button onclick="syncData()" class="bg-yellow-600 text-white px-6 py-3 rounded-lg font-bold">
                        🔄 Sync Data
                    </button>
                </div>
            </div>

            <!-- Recordings -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">🎤 Your Recordings</h3>
                <div id="recordingsList" class="space-y-3">
                    <!-- Recordings will be populated here -->
                </div>
            </div>

            <!-- User Stories -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">📚 Your Creative Stories</h3>
                <div id="userStoriesList" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- User stories will be populated here -->
                </div>
            </div>

            <!-- Word Management -->
            <div class="vocab-card">
                <h3 class="text-xl font-bold text-accent mb-4">📝 Manage Your Words</h3>
                <div class="mb-4 flex gap-3">
                    <input type="text" id="searchWords" placeholder="Search your words..." 
                           class="flex-1 p-3 rounded-lg bg-gray-800 border border-accent text-white">
                    <button onclick="startVoiceInput('searchWords')" class="voice-input-btn bg-blue-600 text-white px-4 py-3 rounded-lg font-bold">
                        🎤 Voice Search
                    </button>
                </div>
                <div id="allWordsList" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- All words will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Add Modal -->
    <div id="quickAddModal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-lg max-w-2xl w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-accent">➕ Quick Add Word</h3>
                <button onclick="closeQuickAddModal()" class="text-gray-400 hover:text-white text-2xl">✕</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-white font-semibold mb-2">Word</label>
                    <input type="text" id="quickAddWord" placeholder="Enter word..." 
                           class="w-full p-3 rounded-lg bg-gray-700 border border-accent text-white">
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-2">Definition</label>
                    <div class="flex gap-2">
                        <textarea id="quickAddDefinition" rows="3" placeholder="Enter definition..." 
                                  class="flex-1 p-3 rounded-lg bg-gray-700 border border-accent text-white"></textarea>
                        <button onclick="startVoiceInput('quickAddDefinition')" class="voice-input-btn bg-blue-600 text-white px-3 py-2 rounded-lg font-bold">
                            🎤
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-2">Example Sentence</label>
                    <div class="flex gap-2">
                        <textarea id="quickAddExample" rows="2" placeholder="Enter example sentence..." 
                                  class="flex-1 p-3 rounded-lg bg-gray-700 border border-accent text-white"></textarea>
                        <button onclick="startVoiceInput('quickAddExample')" class="voice-input-btn bg-blue-600 text-white px-3 py-2 rounded-lg font-bold">
                            🎤
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-2">Difficulty</label>
                    <select id="quickAddDifficulty" class="w-full p-3 rounded-lg bg-gray-700 border border-accent text-white">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                
                <div class="flex gap-4">
                    <button onclick="recordPronunciation()" id="recordBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold flex-1">
                        🎤 Record Pronunciation
                    </button>
                    <button onclick="stopRecording()" id="stopRecordBtn" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold flex-1" disabled>
                        ⏹️ Stop Recording
                    </button>
                </div>
                
                <div id="recordingIndicator" class="hidden flex items-center justify-center gap-2 text-red-400">
                    <div class="recording-indicator"></div>
                    <span>Recording...</span>
                </div>
                
                <button onclick="saveQuickAddWord()" class="w-full bg-accent text-black p-3 rounded-lg font-bold text-lg">
                    💾 Save Word
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let appData = {
            words: [],
            dailyWords: [],
            phrases: {
                transitions: [
                    "Furthermore, it's important to note that...",
                    "On the other hand, we should consider...",
                    "As a result of this, we can conclude...",
                    "In addition to this, we must remember...",
                    "Nevertheless, it's crucial to understand..."
                ],
                powerExpressions: [
                    "I'd like to emphasize the significance of...",
                    "It's worth mentioning that...",
                    "From my perspective, I believe...",
                    "What strikes me as particularly important is...",
                    "I cannot stress enough how vital it is..."
                ],
                custom: []
            },
            progress: {
                streak: 0,
                longestStreak: 0,
                totalWords: 0,
                studyTime: 0,
                accuracy: 0,
                dailyProgress: 0
            },
            recordings: [],
            motivationalMessages: [
                "Every word you learn opens new doors of understanding!",
                "Vocabulary is the foundation of great communication!",
                "Your dedication to learning is truly inspiring!",
                "Each new word makes you more eloquent!",
                "Building vocabulary is building confidence!"
            ],
            settings: {
                dailyGoal: 10,
                reviewInterval: 24
            },
            lastActiveDate: null
        };

        // Advanced vocabulary bank
        const vocabularyBank = [
            { word: "Eloquent", definition: "Fluent and persuasive in speaking or writing", example: "Her eloquent speech moved the audience to tears.", difficulty: "medium", pronunciation: "/ˈɛləkwənt/" },
            { word: "Meticulous", definition: "Showing great attention to detail; very careful", example: "He was meticulous in his research methodology.", difficulty: "medium", pronunciation: "/məˈtɪkjələs/" },
            { word: "Ubiquitous", definition: "Present, appearing, or found everywhere", example: "Smartphones have become ubiquitous in modern society.", difficulty: "hard", pronunciation: "/juːˈbɪkwɪtəs/" },
            { word: "Pragmatic", definition: "Dealing with things sensibly and realistically", example: "She took a pragmatic approach to solving the problem.", difficulty: "medium", pronunciation: "/præɡˈmætɪk/" },
            { word: "Ephemeral", definition: "Lasting for a very short time", example: "The beauty of cherry blossoms is ephemeral but memorable.", difficulty: "hard", pronunciation: "/ɪˈfɛmərəl/" },
            { word: "Serendipity", definition: "The occurrence of events by chance in a happy way", example: "Finding that book was pure serendipity.", difficulty: "medium", pronunciation: "/ˌsɛrənˈdɪpɪti/" },
            { word: "Resilient", definition: "Able to withstand or recover quickly from difficulties", example: "Children are remarkably resilient creatures.", difficulty: "easy", pronunciation: "/rɪˈzɪljənt/" },
            { word: "Ambiguous", definition: "Open to more than one interpretation; unclear", example: "The contract's terms were deliberately ambiguous.", difficulty: "medium", pronunciation: "/æmˈbɪɡjuəs/" },
            { word: "Innovative", definition: "Featuring new methods; advanced and original", example: "The company's innovative approach revolutionized the industry.", difficulty: "easy", pronunciation: "/ˈɪnəˌveɪtɪv/" },
            { word: "Contemplative", definition: "Expressing or involving prolonged thought", example: "She sat in contemplative silence by the window.", difficulty: "medium", pronunciation: "/kənˈtɛmplətɪv/" }
        ];

        let currentPracticeSession = null;
        let currentReviewSession = null;
        let focusTimer = null;
        let breathingInterval = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isOnline = navigator.onLine;
        let speechRecognition = null;
        let isListening = false;
        let currentVoiceTarget = null;
        let currentPronunciationTarget = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            updateAllStats();
            generateDailyWords();
            loadPhrases();
            checkConnection();
            updateStreak();
            initializeSpeechRecognition();
            
            // Setup search functionality
            document.getElementById('searchWords').addEventListener('input', searchWords);
            
            // Check for offline/online status
            window.addEventListener('online', () => {
                isOnline = true;
                updateConnectionStatus();
                syncData();
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateConnectionStatus();
            });
        });

        // Data Management
        function loadAppData() {
            const savedData = localStorage.getItem('vocabGrowData');
            if (savedData) {
                const data = JSON.parse(savedData);
                appData = { ...appData, ...data };
            }
        }

        function saveAppData() {
            appData.lastSaveDate = new Date().toISOString();
            localStorage.setItem('vocabGrowData', JSON.stringify(appData));
            
            if (isOnline) {
                console.log('Data synced to cloud');
            }
        }

        function updateConnectionStatus() {
            const indicator = document.getElementById('connectionStatus');
            if (isOnline) {
                indicator.textContent = '🟢 Online';
                indicator.className = 'offline-indicator online-indicator';
            } else {
                indicator.textContent = '🔴 Offline';
                indicator.className = 'offline-indicator';
            }
        }

        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                speechRecognition = new SpeechRecognition();
                
                speechRecognition.continuous = false;
                speechRecognition.interimResults = false;
                speechRecognition.lang = 'en-US';
                
                speechRecognition.onstart = function() {
                    isListening = true;
                    updateVoiceButtons();
                };
                
                speechRecognition.onend = function() {
                    isListening = false;
                    updateVoiceButtons();
                };
                
                speechRecognition.onerror = function(event) {
                    isListening = false;
                    updateVoiceButtons();
                    showNotification(`Voice recognition error: ${event.error}`);
                };
                
                speechRecognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    handleVoiceInput(transcript);
                };
            }
        }

        function updateVoiceButtons() {
            const voiceButtons = document.querySelectorAll('.voice-input-btn');
            voiceButtons.forEach(btn => {
                if (isListening) {
                    btn.innerHTML = '🔴 Listening...';
                    btn.classList.add('bg-red-600');
                    btn.classList.remove('bg-blue-600');
                } else {
                    btn.innerHTML = '🎤 Voice Input';
                    btn.classList.add('bg-blue-600');
                    btn.classList.remove('bg-red-600');
                }
            });
        }

        function startVoiceInput(targetInputId) {
            if (!speechRecognition) {
                showNotification('Voice recognition not supported in this browser');
                return;
            }
            
            if (isListening) {
                speechRecognition.stop();
                return;
            }
            
            currentVoiceTarget = targetInputId;
            speechRecognition.start();
        }

        function handleVoiceInput(transcript) {
            if (currentVoiceTarget) {
                const targetElement = document.getElementById(currentVoiceTarget);
                if (targetElement) {
                    if (targetElement.tagName === 'TEXTAREA' || targetElement.tagName === 'INPUT') {
                        targetElement.value = transcript;
                        showNotification(`Voice input: "${transcript}"`);
                    }
                }
            } else if (currentVoiceTarget === 'pronunciation-check') {
                // Handle pronunciation checking
                checkPronunciationAccuracy(transcript);
            }
        }

        function startPronunciationCheck(targetWord) {
            if (!speechRecognition) {
                showNotification('Voice recognition not supported in this browser');
                return;
            }
            
            if (isListening) {
                speechRecognition.stop();
                return;
            }
            
            currentVoiceTarget = 'pronunciation-check';
            currentPronunciationTarget = targetWord.toLowerCase();
            
            // Show listening indicator
            const btn = event.target;
            btn.innerHTML = '🔴 Listening...';
            btn.classList.add('bg-red-600');
            btn.classList.remove('bg-blue-600');
            
            speechRecognition.start();
        }

        function checkPronunciationAccuracy(spokenWord) {
            const resultDiv = document.getElementById('pronunciationResult');
            const feedbackDiv = document.getElementById('pronunciationFeedback');
            const accuracyDiv = document.getElementById('pronunciationAccuracy');
            
            if (!currentPronunciationTarget) return;
            
            const spoken = spokenWord.toLowerCase().trim();
            const target = currentPronunciationTarget.toLowerCase().trim();
            
            // Simple pronunciation accuracy check
            let accuracy = 0;
            let feedback = '';
            
            if (spoken === target) {
                accuracy = 100;
                feedback = '🎉 Perfect pronunciation!';
                currentPracticeSession.score++;
            } else if (spoken.includes(target) || target.includes(spoken)) {
                accuracy = 75;
                feedback = '👍 Very close! Good effort!';
                currentPracticeSession.score += 0.75;
            } else {
                // Check for similar sounds using basic phonetic similarity
                const similarity = calculateSimilarity(spoken, target);
                if (similarity > 0.6) {
                    accuracy = Math.round(similarity * 100);
                    feedback = '🔄 Getting there! Try again.';
                    currentPracticeSession.score += similarity;
                } else {
                    accuracy = 25;
                    feedback = '💪 Keep practicing! Listen carefully.';
                    currentPracticeSession.score += 0.25;
                }
            }
            
            feedbackDiv.textContent = feedback;
            accuracyDiv.textContent = `You said: "${spokenWord}" | Accuracy: ${accuracy}%`;
            resultDiv.classList.remove('hidden');
            
            // Reset pronunciation target
            currentPronunciationTarget = null;
            currentVoiceTarget = null;
            
            // Reset button
            const voiceButtons = document.querySelectorAll('.voice-input-btn');
            voiceButtons.forEach(btn => {
                btn.innerHTML = '🎯 Voice Recognition Check';
                btn.classList.add('bg-blue-600');
                btn.classList.remove('bg-red-600');
            });
        }

        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        function checkConnection() {
            isOnline = navigator.onLine;
            updateConnectionStatus();
        }

        // Screen Management
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(screenName + 'Screen').classList.remove('hidden');
            document.getElementById(screenName + 'Btn').classList.add('active');
            
            // Load screen-specific data
            switch(screenName) {
                case 'daily': loadDailyWords(); break;
                case 'practice': loadPracticeScreen(); break;
                case 'review': loadReviewScreen(); break;
                case 'phrases': loadPhrases(); break;
                case 'progress': loadProgressScreen(); break;
            }
        }

        // Daily Words Functions
        function generateDailyWords() {
            const today = new Date().toDateString();
            
            if (appData.lastActiveDate !== today) {
                // Generate new daily words
                const availableWords = vocabularyBank.filter(word => 
                    !appData.words.some(w => w.word === word.word)
                );
                
                if (availableWords.length >= 10) {
                    appData.dailyWords = availableWords.slice(0, 10).map(word => ({
                        ...word,
                        id: Date.now().toString() + Math.random(),
                        dateAdded: today,
                        status: 'new',
                        reviewDate: null,
                        attempts: 0,
                        correctAttempts: 0
                    }));
                } else {
                    // If not enough new words, mix with review words
                    appData.dailyWords = [...availableWords, ...getRandomWords(10 - availableWords.length)];
                }
                
                appData.progress.dailyProgress = 0;
                generateMiniTasks();
            }
        }

        function getRandomWords(count) {
            const shuffled = [...vocabularyBank].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count).map(word => ({
                ...word,
                id: Date.now().toString() + Math.random(),
                dateAdded: new Date().toDateString(),
                status: 'new',
                reviewDate: null,
                attempts: 0,
                correctAttempts: 0
            }));
        }

        function loadDailyWords() {
            const container = document.getElementById('dailyWordsList');
            
            if (appData.dailyWords.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">No daily words available. Check back tomorrow!</div>';
                return;
            }
            
            container.innerHTML = appData.dailyWords.map(word => `
                <div class="word-card ${word.status}" id="word-${word.id}">
                    ${word.status === 'new' ? '<div class="spaced-review-indicator">NEW</div>' : ''}
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-4 mb-2">
                                <h3 class="text-2xl font-bold text-accent">${word.word}</h3>
                                <button onclick="pronounceWord('${word.word}')" class="pronunciation-btn">
                                    🔊
                                </button>
                                <span class="difficulty-badge difficulty-${word.difficulty}">${word.difficulty}</span>
                            </div>
                            <div class="text-gray-300 mb-2">${word.pronunciation || ''}</div>
                            <div class="text-white mb-3">${word.definition}</div>
                            <div class="text-gray-400 italic">"${word.example}"</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-4">
                        <button onclick="markWordLearned('${word.id}')" class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold">
                            ✅ Learned
                        </button>
                        <button onclick="addToFavorites('${word.id}')" class="bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold">
                            ⭐ Favorite
                        </button>
                        <button onclick="practiceWord('${word.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold">
                            🎯 Practice
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function generateMiniTasks() {
            const tasks = [
                {
                    title: "Pronunciation Challenge",
                    description: "Record yourself saying 5 words clearly",
                    type: "pronunciation",
                    target: 5,
                    completed: 0
                },
                {
                    title: "Sentence Builder",
                    description: "Create sentences using 3 new words",
                    type: "sentences",
                    target: 3,
                    completed: 0
                },
                {
                    title: "Definition Match",
                    description: "Match all 10 words with their definitions",
                    type: "matching",
                    target: 10,
                    completed: 0
                }
            ];
            
            const container = document.getElementById('miniTasksList');
            container.innerHTML = tasks.map((task, index) => `
                <div class="mini-task">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-white mb-1">${task.title}</h4>
                            <p class="text-gray-400 text-sm">${task.description}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-accent font-bold">${task.completed}/${task.target}</div>
                            <button onclick="startMiniTask(${index})" class="bg-accent text-black px-3 py-1 rounded mt-2 text-sm font-semibold">
                                Start
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function markWordLearned(wordId) {
            const word = appData.dailyWords.find(w => w.id === wordId);
            if (word) {
                word.status = 'learning';
                word.reviewDate = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(); // Review tomorrow
                
                // Add to main words collection
                appData.words.push(word);
                
                appData.progress.dailyProgress++;
                appData.progress.totalWords++;
                
                updateAllStats();
                saveAppData();
                
                showAchievement(`🎉 Word learned: ${word.word}!`);
                
                // Update the card appearance
                const cardElement = document.getElementById(`word-${wordId}`);
                if (cardElement) {
                    cardElement.className = 'word-card learning';
                }
                
                checkDailyGoalComplete();
            }
        }

        function checkDailyGoalComplete() {
            if (appData.progress.dailyProgress >= appData.settings.dailyGoal) {
                appData.progress.streak++;
                if (appData.progress.streak > appData.progress.longestStreak) {
                    appData.progress.longestStreak = appData.progress.streak;
                }
                
                showAchievement(`🔥 Daily goal complete! ${appData.progress.streak} day streak!`);
                updateStreak();
                saveAppData();
            }
        }

        function addToFavorites(wordId) {
            const word = appData.dailyWords.find(w => w.id === wordId);
            if (word) {
                word.favorite = true;
                saveAppData();
                showNotification(`⭐ ${word.word} added to favorites!`);
            }
        }

        function practiceWord(wordId) {
            const word = appData.dailyWords.find(w => w.id === wordId);
            if (word) {
                startWordPractice(word);
            }
        }

        function pronounceWord(word) {
            // Simulate pronunciation (in a real app, this would use text-to-speech)
            showNotification(`🔊 Pronouncing: ${word}`);
            
            // If browser supports speech synthesis
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            }
        }

        // Practice Functions
        function loadPracticeScreen() {
            // Reset practice session
            document.getElementById('practiceSession').classList.add('hidden');
        }

        function startPracticeMode(mode) {
            const words = [...appData.words, ...appData.dailyWords].slice(0, 10);
            
            if (words.length === 0) {
                showNotification('No words available for practice. Learn some words first!');
                return;
            }
            
            currentPracticeSession = {
                mode: mode,
                words: words,
                currentIndex: 0,
                score: 0,
                answers: []
            };
            
            document.getElementById('practiceSession').classList.remove('hidden');
            document.getElementById('practiceTitle').textContent = `${mode.charAt(0).toUpperCase() + mode.slice(1)} Practice`;
            document.getElementById('totalQuestions').textContent = words.length;
            
            loadPracticeQuestion();
        }

        function loadPracticeQuestion() {
            if (!currentPracticeSession) return;
            
            const { mode, words, currentIndex } = currentPracticeSession;
            const word = words[currentIndex];
            
            document.getElementById('currentQuestion').textContent = currentIndex + 1;
            
            const container = document.getElementById('practiceContent');
            
            switch(mode) {
                case 'pronunciation':
                    container.innerHTML = `
                        <div class="text-center">
                            <h4 class="text-3xl font-bold text-accent mb-4">${word.word}</h4>
                            <p class="text-gray-300 mb-6">${word.pronunciation || ''}</p>
                            <button onclick="pronounceWord('${word.word}')" class="pronunciation-btn mb-6">
                                🔊
                            </button>
                            <div class="mb-6 space-y-3">
                                <button onclick="startRecordingPractice()" id="practiceRecordBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold block mx-auto">
                                    🎤 Record Your Pronunciation
                                </button>
                                <button onclick="startPronunciationCheck('${word.word}')" class="voice-input-btn bg-blue-600 text-white px-6 py-3 rounded-lg font-bold block mx-auto">
                                    🎯 Voice Recognition Check
                                </button>
                                <div id="pronunciationResult" class="text-center mt-4 hidden">
                                    <div id="pronunciationFeedback" class="text-lg font-bold mb-2"></div>
                                    <div id="pronunciationAccuracy" class="text-sm text-gray-400"></div>
                                </div>
                            </div>
                            <button onclick="nextPracticeQuestion()" class="bg-accent text-black px-8 py-3 rounded-lg font-bold">
                                Next Word
                            </button>
                        </div>
                    `;
                    break;
                    
                case 'spelling':
                    container.innerHTML = `
                        <div class="text-center">
                            <p class="text-gray-300 mb-4">Listen and spell this word:</p>
                            <button onclick="pronounceWord('${word.word}')" class="pronunciation-btn mb-6">
                                🔊
                            </button>
                            <div class="flex gap-3 justify-center mb-6">
                                <input type="text" id="spellingInput" placeholder="Type the word..." 
                                       class="flex-1 max-w-md p-3 rounded-lg bg-gray-700 border border-accent text-white text-center text-xl">
                                <button onclick="startVoiceInput('spellingInput')" class="voice-input-btn bg-blue-600 text-white px-4 py-3 rounded-lg font-bold">
                                    🎤 Voice Input
                                </button>
                            </div>
                            <div>
                                <button onclick="checkSpelling('${word.word}')" class="bg-accent text-black px-8 py-3 rounded-lg font-bold">
                                    Check Spelling
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'meaning':
                    const options = generateMeaningOptions(word);
                    container.innerHTML = `
                        <div class="text-center">
                            <h4 class="text-3xl font-bold text-accent mb-6">${word.word}</h4>
                            <p class="text-gray-300 mb-6">What does this word mean?</p>
                            <div class="space-y-3">
                                ${options.map((option, index) => `
                                    <button onclick="checkMeaning('${word.definition}', '${option}')" 
                                            class="w-full p-4 bg-gray-700 hover:bg-gray-600 rounded-lg text-white text-left">
                                        ${String.fromCharCode(65 + index)}. ${option}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'sentences':
                    container.innerHTML = `
                        <div class="text-center">
                            <h4 class="text-3xl font-bold text-accent mb-4">${word.word}</h4>
                            <p class="text-gray-300 mb-2">${word.definition}</p>
                            <p class="text-gray-400 mb-6">Create a sentence using this word:</p>
                            <div class="mb-6">
                                <textarea id="sentenceInput" rows="3" placeholder="Write your sentence here..." 
                                          class="w-full p-4 rounded-lg bg-gray-700 border border-accent text-white mb-3"></textarea>
                                <button onclick="startVoiceInput('sentenceInput')" class="voice-input-btn bg-blue-600 text-white px-4 py-2 rounded-lg font-bold">
                                    🎤 Voice Input
                                </button>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-400 mb-2">Example: "${word.example}"</p>
                            </div>
                            <button onclick="checkSentence('${word.word}')" class="bg-accent text-black px-8 py-3 rounded-lg font-bold">
                                Check Sentence
                            </button>
                        </div>
                    `;
                    break;
                    
                case 'storytelling':
                    const storyPrompt = generateStoryPrompt(words);
                    container.innerHTML = `
                        <div class="text-center">
                            <h4 class="text-2xl font-bold text-accent mb-4">📚 Story Challenge</h4>
                            <div class="bg-gray-800 p-4 rounded-lg mb-6">
                                <p class="text-gray-300 mb-4"><strong>Story Prompt:</strong> ${storyPrompt.prompt}</p>
                                <div class="flex flex-wrap gap-2 justify-center">
                                    ${storyPrompt.words.map(w => `
                                        <span class="bg-accent text-black px-3 py-1 rounded-full text-sm font-bold">${w}</span>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="mb-6">
                                <textarea id="storyInput" rows="6" placeholder="Write your story using the words above..." 
                                          class="w-full p-4 rounded-lg bg-gray-700 border border-accent text-white mb-3"></textarea>
                                <button onclick="startVoiceInput('storyInput')" class="voice-input-btn bg-blue-600 text-white px-4 py-2 rounded-lg font-bold">
                                    🎤 Voice Input
                                </button>
                            </div>
                            <div class="flex gap-4 justify-center">
                                <button onclick="checkStory()" class="bg-accent text-black px-6 py-3 rounded-lg font-bold">
                                    📖 Submit Story
                                </button>
                                <button onclick="getStoryHint()" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">
                                    💡 Get Hint
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'phrases':
                    const phraseChallenge = generatePhraseChallenge();
                    container.innerHTML = `
                        <div class="text-center">
                            <h4 class="text-2xl font-bold text-accent mb-4">💬 Phrase in Context</h4>
                            <div class="bg-gray-800 p-4 rounded-lg mb-6">
                                <p class="text-accent font-bold text-lg mb-2">"${phraseChallenge.phrase}"</p>
                                <p class="text-gray-400 text-sm">${phraseChallenge.meaning}</p>
                            </div>
                            <p class="text-gray-300 mb-4">Use this phrase in a conversation or situation:</p>
                            <div class="mb-6">
                                <textarea id="phraseInput" rows="4" placeholder="Write how you would use this phrase..." 
                                          class="w-full p-4 rounded-lg bg-gray-700 border border-accent text-white mb-3"></textarea>
                                <button onclick="startVoiceInput('phraseInput')" class="voice-input-btn bg-blue-600 text-white px-4 py-2 rounded-lg font-bold">
                                    🎤 Voice Input
                                </button>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-400">Example context: ${phraseChallenge.example}</p>
                            </div>
                            <button onclick="checkPhraseUsage()" class="bg-accent text-black px-8 py-3 rounded-lg font-bold">
                                Check Usage
                            </button>
                        </div>
                    `;
                    break;
            }
        }

        function generateMeaningOptions(correctWord) {
            const options = [correctWord.definition];
            const otherWords = vocabularyBank.filter(w => w.word !== correctWord.word);
            
            while (options.length < 4 && otherWords.length > 0) {
                const randomWord = otherWords[Math.floor(Math.random() * otherWords.length)];
                if (!options.includes(randomWord.definition)) {
                    options.push(randomWord.definition);
                }
                otherWords.splice(otherWords.indexOf(randomWord), 1);
            }
            
            return options.sort(() => Math.random() - 0.5);
        }

        function generateStoryPrompt(words) {
            const storyPrompts = [
                "Write a story about a young explorer who discovers a hidden treasure",
                "Tell the tale of a student who must solve a mysterious puzzle at school",
                "Create a story about someone who finds a magical object that changes their life",
                "Write about a character who must overcome a difficult challenge using their skills",
                "Tell a story about friendship and how it helps people through tough times",
                "Create a tale about someone who learns an important lesson about perseverance",
                "Write about a character who discovers they have a special talent",
                "Tell a story about a community coming together to solve a problem",
                "Create a story about someone who travels to an unusual place",
                "Write about a character who must make a difficult but important decision"
            ];
            
            const selectedWords = words.slice(0, 5).map(w => w.word);
            const prompt = storyPrompts[Math.floor(Math.random() * storyPrompts.length)];
            
            const storyPrompt = {
                prompt: prompt,
                words: selectedWords
            };
            
            // Store for checking later
            currentPracticeSession.currentStoryPrompt = storyPrompt;
            
            return storyPrompt;
        }

        function generatePhraseChallenge() {
            const phraseChallenges = [
                {
                    phrase: "Furthermore, it's important to note that",
                    meaning: "Used to add additional important information",
                    example: "In a presentation when adding a key point"
                },
                {
                    phrase: "On the other hand, we should consider",
                    meaning: "Used to present an alternative viewpoint",
                    example: "During a debate or discussion"
                },
                {
                    phrase: "As a result of this, we can conclude",
                    meaning: "Used to show cause and effect relationship",
                    example: "When explaining the outcome of an experiment"
                },
                {
                    phrase: "I'd like to emphasize the significance of",
                    meaning: "Used to highlight something very important",
                    example: "In a speech when making a crucial point"
                },
                {
                    phrase: "From my perspective, I believe",
                    meaning: "Used to express your personal opinion respectfully",
                    example: "In a group discussion or meeting"
                },
                {
                    phrase: "What strikes me as particularly important is",
                    meaning: "Used to draw attention to something notable",
                    example: "When analyzing a situation or text"
                },
                {
                    phrase: "It's worth mentioning that",
                    meaning: "Used to add relevant additional information",
                    example: "When providing context or background"
                },
                {
                    phrase: "I cannot stress enough how vital it is",
                    meaning: "Used to emphasize extreme importance",
                    example: "When giving urgent advice or warnings"
                }
            ];
            
            const challenge = phraseChallenges[Math.floor(Math.random() * phraseChallenges.length)];
            
            // Store for checking later
            currentPracticeSession.currentPhraseChallenge = challenge;
            
            return challenge;
        }

        function checkSpelling(correctWord) {
            const userInput = document.getElementById('spellingInput').value.trim().toLowerCase();
            const isCorrect = userInput === correctWord.toLowerCase();
            
            if (isCorrect) {
                currentPracticeSession.score++;
                showNotification('✅ Correct spelling!');
            } else {
                showNotification(`❌ Incorrect. The correct spelling is: ${correctWord}`);
            }
            
            setTimeout(() => {
                nextPracticeQuestion();
            }, 2000);
        }

        function checkMeaning(correctDefinition, selectedDefinition) {
            const isCorrect = selectedDefinition === correctDefinition;
            
            if (isCorrect) {
                currentPracticeSession.score++;
                showNotification('✅ Correct meaning!');
            } else {
                showNotification(`❌ Incorrect. The correct definition is: ${correctDefinition}`);
            }
            
            setTimeout(() => {
                nextPracticeQuestion();
            }, 2000);
        }

        function checkSentence(targetWord) {
            const sentence = document.getElementById('sentenceInput').value.trim();
            
            if (!sentence) {
                showNotification('Please write a sentence first!');
                return;
            }
            
            const containsWord = sentence.toLowerCase().includes(targetWord.toLowerCase());
            const isReasonableLength = sentence.length >= 10;
            const hasProperStructure = sentence.includes(' ') && (sentence.endsWith('.') || sentence.endsWith('!') || sentence.endsWith('?'));
            
            if (containsWord && isReasonableLength && hasProperStructure) {
                currentPracticeSession.score++;
                showAchievement(`✅ Great sentence! "${sentence}"`);
                
                // Save the sentence as a custom example
                const word = currentPracticeSession.words[currentPracticeSession.currentIndex];
                if (word && !word.customExamples) word.customExamples = [];
                if (word) word.customExamples.push(sentence);
                
            } else if (!containsWord) {
                showNotification(`❌ Your sentence should include the word "${targetWord}"`);
                return;
            } else if (!isReasonableLength) {
                showNotification('❌ Please write a longer, more complete sentence');
                return;
            } else {
                showNotification('❌ Please end your sentence with proper punctuation');
                return;
            }
            
            setTimeout(() => {
                nextPracticeQuestion();
            }, 3000);
        }

        function checkStory() {
            const story = document.getElementById('storyInput').value.trim();
            const storyPrompt = currentPracticeSession.currentStoryPrompt;
            
            if (!story) {
                showNotification('Please write your story first!');
                return;
            }
            
            if (story.length < 50) {
                showNotification('Please write a longer story (at least 50 characters)');
                return;
            }
            
            // Check how many required words are used
            const wordsUsed = storyPrompt.words.filter(word => 
                story.toLowerCase().includes(word.toLowerCase())
            );
            
            const percentage = (wordsUsed.length / storyPrompt.words.length) * 100;
            
            if (percentage >= 70) {
                currentPracticeSession.score += 2; // Bonus points for story
                showAchievement(`🌟 Excellent story! You used ${wordsUsed.length}/${storyPrompt.words.length} words!`);
                
                // Save the story
                if (!appData.userStories) appData.userStories = [];
                appData.userStories.push({
                    id: Date.now().toString(),
                    story: story,
                    wordsUsed: wordsUsed,
                    prompt: storyPrompt.prompt,
                    date: new Date().toISOString()
                });
                saveAppData();
                
            } else if (percentage >= 40) {
                currentPracticeSession.score++;
                showNotification(`👍 Good effort! Try to use more of the required words. Used: ${wordsUsed.length}/${storyPrompt.words.length}`);
            } else {
                showNotification(`💪 Keep trying! Make sure to include more of the highlighted words in your story.`);
                return;
            }
            
            setTimeout(() => {
                nextPracticeQuestion();
            }, 4000);
        }

        function checkPhraseUsage() {
            const usage = document.getElementById('phraseInput').value.trim();
            const phraseChallenge = currentPracticeSession.currentPhraseChallenge;
            
            if (!usage) {
                showNotification('Please write how you would use this phrase!');
                return;
            }
            
            if (usage.length < 20) {
                showNotification('Please provide a more detailed example');
                return;
            }
            
            // Check if the phrase is mentioned or used contextually
            const containsPhrase = usage.toLowerCase().includes(phraseChallenge.phrase.toLowerCase());
            const isContextual = usage.length >= 30;
            
            if (containsPhrase && isContextual) {
                currentPracticeSession.score++;
                showAchievement(`💬 Excellent usage! You understand how to use this phrase!`);
            } else if (isContextual) {
                showNotification(`👍 Good context! Try to include the exact phrase in your example.`);
            } else {
                showNotification(`💪 Good start! Try to provide more context for when you'd use this phrase.`);
            }
            
            setTimeout(() => {
                nextPracticeQuestion();
            }, 3000);
        }

        function getStoryHint() {
            const storyPrompt = currentPracticeSession.currentStoryPrompt;
            const hints = [
                `Try starting with: "Once upon a time..." or "In a world where..."`,
                `Think about how these words relate to each other: ${storyPrompt.words.slice(0, 2).join(' and ')}`,
                `Consider the setting: Where does your story take place?`,
                `What's the main conflict or challenge in your story?`,
                `How can the character use these qualities: ${storyPrompt.words.filter(w => w.includes('ent') || w.includes('ive')).join(', ')}?`
            ];
            
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            showNotification(`💡 Hint: ${randomHint}`);
        }

        function nextPracticeQuestion() {
            if (!currentPracticeSession) return;
            
            currentPracticeSession.currentIndex++;
            
            if (currentPracticeSession.currentIndex >= currentPracticeSession.words.length) {
                endPractice();
            } else {
                loadPracticeQuestion();
            }
        }

        function skipQuestion() {
            nextPracticeQuestion();
        }

        function endPractice() {
            if (!currentPracticeSession) return;
            
            const { score, words } = currentPracticeSession;
            const percentage = Math.round((score / words.length) * 100);
            
            showAchievement(`🎯 Practice Complete! Score: ${score}/${words.length} (${percentage}%)`);
            
            // Update progress
            appData.progress.accuracy = percentage;
            appData.progress.studyTime += 0.25; // 15 minutes average
            saveAppData();
            updateAllStats();
            
            currentPracticeSession = null;
            document.getElementById('practiceSession').classList.add('hidden');
        }

        function startRandomPractice() {
            const modes = ['pronunciation', 'spelling', 'meaning'];
            const randomMode = modes[Math.floor(Math.random() * modes.length)];
            startPracticeMode(randomMode);
        }

        function startAudioPractice() {
            startPracticeMode('pronunciation');
        }

        // Review Functions
        function loadReviewScreen() {
            updateReviewStats();
            loadReviewWords();
        }

        function updateReviewStats() {
            const now = new Date();
            const reviewWords = appData.words.filter(word => {
                if (!word.reviewDate) return false;
                return new Date(word.reviewDate) <= now;
            });
            
            const newWords = appData.words.filter(w => w.status === 'new').length;
            const learningWords = appData.words.filter(w => w.status === 'learning').length;
            const masteredWords = appData.words.filter(w => w.status === 'mastered').length;
            
            document.getElementById('reviewWordsCount').textContent = reviewWords.length;
            document.getElementById('newWordsCount').textContent = newWords;
            document.getElementById('learningWordsCount').textContent = learningWords;
            document.getElementById('masteredWordsCount').textContent = masteredWords;
        }

        function loadReviewWords() {
            const now = new Date();
            const reviewWords = appData.words.filter(word => {
                if (!word.reviewDate) return false;
                return new Date(word.reviewDate) <= now;
            });
            
            const container = document.getElementById('reviewWordsList');
            
            if (reviewWords.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">No words due for review right now. Great job staying on top of your vocabulary!</div>';
                return;
            }
            
            container.innerHTML = reviewWords.slice(0, 10).map(word => `
                <div class="word-card ${word.status}">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-white text-lg">${word.word}</h4>
                            <p class="text-gray-400 text-sm">Due for review</p>
                        </div>
                        <div class="difficulty-badge difficulty-${word.difficulty}">${word.difficulty}</div>
                    </div>
                </div>
            `).join('');
        }

        function startReviewSession() {
            const now = new Date();
            const reviewWords = appData.words.filter(word => {
                if (!word.reviewDate) return false;
                return new Date(word.reviewDate) <= now;
            });
            
            if (reviewWords.length === 0) {
                showNotification('No words due for review!');
                return;
            }
            
            currentReviewSession = {
                words: reviewWords,
                currentIndex: 0,
                showingAnswer: false
            };
            
            document.getElementById('reviewSession').classList.remove('hidden');
            document.getElementById('reviewTotalCards').textContent = reviewWords.length;
            
            loadReviewCard();
        }

        function loadReviewCard() {
            if (!currentReviewSession) return;
            
            const { words, currentIndex } = currentReviewSession;
            const word = words[currentIndex];
            
            document.getElementById('reviewCurrentCard').textContent = currentIndex + 1;
            
            const container = document.getElementById('reviewCard');
            container.innerHTML = `
                <div class="text-center">
                    <h3 class="text-3xl font-bold text-accent mb-4">${word.word}</h3>
                    <button onclick="pronounceWord('${word.word}')" class="pronunciation-btn mb-6">
                        🔊
                    </button>
                    <div class="mb-6">
                        <button onclick="showReviewAnswer()" class="bg-accent text-black px-8 py-3 rounded-lg font-bold">
                            Show Definition
                        </button>
                    </div>
                </div>
            `;
            
            currentReviewSession.showingAnswer = false;
        }

        function showReviewAnswer() {
            if (!currentReviewSession) return;
            
            const { words, currentIndex } = currentReviewSession;
            const word = words[currentIndex];
            
            const container = document.getElementById('reviewCard');
            container.innerHTML = `
                <div class="text-center">
                    <h3 class="text-3xl font-bold text-accent mb-4">${word.word}</h3>
                    <div class="text-white mb-4">${word.definition}</div>
                    <div class="text-gray-400 italic mb-6">"${word.example}"</div>
                    <p class="text-gray-300 mb-6">How well did you remember this word?</p>
                </div>
            `;
            
            currentReviewSession.showingAnswer = true;
        }

        function reviewAnswer(difficulty) {
            if (!currentReviewSession || !currentReviewSession.showingAnswer) return;
            
            const { words, currentIndex } = currentReviewSession;
            const word = words[currentIndex];
            
            // Update word based on difficulty
            const now = new Date();
            switch(difficulty) {
                case 'hard':
                    word.reviewDate = new Date(now.getTime() + 1 * 60 * 60 * 1000).toISOString(); // 1 hour
                    break;
                case 'good':
                    word.reviewDate = new Date(now.getTime() + 24 * 60 * 60 * 1000).toISOString(); // 1 day
                    break;
                case 'easy':
                    word.reviewDate = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString(); // 1 week
                    if (word.status === 'learning') {
                        word.status = 'mastered';
                    }
                    break;
            }
            
            currentReviewSession.currentIndex++;
            
            if (currentReviewSession.currentIndex >= currentReviewSession.words.length) {
                endReviewSession();
            } else {
                loadReviewCard();
            }
        }

        function endReviewSession() {
            if (!currentReviewSession) return;
            
            const reviewedCount = currentReviewSession.words.length;
            showAchievement(`🔄 Review session complete! Reviewed ${reviewedCount} words.`);
            
            currentReviewSession = null;
            document.getElementById('reviewSession').classList.add('hidden');
            
            saveAppData();
            loadReviewScreen();
        }

        // Phrases Functions
        function loadPhrases() {
            loadTransitionPhrases();
            loadPowerExpressions();
            loadCustomPhrases();
        }

        function loadTransitionPhrases() {
            const container = document.getElementById('transitionPhrases');
            container.innerHTML = appData.phrases.transitions.map(phrase => `
                <div class="word-card cursor-pointer" onclick="copyPhrase('${phrase}')">
                    <div class="font-semibold text-white">${phrase}</div>
                    <div class="text-sm text-gray-400 mt-1">Click to copy</div>
                </div>
            `).join('');
        }

        function loadPowerExpressions() {
            const container = document.getElementById('powerExpressions');
            container.innerHTML = appData.phrases.powerExpressions.map(phrase => `
                <div class="word-card cursor-pointer" onclick="copyPhrase('${phrase}')">
                    <div class="font-semibold text-white">${phrase}</div>
                    <div class="text-sm text-gray-400 mt-1">Click to copy</div>
                </div>
            `).join('');
        }

        function loadCustomPhrases() {
            const container = document.getElementById('customPhrasesList');
            
            if (appData.phrases.custom.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No custom phrases added yet</div>';
                return;
            }
            
            container.innerHTML = appData.phrases.custom.map(phrase => `
                <div class="word-card">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-semibold text-white mb-1">${phrase.text}</div>
                            <div class="text-sm text-gray-400">${phrase.category}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="copyPhrase('${phrase.text}')" class="bg-blue-600 text-white px-2 py-1 rounded text-sm">Copy</button>
                            <button onclick="deleteCustomPhrase('${phrase.id}')" class="text-red-400 text-sm">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getRandomPhrase() {
            const allPhrases = [...appData.phrases.transitions, ...appData.phrases.powerExpressions];
            const randomPhrase = allPhrases[Math.floor(Math.random() * allPhrases.length)];
            copyPhrase(randomPhrase);
        }

        function copyPhrase(phrase) {
            navigator.clipboard.writeText(phrase).then(() => {
                showNotification('📋 Phrase copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = phrase;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification('📋 Phrase copied to clipboard!');
            });
        }

        function saveCustomPhrase() {
            const text = document.getElementById('newPhrase').value.trim();
            const category = document.getElementById('newPhraseCategory').value.trim();
            
            if (!text || !category) {
                showNotification('Please enter both phrase and category');
                return;
            }
            
            const phrase = {
                id: Date.now().toString(),
                text: text,
                category: category,
                date: new Date().toISOString()
            };
            
            appData.phrases.custom.push(phrase);
            saveAppData();
            
            document.getElementById('newPhrase').value = '';
            document.getElementById('newPhraseCategory').value = '';
            
            loadCustomPhrases();
            showNotification('✨ Phrase added successfully!');
        }

        function deleteCustomPhrase(id) {
            if (confirm('Delete this phrase?')) {
                appData.phrases.custom = appData.phrases.custom.filter(p => p.id !== id);
                saveAppData();
                loadCustomPhrases();
                showNotification('🗑️ Phrase deleted');
            }
        }

        // Focus Session Functions
        function startFocusSession() {
            let focusTimeLeft = 25 * 60; // 25 minutes
            
            document.getElementById('startFocusBtn').disabled = true;
            document.getElementById('stopFocusBtn').disabled = false;
            
            focusTimer = setInterval(() => {
                focusTimeLeft--;
                updateFocusTimer(focusTimeLeft);
                
                if (focusTimeLeft <= 0) {
                    stopFocusSession();
                }
            }, 1000);
            
            startBreathingAnimation();
            showRandomMotivationalMessage();
        }

        function startBreathingAnimation() {
            const circle = document.getElementById('breathingCircle');
            const instruction = document.getElementById('breathingInstruction');
            let breathingPhase = 'inhale';
            
            breathingInterval = setInterval(() => {
                if (breathingPhase === 'inhale') {
                    circle.classList.add('inhale');
                    circle.classList.remove('exhale');
                    instruction.textContent = 'Breathe In';
                    breathingPhase = 'exhale';
                } else {
                    circle.classList.add('exhale');
                    circle.classList.remove('inhale');
                    instruction.textContent = 'Breathe Out';
                    breathingPhase = 'inhale';
                }
            }, 4000);
        }

        function updateFocusTimer(timeLeft) {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('focusTimer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function showRandomMotivationalMessage() {
            const messages = appData.motivationalMessages;
            if (messages.length > 0) {
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                document.getElementById('motivationalMessage').textContent = `"${randomMessage}"`;
            }
        }

        function stopFocusSession() {
            if (focusTimer) {
                clearInterval(focusTimer);
                clearInterval(breathingInterval);
                focusTimer = null;
                breathingInterval = null;
            }
            
            document.getElementById('startFocusBtn').disabled = false;
            document.getElementById('stopFocusBtn').disabled = true;
            
            appData.progress.studyTime += 0.42; // 25 minutes
            saveAppData();
            
            showAchievement('🧘 Focus session completed! Mind refreshed!');
        }

        function addMotivationalMessage() {
            const message = document.getElementById('newMotivationalMessage').value.trim();
            if (!message) {
                showNotification('Please enter a message');
                return;
            }
            
            appData.motivationalMessages.push(message);
            saveAppData();
            
            document.getElementById('newMotivationalMessage').value = '';
            loadCustomMotivationalMessages();
            showNotification('💭 Motivational message added!');
        }

        function loadCustomMotivationalMessages() {
            const container = document.getElementById('customMotivationalMessages');
            const customMessages = appData.motivationalMessages.slice(5); // Skip default messages
            
            if (customMessages.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center text-sm">No custom messages yet</div>';
                return;
            }
            
            container.innerHTML = customMessages.map((message, index) => `
                <div class="bg-gray-800 p-3 rounded flex justify-between items-center">
                    <span class="text-sm">"${message}"</span>
                    <button onclick="removeMotivationalMessage(${index + 5})" class="text-red-400 text-xs ml-3">Remove</button>
                </div>
            `).join('');
        }

        function removeMotivationalMessage(index) {
            appData.motivationalMessages.splice(index, 1);
            saveAppData();
            loadCustomMotivationalMessages();
            showNotification('🗑️ Message removed');
        }

        // Quick Add Functions
        function quickAddWord() {
            document.getElementById('quickAddModal').classList.remove('hidden');
            document.getElementById('quickAddWord').focus();
        }

        function closeQuickAddModal() {
            document.getElementById('quickAddModal').classList.add('hidden');
            clearQuickAddForm();
        }

        function clearQuickAddForm() {
            document.getElementById('quickAddWord').value = '';
            document.getElementById('quickAddDefinition').value = '';
            document.getElementById('quickAddExample').value = '';
            document.getElementById('quickAddDifficulty').value = 'medium';
        }

        function saveQuickAddWord() {
            const word = document.getElementById('quickAddWord').value.trim();
            const definition = document.getElementById('quickAddDefinition').value.trim();
            const example = document.getElementById('quickAddExample').value.trim();
            const difficulty = document.getElementById('quickAddDifficulty').value;
            
            if (!word || !definition) {
                showNotification('Please enter at least word and definition');
                return;
            }
            
            const newWord = {
                id: Date.now().toString(),
                word: word,
                definition: definition,
                example: example || `Example sentence with ${word}.`,
                difficulty: difficulty,
                status: 'new',
                dateAdded: new Date().toISOString(),
                reviewDate: null,
                attempts: 0,
                correctAttempts: 0,
                favorite: false
            };
            
            appData.words.push(newWord);
            appData.progress.totalWords++;
            
            saveAppData();
            updateAllStats();
            closeQuickAddModal();
            
            showAchievement(`✨ New word added: ${word}!`);
        }

        // Recording Functions
        function recordPronunciation() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showNotification('Recording not supported in this browser');
                return;
            }
            
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        if (event.data.size > 0) {
                            recordedChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(recordedChunks, { type: 'audio/webm' });
                        saveRecording(blob);
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    mediaRecorder.start();
                    
                    document.getElementById('recordBtn').disabled = true;
                    document.getElementById('stopRecordBtn').disabled = false;
                    document.getElementById('recordingIndicator').classList.remove('hidden');
                })
                .catch(error => {
                    showNotification('Could not access microphone');
                    console.error('Recording error:', error);
                });
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                
                document.getElementById('recordBtn').disabled = false;
                document.getElementById('stopRecordBtn').disabled = true;
                document.getElementById('recordingIndicator').classList.add('hidden');
            }
        }

        function saveRecording(blob) {
            const recording = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                type: 'pronunciation',
                blob: blob,
                url: URL.createObjectURL(blob)
            };
            
            appData.recordings.push(recording);
            saveAppData();
            
            showNotification('🎤 Recording saved!');
        }

        // Progress Functions
        function loadProgressScreen() {
            updateProgressStats();
            loadRecordings();
            loadUserStories();
            loadAllWords();
        }

        function updateProgressStats() {
            document.getElementById('totalWordsStats').textContent = appData.progress.totalWords;
            document.getElementById('longestStreakStats').textContent = appData.progress.longestStreak;
            document.getElementById('studyTimeStats').textContent = Math.floor(appData.progress.studyTime);
            document.getElementById('accuracyStats').textContent = appData.progress.accuracy;
        }

        function loadRecordings() {
            const container = document.getElementById('recordingsList');
            
            if (appData.recordings.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No recordings saved yet</div>';
                return;
            }
            
            container.innerHTML = appData.recordings.map(recording => `
                <div class="bg-gray-800 p-4 rounded-lg flex justify-between items-center">
                    <div>
                        <div class="font-semibold text-white">${recording.type} Recording</div>
                        <div class="text-sm text-gray-400">${new Date(recording.date).toLocaleString()}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="playRecording('${recording.id}')" class="bg-green-600 text-white px-3 py-1 rounded text-sm">
                            ▶️ Play
                        </button>
                        <button onclick="deleteRecording('${recording.id}')" class="bg-red-600 text-white px-3 py-1 rounded text-sm">
                            🗑️ Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadUserStories() {
            const container = document.getElementById('userStoriesList');
            
            if (!appData.userStories || appData.userStories.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No stories written yet. Try the Story Practice mode!</div>';
                return;
            }
            
            container.innerHTML = appData.userStories.map(story => `
                <div class="bg-gray-800 p-4 rounded-lg">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="font-semibold text-accent mb-1">Story Challenge</div>
                            <div class="text-sm text-gray-400 mb-2">${new Date(story.date).toLocaleDateString()}</div>
                            <div class="text-xs text-gray-500 italic mb-2">"${story.prompt}"</div>
                        </div>
                        <button onclick="deleteStory('${story.id}')" class="text-red-400 text-sm ml-3">Delete</button>
                    </div>
                    
                    <div class="bg-gray-900 p-3 rounded mb-3">
                        <div class="text-white text-sm leading-relaxed">${story.story}</div>
                    </div>
                    
                    <div class="flex flex-wrap gap-1">
                        <span class="text-xs text-gray-400 mr-2">Words used:</span>
                        ${story.wordsUsed.map(word => `
                            <span class="bg-accent text-black px-2 py-1 rounded-full text-xs font-bold">${word}</span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function playRecording(recordingId) {
            const recording = appData.recordings.find(r => r.id === recordingId);
            if (recording) {
                const audio = new Audio(recording.url);
                audio.play();
            }
        }

        function deleteRecording(recordingId) {
            if (confirm('Delete this recording?')) {
                appData.recordings = appData.recordings.filter(r => r.id !== recordingId);
                saveAppData();
                loadRecordings();
                showNotification('🗑️ Recording deleted');
            }
        }

        function deleteStory(storyId) {
            if (confirm('Delete this story?')) {
                if (!appData.userStories) appData.userStories = [];
                appData.userStories = appData.userStories.filter(s => s.id !== storyId);
                saveAppData();
                loadUserStories();
                showNotification('🗑️ Story deleted');
            }
        }

        function loadAllWords() {
            const container = document.getElementById('allWordsList');
            
            if (appData.words.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No words learned yet</div>';
                return;
            }
            
            container.innerHTML = appData.words.map(word => `
                <div class="word-card ${word.status}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h4 class="font-bold text-white text-lg">${word.word}</h4>
                                <span class="difficulty-badge difficulty-${word.difficulty}">${word.difficulty}</span>
                                ${word.favorite ? '<span class="text-yellow-400">⭐</span>' : ''}
                            </div>
                            <p class="text-gray-300 text-sm mb-1">${word.definition}</p>
                            <p class="text-gray-400 text-xs italic">"${word.example}"</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editWord('${word.id}')" class="bg-blue-600 text-white px-2 py-1 rounded text-xs">Edit</button>
                            <button onclick="deleteWord('${word.id}')" class="bg-red-600 text-white px-2 py-1 rounded text-xs">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function searchWords() {
            const query = document.getElementById('searchWords').value.toLowerCase();
            const filteredWords = appData.words.filter(word => 
                word.word.toLowerCase().includes(query) || 
                word.definition.toLowerCase().includes(query)
            );
            
            const container = document.getElementById('allWordsList');
            
            if (filteredWords.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No words found</div>';
                return;
            }
            
            container.innerHTML = filteredWords.map(word => `
                <div class="word-card ${word.status}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h4 class="font-bold text-white text-lg">${word.word}</h4>
                                <span class="difficulty-badge difficulty-${word.difficulty}">${word.difficulty}</span>
                                ${word.favorite ? '<span class="text-yellow-400">⭐</span>' : ''}
                            </div>
                            <p class="text-gray-300 text-sm mb-1">${word.definition}</p>
                            <p class="text-gray-400 text-xs italic">"${word.example}"</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editWord('${word.id}')" class="bg-blue-600 text-white px-2 py-1 rounded text-xs">Edit</button>
                            <button onclick="deleteWord('${word.id}')" class="bg-red-600 text-white px-2 py-1 rounded text-xs">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteWord(wordId) {
            if (confirm('Delete this word? This action cannot be undone.')) {
                appData.words = appData.words.filter(w => w.id !== wordId);
                appData.progress.totalWords = Math.max(0, appData.progress.totalWords - 1);
                saveAppData();
                updateAllStats();
                loadAllWords();
                showNotification('🗑️ Word deleted');
            }
        }

        // Data Export/Import Functions
        function exportProgressPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text('VocabGrow Progress Report', 20, 30);
            
            // Date
            doc.setFontSize(12);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 45);
            
            // Stats
            doc.setFontSize(16);
            doc.text('Learning Statistics', 20, 65);
            
            doc.setFontSize(12);
            const stats = [
                `Total Words Learned: ${appData.progress.totalWords}`,
                `Current Streak: ${appData.progress.streak} days`,
                `Longest Streak: ${appData.progress.longestStreak} days`,
                `Study Time: ${Math.floor(appData.progress.studyTime)} hours`,
                `Practice Accuracy: ${appData.progress.accuracy}%`,
                `Daily Progress: ${appData.progress.dailyProgress}/10`
            ];
            
            let yPos = 80;
            stats.forEach(stat => {
                doc.text(stat, 20, yPos);
                yPos += 10;
            });
            
            // Recent Words
            if (appData.words.length > 0) {
                doc.setFontSize(16);
                doc.text('Recent Words', 20, yPos + 20);
                
                doc.setFontSize(10);
                yPos += 35;
                appData.words.slice(-10).forEach(word => {
                    doc.text(`${word.word}: ${word.definition}`, 20, yPos);
                    yPos += 8;
                });
            }
            
            doc.save(`vocabgrow-progress-${new Date().toISOString().split('T')[0]}.pdf`);
            showNotification('📄 Progress report exported to PDF!');
        }

        function backupData() {
            const backup = {
                ...appData,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `vocabgrow-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('💾 Data backup created successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (confirm('Import data? This will overwrite your current progress.')) {
                            appData = { ...appData, ...importedData };
                            saveAppData();
                            updateAllStats();
                            showNotification('📥 Data imported successfully!');
                            location.reload();
                        }
                    } catch (error) {
                        showNotification('❌ Error reading backup file');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function syncData() {
            if (isOnline) {
                // Simulate cloud sync
                showNotification('🔄 Data synced to cloud!');
                saveAppData();
            } else {
                showNotification('❌ Cannot sync while offline');
            }
        }

        function generateOfflineList(type) {
            let words = [];
            let filename = '';
            
            switch(type) {
                case 'recent':
                    words = appData.words.slice(-50);
                    filename = 'recent-words';
                    break;
                case 'difficult':
                    words = appData.words.filter(w => w.difficulty === 'hard');
                    filename = 'difficult-words';
                    break;
                case 'favorites':
                    words = appData.words.filter(w => w.favorite);
                    filename = 'favorite-words';
                    break;
                case 'custom':
                    words = appData.words.filter(w => !vocabularyBank.some(vw => vw.word === w.word));
                    filename = 'custom-words';
                    break;
            }
            
            if (words.length === 0) {
                showNotification('No words available for this list type');
                return;
            }
            
            const listContent = words.map(word => 
                `${word.word}\n${word.definition}\n"${word.example}"\n---`
            ).join('\n\n');
            
            const blob = new Blob([listContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            showNotification(`📋 ${filename.replace('-', ' ')} exported for offline practice!`);
        }

        // Utility Functions
        function updateAllStats() {
            document.getElementById('currentStreak').textContent = appData.progress.streak;
            document.getElementById('dailyProgress').textContent = `${appData.progress.dailyProgress}/10`;
            document.getElementById('totalWordsLearned').textContent = appData.progress.totalWords;
            
            // Update progress ring
            const progressPercentage = (appData.progress.dailyProgress / 10) * 100;
            const progressFill = document.getElementById('dailyProgressFill');
            if (progressFill) {
                progressFill.style.transform = `rotate(${(progressPercentage / 100) * 360}deg)`;
            }
        }

        function updateStreak() {
            const today = new Date().toDateString();
            
            if (appData.lastActiveDate !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (appData.lastActiveDate === yesterday.toDateString()) {
                    // Streak continues
                } else if (appData.lastActiveDate !== null) {
                    // Streak broken
                    appData.progress.streak = 0;
                }
                
                appData.lastActiveDate = today;
                saveAppData();
            }
        }

        function showAchievement(message) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement-popup';
            achievement.textContent = message;
            
            document.body.appendChild(achievement);
            
            setTimeout(() => {
                achievement.remove();
            }, 3000);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-accent text-black px-6 py-3 rounded-lg font-bold z-50';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function startMiniTask(taskIndex) {
            showNotification(`🎯 Starting mini task ${taskIndex + 1}!`);
            // Mini task functionality would be implemented here
        }

        function startWordPractice(word) {
            showNotification(`🎯 Starting practice for: ${word.word}`);
            // Individual word practice would be implemented here
        }

        function editWord(wordId) {
            const word = appData.words.find(w => w.id === wordId);
            if (word) {
                // Pre-fill quick add modal with word data
                document.getElementById('quickAddWord').value = word.word;
                document.getElementById('quickAddDefinition').value = word.definition;
                document.getElementById('quickAddExample').value = word.example;
                document.getElementById('quickAddDifficulty').value = word.difficulty;
                
                // Remove the word temporarily for editing
                appData.words = appData.words.filter(w => w.id !== wordId);
                
                quickAddWord();
            }
        }

        // Initialize custom content on load
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomMotivationalMessages();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9882cd6dc64ffee5',t:'MTc1OTM5MzQ1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

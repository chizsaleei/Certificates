<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finisher Pro - Complete What You Start</title>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0d2818 0%, #1a4d2e 50%, #2d5a3d 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin-bottom: 25px;
            border: 2px solid rgba(218, 165, 32, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: finish-glow 4s ease-in-out infinite;
        }

        @keyframes finish-glow {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        .header h1 {
            margin: 0;
            font-size: 2.4rem;
            background: linear-gradient(45deg, #daa520, #ffd700, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .finish-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            display: block;
            animation: finish-bounce 3s ease-in-out infinite;
        }

        @keyframes finish-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(45, 90, 61, 0.6);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(218, 165, 32, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(218, 165, 32, 0.2);
            border-color: #daa520;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            color: #e0e0e0;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 25px;
            margin-bottom: 25px;
        }

        .tasks-section {
            background: rgba(45, 90, 61, 0.4);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(218, 165, 32, 0.3);
            backdrop-filter: blur(10px);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-card {
            background: rgba(45, 90, 61, 0.6);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(218, 165, 32, 0.3);
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-add-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(218, 165, 32, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .quick-add-form {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .form-input, .form-select, .form-textarea {
            padding: 14px;
            background: rgba(45, 90, 61, 0.6);
            border: 2px solid rgba(218, 165, 32, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #daa520;
            box-shadow: 0 0 15px rgba(218, 165, 32, 0.3);
            background: rgba(45, 90, 61, 0.8);
        }

        .form-input {
            flex: 1;
            min-width: 200px;
        }

        .voice-btn, .add-btn, .action-btn {
            padding: 14px 18px;
            background: linear-gradient(45deg, #daa520, #ffd700);
            color: #0d2818;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .voice-btn:hover, .add-btn:hover, .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(218, 165, 32, 0.4);
            background: linear-gradient(45deg, #b8941c, #e6c200);
        }

        .voice-btn.recording {
            background: #ff6b6b;
            color: white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .do-it-now-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8a80);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            animation: urgent-glow 2s infinite;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @keyframes urgent-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 107, 107, 0.5); }
            50% { box-shadow: 0 0 25px rgba(255, 107, 107, 0.8); }
        }

        .search-bar {
            width: 100%;
            padding: 14px;
            background: rgba(45, 90, 61, 0.6);
            border: 2px solid rgba(218, 165, 32, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .task-card {
            background: rgba(45, 90, 61, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(218, 165, 32, 0.2);
            transition: all 0.3s ease;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .task-card:hover {
            background: rgba(45, 90, 61, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            border-color: rgba(218, 165, 32, 0.4);
        }

        .task-card.completed {
            opacity: 0.7;
            background: rgba(102, 187, 106, 0.2);
            border-left: 4px solid #66bb6a;
        }

        .task-card.high-priority {
            border-left: 4px solid #ff6b6b;
        }

        .task-card.medium-priority {
            border-left: 4px solid #ffa726;
        }

        .task-card.low-priority {
            border-left: 4px solid #66bb6a;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .task-title {
            font-weight: bold;
            font-size: 1.1rem;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .task-meta {
            color: #e0e0e0;
            font-size: 0.9rem;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .task-btn {
            padding: 8px 12px;
            background: rgba(218, 165, 32, 0.2);
            color: #ffd700;
            border: 1px solid rgba(218, 165, 32, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .task-btn:hover {
            background: rgba(218, 165, 32, 0.4);
            border-color: #daa520;
        }

        .task-btn.complete-btn {
            background: rgba(102, 187, 106, 0.2);
            color: #66bb6a;
            border-color: rgba(102, 187, 106, 0.3);
        }

        .task-btn.delete-btn {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .subtask-list {
            margin: 15px 0;
            padding-left: 20px;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .subtask-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding-left: 10px;
        }

        .subtask-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .subtask-item.swiping {
            transform: translateX(-80px);
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #daa520;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox.checked {
            background: #daa520;
            color: #0d2818;
        }

        .swipe-complete {
            position: absolute;
            right: -80px;
            top: 0;
            height: 100%;
            width: 80px;
            background: #66bb6a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: right 0.3s ease;
            border-radius: 0 8px 8px 0;
        }

        .subtask-item.swiping .swipe-complete {
            right: 0;
        }

        .pomodoro-timer {
            background: rgba(45, 90, 61, 0.6);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 2px solid rgba(218, 165, 32, 0.3);
            position: relative;
            overflow: hidden;
        }

        .pomodoro-timer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }

        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .timer-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .timer-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #daa520, #ffd700);
            color: #0d2818;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .timer-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(218, 165, 32, 0.4);
        }

        .timer-btn.active {
            background: #ff6b6b;
            color: white;
            animation: pulse 2s infinite;
        }

        .motivational-message {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #daa520;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            font-style: italic;
            color: #ffd700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .motivational-message:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .daily-prompts {
            background: rgba(45, 90, 61, 0.6);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(218, 165, 32, 0.3);
        }

        .prompt-item {
            background: rgba(13, 40, 24, 0.4);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid #daa520;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prompt-text {
            color: #e0e0e0;
            flex: 1;
        }

        .prompt-action {
            padding: 6px 12px;
            background: linear-gradient(45deg, #daa520, #ffd700);
            color: #0d2818;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            background: rgba(45, 90, 61, 0.6);
            border: 2px solid rgba(218, 165, 32, 0.3);
            border-radius: 10px;
            min-height: 45px;
            align-items: center;
        }

        .tag {
            background: rgba(218, 165, 32, 0.2);
            color: #ffd700;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(218, 165, 32, 0.3);
        }

        .tag-remove {
            cursor: pointer;
            font-weight: bold;
            color: #ff6b6b;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(45, 90, 61, 0.95);
            margin: 3% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            border: 2px solid #daa520;
            max-height: 85vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: #ffd700;
            font-size: 1.4rem;
            margin: 0;
        }

        .close {
            color: #ffd700;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ffeb3b;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: rgba(102, 187, 106, 0.95);
            color: white;
            border-radius: 10px;
            z-index: 1500;
            display: none;
            animation: slideIn 0.3s ease;
            border: 1px solid rgba(218, 165, 32, 0.3);
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .offline-indicator {
            position: fixed;
            top: 15px;
            left: 15px;
            padding: 8px 15px;
            background: rgba(255, 107, 107, 0.9);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            display: none;
            backdrop-filter: blur(10px);
        }

        .offline-indicator.online {
            background: rgba(102, 187, 106, 0.9);
        }

        .streak-display {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(218, 165, 32, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .streak-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .streak-label {
            color: #e0e0e0;
            font-size: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(45, 90, 61, 0.6);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #daa520, #ffd700);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }
            
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .quick-add-form {
                flex-direction: column;
            }
            
            .form-input {
                min-width: auto;
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
            
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Accessibility improvements */
        button:focus, input:focus, select:focus, textarea:focus {
            outline: 3px solid #ffd700;
            outline-offset: 2px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Animation for completed tasks */
        .task-complete-animation {
            animation: completeTask 0.6s ease-in-out;
        }

        @keyframes completeTask {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background: rgba(102, 187, 106, 0.3); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="offline-indicator" id="offlineIndicator">
        📡 Offline Mode
    </div>

    <div class="notification" id="notification"></div>

    <div class="app-container">
        <div class="header">
            <span class="finish-icon">🎯</span>
            <h1>Finisher Pro</h1>
            <p>Break Final Stages into Micro-Steps • Beat Procrastination • Complete What You Start</p>
        </div>

        <!-- Quick Stats Dashboard -->
        <div class="quick-stats">
            <div class="stat-card">
                <div class="stat-value" id="totalTasks">0</div>
                <div class="stat-label">Active Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedToday">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="focusTime">0h</div>
                <div class="stat-label">Focus Time</div>
            </div>
        </div>

        <!-- Quick Add Section -->
        <div class="quick-add-section">
            <div class="section-title">
                <span>⚡</span> Quick Add Task
            </div>
            <div class="quick-add-form">
                <input type="text" class="form-input" id="quickTaskInput" placeholder="What needs to be finished?" aria-label="Quick task input">
                <button class="voice-btn" onclick="startVoiceInput('quickTaskInput')" aria-label="Voice input">🎤</button>
                <button class="add-btn" onclick="quickAddTask()">Add Task</button>
                <button class="do-it-now-btn" onclick="doItNow()">DO IT NOW</button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <div class="tasks-section">
                <div class="section-title">
                    <span>📋</span> Active Tasks
                    <div style="margin-left: auto;">
                        <button class="action-btn" onclick="openTaskModal()">+ New Task</button>
                    </div>
                </div>
                
                <input type="text" class="search-bar" id="taskSearch" placeholder="Search tasks by title, tags, or priority..." oninput="filterTasks()">
                
                <div id="tasksList">
                    <!-- Tasks will be populated here -->
                </div>
            </div>

            <div class="sidebar">
                <!-- Pomodoro Timer -->
                <div class="sidebar-card">
                    <div class="section-title">
                        <span>🍅</span> Focus Timer
                    </div>
                    <div class="pomodoro-timer">
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <div class="timer-controls">
                            <button class="timer-btn" onclick="startTimer()" id="startBtn">Start</button>
                            <button class="timer-btn" onclick="pauseTimer()">Pause</button>
                            <button class="timer-btn" onclick="resetTimer()">Reset</button>
                        </div>
                    </div>
                </div>

                <!-- Accountability Streak -->
                <div class="sidebar-card">
                    <div class="section-title">
                        <span>🔥</span> Streak Tracker
                    </div>
                    <div class="streak-display">
                        <div class="streak-number" id="streakNumber">0</div>
                        <div class="streak-label">Days of Finishing Strong</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="streakProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Motivational Message -->
                <div class="sidebar-card">
                    <div class="section-title">
                        <span>💪</span> Daily Motivation
                    </div>
                    <div class="motivational-message" id="motivationalMessage" onclick="openMessageBuilder()">
                        "The final 10% of any project requires 90% of your focus. You've got this!"
                    </div>
                </div>

                <!-- Daily Action Prompts -->
                <div class="sidebar-card">
                    <div class="section-title">
                        <span>🎯</span> Action Prompts
                    </div>
                    <div class="daily-prompts" id="dailyPrompts">
                        <!-- Prompts will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="taskModalTitle">Create New Task</h3>
                <span class="close" onclick="closeTaskModal()">&times;</span>
            </div>
            
            <div id="taskModalContent">
                <div style="margin-bottom: 15px;">
                    <input type="text" class="form-input" id="taskTitle" placeholder="Task title..." style="width: 100%;" required>
                </div>
                
                <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                    <select class="form-select" id="taskPriority" style="flex: 1;">
                        <option value="high">High Priority</option>
                        <option value="medium" selected>Medium Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                    <input type="datetime-local" class="form-input" id="taskDeadline" style="flex: 1;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <textarea class="form-textarea" id="taskDescription" placeholder="Task description and notes..." rows="3" style="width: 100%;"></textarea>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <div class="tags-input" id="taskTags" onclick="focusTagInput()">
                        <input type="text" id="taskTagInput" placeholder="Add tags (press Enter)..." style="border: none; background: transparent; color: white; outline: none; flex: 1;">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #ffd700; margin-bottom: 10px;">📋 Micro-Steps (Break it down!)</h4>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="form-input" id="subtaskInput" placeholder="Add a micro-step..." style="flex: 1;">
                        <button class="add-btn" onclick="addSubtask()">Add</button>
                    </div>
                    <div id="subtaskPreview"></div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #ffd700; margin-bottom: 10px;">⏰ Reminders</h4>
                    <div style="display: flex; gap: 10px;">
                        <input type="datetime-local" class="form-input" id="reminderTime" style="flex: 1;">
                        <select class="form-select" id="reminderRecurring">
                            <option value="none">No Repeat</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button class="action-btn" onclick="saveTask()" style="flex: 1;">Save Task</button>
                    <button class="action-btn" onclick="closeTaskModal()" style="background: rgba(45, 90, 61, 0.8); color: #ffd700;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Builder Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Motivational Message Builder</h3>
                <span class="close" onclick="closeMessageModal()">&times;</span>
            </div>
            
            <div>
                <textarea class="form-textarea" id="customMessage" placeholder="Create your personal motivation message..." rows="4" style="width: 100%; margin-bottom: 15px;"></textarea>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="action-btn" onclick="saveCustomMessage()">Save Message</button>
                    <button class="action-btn" onclick="generateRandomMessage()">Random Message</button>
                </div>
                
                <div style="background: rgba(13, 40, 24, 0.4); padding: 15px; border-radius: 10px;">
                    <h4 style="color: #ffd700; margin-bottom: 10px;">💡 Message Templates</h4>
                    <div id="messageTemplates"></div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">

    <script>
        // Global variables
        let tasks = [];
        let currentTask = null;
        let currentSubtasks = [];
        let timerInterval = null;
        let timerSeconds = 1500; // 25 minutes
        let isTimerRunning = false;
        let recognition = null;
        let totalFocusTime = 0;
        let currentStreak = 0;
        let completedToday = 0;

        // Sample motivational messages
        const motivationalMessages = [
            "The final 10% of any project requires 90% of your focus. You've got this!",
            "Finishing is a skill. The more you practice it, the better you become.",
            "Every completed task is proof that you can overcome procrastination.",
            "The hardest part is often the last part. Push through - you're almost there!",
            "Champions are made in the final moments. This is your moment.",
            "Your future self will thank you for finishing what you start today.",
            "Procrastination is the enemy of progress. Action is your superpower.",
            "The satisfaction of completion is worth every moment of struggle.",
            "You don't have to be perfect, you just have to be finished.",
            "Every finish line is the starting line for something greater."
        ];

        // Daily action prompts
        const actionPrompts = [
            "Break your biggest task into 3 micro-steps",
            "Set a 25-minute timer and tackle one difficult task",
            "Complete the task you've been avoiding the longest",
            "Finish something you started yesterday",
            "Clear your smallest task to build momentum",
            "Focus on the final 20% of an ongoing project",
            "Review and update your task priorities",
            "Celebrate a recent completion and plan the next step"
        ];

        // Message templates
        const messageTemplates = [
            "I am a finisher. I complete what I start.",
            "Every task I finish makes me stronger and more confident.",
            "I have the power to overcome procrastination and take action.",
            "My focus and determination lead me to success.",
            "I choose progress over perfection, action over delay."
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateStats();
            generateDailyPrompts();
            updateMotivationalMessage();
            checkOnlineStatus();
            renderTasks();
            
            // Auto-save every 30 seconds
            setInterval(saveData, 30000);
            
            // Update online status
            setInterval(checkOnlineStatus, 5000);
            
            // Check for reminders every minute
            setInterval(checkReminders, 60000);
            
            // Initialize with sample data if empty
            if (tasks.length === 0) {
                initializeSampleData();
            }
            
            // Update streak
            updateStreak();
            
            // Set up tag input
            setupTagInput();
        });

        function initializeSampleData() {
            tasks = [
                {
                    id: 1,
                    title: 'Finish Project Presentation',
                    description: 'Complete the final slides and practice delivery for tomorrow\'s client meeting',
                    priority: 'high',
                    deadline: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().slice(0, 16),
                    tags: ['presentation', 'client', 'urgent'],
                    subtasks: [
                        { id: 1, text: 'Review all content for accuracy', completed: true },
                        { id: 2, text: 'Add final design touches to slides', completed: false },
                        { id: 3, text: 'Practice presentation timing', completed: false },
                        { id: 4, text: 'Prepare for Q&A session', completed: false }
                    ],
                    completed: false,
                    createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),
                    reminder: {
                        time: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString().slice(0, 16),
                        recurring: 'none'
                    }
                },
                {
                    id: 2,
                    title: 'Complete Website Redesign',
                    description: 'Finalize the last 3 pages and deploy to production',
                    priority: 'medium',
                    deadline: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().slice(0, 16),
                    tags: ['web-design', 'coding', 'client-work'],
                    subtasks: [
                        { id: 1, text: 'Design contact page layout', completed: true },
                        { id: 2, text: 'Implement responsive navigation', completed: true },
                        { id: 3, text: 'Add final content to about page', completed: false },
                        { id: 4, text: 'Test all forms and functionality', completed: false },
                        { id: 5, text: 'Deploy to production server', completed: false }
                    ],
                    completed: false,
                    createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000),
                    reminder: {
                        time: '',
                        recurring: 'daily'
                    }
                }
            ];
            
            updateStats();
            renderTasks();
        }

        // Task management
        function quickAddTask() {
            const input = document.getElementById('quickTaskInput');
            const title = input.value.trim();
            
            if (!title) {
                showNotification('Please enter a task title', 'error');
                return;
            }
            
            const task = {
                id: Date.now(),
                title: title,
                description: '',
                priority: 'medium',
                deadline: '',
                tags: [],
                subtasks: [],
                completed: false,
                createdAt: new Date(),
                reminder: { time: '', recurring: 'none' }
            };
            
            tasks.unshift(task);
            input.value = '';
            
            updateStats();
            renderTasks();
            saveData();
            showNotification('Task added! Break it into micro-steps for better results. 🎯');
        }

        function doItNow() {
            const incompleteTasks = tasks.filter(t => !t.completed);
            if (incompleteTasks.length === 0) {
                showNotification('No active tasks! Add a task to get started. 🎉');
                return;
            }
            
            // Find highest priority incomplete task
            const highPriorityTasks = incompleteTasks.filter(t => t.priority === 'high');
            const targetTask = highPriorityTasks.length > 0 ? highPriorityTasks[0] : incompleteTasks[0];
            
            showNotification(`🚀 DO IT NOW: "${targetTask.title}"! Starting 25-minute focus session...`, 'urgent');
            
            // Start timer automatically
            startTimer();
            
            // Scroll to the task
            const taskElement = document.querySelector(`[data-task-id="${targetTask.id}"]`);
            if (taskElement) {
                taskElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                taskElement.style.border = '3px solid #ff6b6b';
                setTimeout(() => {
                    taskElement.style.border = '1px solid rgba(218, 165, 32, 0.2)';
                }, 3000);
            }
        }

        function openTaskModal(taskId = null) {
            currentTask = taskId ? tasks.find(t => t.id === taskId) : null;
            currentSubtasks = currentTask ? [...currentTask.subtasks] : [];
            
            if (currentTask) {
                document.getElementById('taskModalTitle').textContent = 'Edit Task';
                document.getElementById('taskTitle').value = currentTask.title;
                document.getElementById('taskDescription').value = currentTask.description;
                document.getElementById('taskPriority').value = currentTask.priority;
                document.getElementById('taskDeadline').value = currentTask.deadline;
                document.getElementById('reminderTime').value = currentTask.reminder.time;
                document.getElementById('reminderRecurring').value = currentTask.reminder.recurring;
                
                // Set tags
                const tagsContainer = document.getElementById('taskTags');
                tagsContainer.innerHTML = currentTask.tags.map(tag => 
                    `<span class="tag">${tag} <span class="tag-remove" onclick="removeTag('${tag}')">×</span></span>`
                ).join('') + '<input type="text" id="taskTagInput" placeholder="Add tags (press Enter)..." style="border: none; background: transparent; color: white; outline: none; flex: 1;">';
                
                setupTagInput();
            } else {
                document.getElementById('taskModalTitle').textContent = 'Create New Task';
                clearTaskForm();
            }
            
            renderSubtaskPreview();
            document.getElementById('taskModal').style.display = 'block';
            document.getElementById('taskTitle').focus();
        }

        function saveTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const priority = document.getElementById('taskPriority').value;
            const deadline = document.getElementById('taskDeadline').value;
            const reminderTime = document.getElementById('reminderTime').value;
            const reminderRecurring = document.getElementById('reminderRecurring').value;
            
            if (!title) {
                showNotification('Please enter a task title', 'error');
                return;
            }
            
            // Get tags
            const tags = Array.from(document.querySelectorAll('#taskTags .tag')).map(tag => 
                tag.textContent.replace('×', '').trim()
            );
            
            const taskData = {
                title,
                description,
                priority,
                deadline,
                tags,
                subtasks: currentSubtasks,
                reminder: { time: reminderTime, recurring: reminderRecurring }
            };
            
            if (currentTask) {
                // Update existing task
                Object.assign(currentTask, taskData);
                showNotification('Task updated successfully! 📝');
            } else {
                // Create new task
                const newTask = {
                    id: Date.now(),
                    ...taskData,
                    completed: false,
                    createdAt: new Date()
                };
                tasks.unshift(newTask);
                showNotification('Task created! Break it down into micro-steps for success. 🎯');
            }
            
            closeTaskModal();
            updateStats();
            renderTasks();
            saveData();
        }

        function clearTaskForm() {
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskPriority').value = 'medium';
            document.getElementById('taskDeadline').value = '';
            document.getElementById('reminderTime').value = '';
            document.getElementById('reminderRecurring').value = 'none';
            document.getElementById('taskTags').innerHTML = '<input type="text" id="taskTagInput" placeholder="Add tags (press Enter)..." style="border: none; background: transparent; color: white; outline: none; flex: 1;">';
            currentSubtasks = [];
            renderSubtaskPreview();
            setupTagInput();
        }

        function closeTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
            currentTask = null;
            currentSubtasks = [];
        }

        function renderTasks() {
            const container = document.getElementById('tasksList');
            const searchTerm = document.getElementById('taskSearch').value.toLowerCase();
            
            let filteredTasks = tasks.filter(task => 
                task.title.toLowerCase().includes(searchTerm) ||
                task.description.toLowerCase().includes(searchTerm) ||
                task.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                task.priority.toLowerCase().includes(searchTerm)
            );
            
            if (filteredTasks.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #e0e0e0;">
                        <span style="font-size: 3rem; display: block; margin-bottom: 15px;">🎯</span>
                        <h3>No tasks found</h3>
                        <p>Add your first task to start finishing strong!</p>
                    </div>
                `;
                return;
            }
            
            // Sort tasks: incomplete first, then by priority, then by deadline
            filteredTasks.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed - b.completed;
                
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                }
                
                if (a.deadline && b.deadline) {
                    return new Date(a.deadline) - new Date(b.deadline);
                }
                
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            container.innerHTML = filteredTasks.map(task => createTaskCard(task)).join('');
        }

        function createTaskCard(task) {
            const completedSubtasks = task.subtasks.filter(st => st.completed).length;
            const totalSubtasks = task.subtasks.length;
            const progress = totalSubtasks > 0 ? Math.round((completedSubtasks / totalSubtasks) * 100) : 0;
            
            const isOverdue = task.deadline && new Date(task.deadline) < new Date() && !task.completed;
            const isUrgent = task.deadline && (new Date(task.deadline) - new Date()) < (24 * 60 * 60 * 1000) && !task.completed;
            
            return `
                <div class="task-card ${task.priority}-priority ${task.completed ? 'completed' : ''}" data-task-id="${task.id}">
                    <div class="task-header">
                        <div>
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                <span>🏷️ ${task.priority.toUpperCase()}</span>
                                ${task.deadline ? `<span>📅 ${new Date(task.deadline).toLocaleDateString()}</span>` : ''}
                                ${isOverdue ? '<span style="color: #ff6b6b;">⚠️ OVERDUE</span>' : ''}
                                ${isUrgent ? '<span style="color: #ffa726;">⏰ URGENT</span>' : ''}
                                <span>📊 ${completedSubtasks}/${totalSubtasks} steps</span>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            ${task.completed ? '<span style="color: #66bb6a; font-size: 1.5rem;">✅</span>' : ''}
                        </div>
                    </div>
                    
                    ${task.description ? `<div style="color: #e0e0e0; margin: 10px 0; line-height: 1.4;">${task.description}</div>` : ''}
                    
                    ${task.tags.length > 0 ? `
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin: 10px 0;">
                            ${task.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    
                    ${totalSubtasks > 0 ? `
                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="color: #ffd700; font-weight: bold;">🔄 Micro-Steps Progress</span>
                                <span style="color: #e0e0e0;">${progress}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="subtask-list">
                                ${task.subtasks.slice(0, 3).map(subtask => `
                                    <div class="subtask-item ${subtask.completed ? 'completed' : ''}" onclick="toggleSubtask(${task.id}, ${subtask.id})">
                                        <div class="checkbox ${subtask.completed ? 'checked' : ''}">
                                            ${subtask.completed ? '✓' : ''}
                                        </div>
                                        <span>${subtask.text}</span>
                                        <div class="swipe-complete">✓ Done</div>
                                    </div>
                                `).join('')}
                                ${task.subtasks.length > 3 ? `<div style="color: #e0e0e0; font-size: 0.9rem; margin-top: 8px;">+${task.subtasks.length - 3} more steps</div>` : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="task-actions">
                        <button class="task-btn" onclick="openTaskModal(${task.id})">✏️ Edit</button>
                        ${!task.completed ? `
                            <button class="task-btn complete-btn" onclick="completeTask(${task.id})">✅ Complete</button>
                            <button class="task-btn" onclick="startTaskFocus(${task.id})">🍅 Focus</button>
                        ` : `
                            <button class="task-btn" onclick="uncompleteTask(${task.id})">↩️ Reopen</button>
                        `}
                        <button class="task-btn delete-btn" onclick="deleteTask(${task.id})">🗑️ Delete</button>
                    </div>
                </div>
            `;
        }

        function toggleSubtask(taskId, subtaskId) {
            const task = tasks.find(t => t.id === taskId);
            const subtask = task.subtasks.find(st => st.id === subtaskId);
            
            subtask.completed = !subtask.completed;
            
            // Add swipe animation
            const subtaskElement = event.currentTarget;
            if (subtask.completed) {
                subtaskElement.classList.add('swiping');
                setTimeout(() => {
                    subtaskElement.classList.remove('swiping');
                    renderTasks();
                    updateStats();
                    saveData();
                    showNotification('Micro-step completed! 🎯');
                }, 300);
            } else {
                renderTasks();
                updateStats();
                saveData();
            }
        }

        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            task.completed = true;
            
            // Mark all subtasks as completed
            task.subtasks.forEach(subtask => subtask.completed = true);
            
            // Add completion animation
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            if (taskElement) {
                taskElement.classList.add('task-complete-animation');
            }
            
            completedToday++;
            updateStreak();
            updateStats();
            renderTasks();
            saveData();
            showNotification('🎉 Task completed! You\'re a finisher! Keep the momentum going!');
        }

        function uncompleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            task.completed = false;
            
            renderTasks();
            updateStats();
            saveData();
            showNotification('Task reopened for further work 📝');
        }

        function deleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (confirm(`Are you sure you want to delete "${task.title}"?`)) {
                tasks = tasks.filter(t => t.id !== taskId);
                renderTasks();
                updateStats();
                saveData();
                showNotification('Task deleted 🗑️');
            }
        }

        function startTaskFocus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            showNotification(`🍅 Starting 25-minute focus session for: "${task.title}"`);
            startTimer();
        }

        function filterTasks() {
            renderTasks();
        }

        // Subtask management
        function addSubtask() {
            const input = document.getElementById('subtaskInput');
            const text = input.value.trim();
            
            if (!text) {
                showNotification('Please enter a micro-step', 'error');
                return;
            }
            
            const subtask = {
                id: Date.now(),
                text: text,
                completed: false
            };
            
            currentSubtasks.push(subtask);
            input.value = '';
            renderSubtaskPreview();
            showNotification('Micro-step added! 📋');
        }

        function renderSubtaskPreview() {
            const container = document.getElementById('subtaskPreview');
            container.innerHTML = currentSubtasks.map((subtask, index) => `
                <div class="subtask-item">
                    <div class="checkbox">✓</div>
                    <span>${subtask.text}</span>
                    <button class="task-btn delete-btn" onclick="removeSubtask(${index})" style="padding: 4px 8px; margin-left: auto;">×</button>
                </div>
            `).join('');
        }

        function removeSubtask(index) {
            currentSubtasks.splice(index, 1);
            renderSubtaskPreview();
        }

        // Tag management
        function setupTagInput() {
            const tagInput = document.getElementById('taskTagInput');
            if (tagInput) {
                tagInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addTag();
                    }
                });
            }
        }

        function focusTagInput() {
            document.getElementById('taskTagInput').focus();
        }

        function addTag() {
            const input = document.getElementById('taskTagInput');
            const tag = input.value.trim();
            
            if (!tag) return;
            
            // Check if tag already exists
            const existingTags = Array.from(document.querySelectorAll('#taskTags .tag')).map(t => 
                t.textContent.replace('×', '').trim()
            );
            
            if (existingTags.includes(tag)) {
                showNotification('Tag already exists', 'error');
                return;
            }
            
            // Add tag to container
            const tagsContainer = document.getElementById('taskTags');
            const tagElement = document.createElement('span');
            tagElement.className = 'tag';
            tagElement.innerHTML = `${tag} <span class="tag-remove" onclick="removeTag('${tag}')">×</span>`;
            
            tagsContainer.insertBefore(tagElement, input);
            input.value = '';
        }

        function removeTag(tagText) {
            const tagElements = document.querySelectorAll('#taskTags .tag');
            tagElements.forEach(tag => {
                if (tag.textContent.replace('×', '').trim() === tagText) {
                    tag.remove();
                }
            });
        }

        // Pomodoro Timer
        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                document.getElementById('startBtn').textContent = 'Running...';
                document.getElementById('startBtn').classList.add('active');
                
                timerInterval = setInterval(() => {
                    timerSeconds--;
                    updateTimerDisplay();
                    
                    if (timerSeconds <= 0) {
                        completeTimer();
                    }
                }, 1000);
                
                showNotification('🍅 Focus session started! Time to finish strong!');
            }
        }

        function pauseTimer() {
            if (isTimerRunning) {
                isTimerRunning = false;
                clearInterval(timerInterval);
                document.getElementById('startBtn').textContent = 'Resume';
                document.getElementById('startBtn').classList.remove('active');
                showNotification('Timer paused ⏸️');
            }
        }

        function resetTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            timerSeconds = 1500; // 25 minutes
            updateTimerDisplay();
            document.getElementById('startBtn').textContent = 'Start';
            document.getElementById('startBtn').classList.remove('active');
            showNotification('Timer reset 🔄');
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function completeTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            totalFocusTime += 25;
            
            resetTimer();
            showNotification('🎉 Focus session complete! You\'re building the habit of finishing! 🔥');
            updateStats();
            saveData();
        }

        // Voice input
        function startVoiceInput(targetId) {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showNotification('Voice input not supported in this browser', 'error');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            const voiceBtn = event.target;
            voiceBtn.classList.add('recording');
            voiceBtn.textContent = '🔴';

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById(targetId).value = transcript;
                voiceBtn.classList.remove('recording');
                voiceBtn.textContent = '🎤';
                showNotification('Voice input captured! 🎤');
            };

            recognition.onerror = function(event) {
                voiceBtn.classList.remove('recording');
                voiceBtn.textContent = '🎤';
                showNotification('Voice recognition error: ' + event.error, 'error');
            };

            recognition.onend = function() {
                voiceBtn.classList.remove('recording');
                voiceBtn.textContent = '🎤';
            };

            recognition.start();
        }

        // Daily prompts
        function generateDailyPrompts() {
            const container = document.getElementById('dailyPrompts');
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('dailyPromptsDate');
            
            if (savedDate !== today) {
                // Generate new prompts for today
                const shuffled = [...actionPrompts].sort(() => 0.5 - Math.random());
                const todayPrompts = shuffled.slice(0, 3);
                
                localStorage.setItem('dailyPrompts', JSON.stringify(todayPrompts));
                localStorage.setItem('dailyPromptsDate', today);
            }
            
            const prompts = JSON.parse(localStorage.getItem('dailyPrompts') || '[]');
            
            container.innerHTML = prompts.map((prompt, index) => `
                <div class="prompt-item">
                    <span class="prompt-text">${prompt}</span>
                    <button class="prompt-action" onclick="completePrompt(${index})">Done</button>
                </div>
            `).join('');
        }

        function completePrompt(index) {
            const prompts = JSON.parse(localStorage.getItem('dailyPrompts') || '[]');
            prompts.splice(index, 1);
            localStorage.setItem('dailyPrompts', JSON.stringify(prompts));
            
            generateDailyPrompts();
            showNotification('Action prompt completed! 🎯');
            updateStreak();
        }

        // Motivational messages
        function updateMotivationalMessage() {
            const customMessage = localStorage.getItem('customMotivationalMessage');
            const messageElement = document.getElementById('motivationalMessage');
            
            if (customMessage) {
                messageElement.textContent = customMessage;
            } else {
                const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
                messageElement.textContent = randomMessage;
            }
        }

        function openMessageBuilder() {
            const currentMessage = document.getElementById('motivationalMessage').textContent;
            document.getElementById('customMessage').value = currentMessage;
            
            // Populate templates
            const templatesContainer = document.getElementById('messageTemplates');
            templatesContainer.innerHTML = messageTemplates.map(template => `
                <div style="padding: 8px; background: rgba(45, 90, 61, 0.4); border-radius: 8px; margin-bottom: 8px; cursor: pointer;" onclick="useTemplate('${template}')">
                    "${template}"
                </div>
            `).join('');
            
            document.getElementById('messageModal').style.display = 'block';
        }

        function useTemplate(template) {
            document.getElementById('customMessage').value = template;
        }

        function saveCustomMessage() {
            const message = document.getElementById('customMessage').value.trim();
            if (message) {
                localStorage.setItem('customMotivationalMessage', message);
                document.getElementById('motivationalMessage').textContent = message;
                closeMessageModal();
                showNotification('Custom message saved! 💪');
            }
        }

        function generateRandomMessage() {
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            document.getElementById('customMessage').value = randomMessage;
        }

        function closeMessageModal() {
            document.getElementById('messageModal').style.display = 'none';
        }

        // Statistics and streaks
        function updateStats() {
            const activeTasks = tasks.filter(t => !t.completed).length;
            const todayCompleted = calculateTodayCompleted();
            const focusHours = Math.round(totalFocusTime / 60);
            
            document.getElementById('totalTasks').textContent = activeTasks;
            document.getElementById('completedToday').textContent = todayCompleted;
            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('focusTime').textContent = focusHours + 'h';
            
            // Update streak display
            document.getElementById('streakNumber').textContent = currentStreak;
            const streakProgress = Math.min((currentStreak % 7) / 7 * 100, 100);
            document.getElementById('streakProgress').style.width = streakProgress + '%';
        }

        function calculateTodayCompleted() {
            const today = new Date().toDateString();
            return tasks.filter(task => 
                task.completed && new Date(task.createdAt).toDateString() === today
            ).length;
        }

        function updateStreak() {
            const today = new Date().toDateString();
            const lastActive = localStorage.getItem('lastActiveDate');
            
            if (lastActive === today) {
                // Already active today, no change to streak
                return;
            }
            
            const todayCompleted = calculateTodayCompleted();
            const todayPrompts = JSON.parse(localStorage.getItem('dailyPrompts') || '[]');
            const hasActivity = todayCompleted > 0 || todayPrompts.length < 3;
            
            if (hasActivity) {
                if (lastActive) {
                    const lastDate = new Date(lastActive);
                    const todayDate = new Date(today);
                    const diffTime = todayDate - lastDate;
                    const diffDays = diffTime / (1000 * 60 * 60 * 24);
                    
                    if (diffDays === 1) {
                        // Consecutive day
                        currentStreak++;
                    } else if (diffDays > 1) {
                        // Streak broken
                        currentStreak = 1;
                    }
                } else {
                    // First time
                    currentStreak = 1;
                }
                
                localStorage.setItem('lastActiveDate', today);
                localStorage.setItem('currentStreak', currentStreak.toString());
                updateStats();
            }
        }

        // Reminders
        function checkReminders() {
            const now = new Date();
            
            tasks.forEach(task => {
                if (task.completed || !task.reminder.time) return;
                
                const reminderTime = new Date(task.reminder.time);
                const timeDiff = Math.abs(now - reminderTime);
                
                // Show reminder if within 1 minute
                if (timeDiff < 60000) {
                    showNotification(`⏰ Reminder: "${task.title}"`, 'reminder');
                    
                    // Set next reminder if recurring
                    if (task.reminder.recurring !== 'none') {
                        const nextReminder = new Date(reminderTime);
                        switch (task.reminder.recurring) {
                            case 'daily':
                                nextReminder.setDate(nextReminder.getDate() + 1);
                                break;
                            case 'weekly':
                                nextReminder.setDate(nextReminder.getDate() + 7);
                                break;
                            case 'monthly':
                                nextReminder.setMonth(nextReminder.getMonth() + 1);
                                break;
                        }
                        task.reminder.time = nextReminder.toISOString().slice(0, 16);
                        saveData();
                    }
                }
            });
        }

        // Data management
        function saveData() {
            const data = {
                tasks: tasks,
                totalFocusTime: totalFocusTime,
                currentStreak: currentStreak,
                completedToday: completedToday
            };
            localStorage.setItem('finisherPro_data', JSON.stringify(data));
        }

        function loadData() {
            const savedData = localStorage.getItem('finisherPro_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                tasks = data.tasks || [];
                totalFocusTime = data.totalFocusTime || 0;
                currentStreak = data.currentStreak || 0;
                completedToday = data.completedToday || 0;
            }
        }

        function exportToPDF() {
            const activeTasks = tasks.filter(t => !t.completed);
            const completedTasks = tasks.filter(t => t.completed);
            
            const content = `
FINISHER PRO - TASK COMPLETION REPORT
Generated: ${new Date().toLocaleDateString()}

SUMMARY
=======
Active Tasks: ${activeTasks.length}
Completed Today: ${completedToday}
Current Streak: ${currentStreak} days
Total Focus Time: ${Math.round(totalFocusTime / 60)} hours

ACTIVE TASKS
============
${activeTasks.map(task => `
📋 ${task.title}
   Priority: ${task.priority.toUpperCase()}
   ${task.deadline ? `Deadline: ${new Date(task.deadline).toLocaleDateString()}` : 'No deadline'}
   ${task.description ? `Description: ${task.description}` : ''}
   
   Micro-Steps (${task.subtasks.filter(st => st.completed).length}/${task.subtasks.length} completed):
   ${task.subtasks.map(st => `   ${st.completed ? '✅' : '☐'} ${st.text}`).join('\n   ')}
   
   Tags: ${task.tags.join(', ') || 'None'}
`).join('\n')}

COMPLETED TASKS
===============
${completedTasks.slice(0, 10).map(task => `✅ ${task.title} - Completed: ${new Date(task.createdAt).toLocaleDateString()}`).join('\n')}
${completedTasks.length > 10 ? `\n... and ${completedTasks.length - 10} more completed tasks` : ''}
            `.trim();
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `finisher-pro-report-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Report exported! 📄');
        }

        function backupData() {
            const data = {
                tasks: tasks,
                totalFocusTime: totalFocusTime,
                currentStreak: currentStreak,
                completedToday: completedToday,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `finisher-pro-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Data backed up! 💾');
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all current data. Continue?')) {
                        tasks = data.tasks || [];
                        totalFocusTime = data.totalFocusTime || 0;
                        currentStreak = data.currentStreak || 0;
                        completedToday = data.completedToday || 0;
                        
                        renderTasks();
                        updateStats();
                        saveData();
                        showNotification('Data imported successfully! 📥');
                    }
                } catch (error) {
                    showNotification('Invalid backup file', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Offline functionality
        function checkOnlineStatus() {
            const indicator = document.getElementById('offlineIndicator');
            if (navigator.onLine) {
                indicator.textContent = '📡 Online';
                indicator.classList.add('online');
                indicator.style.display = 'block';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 2000);
            } else {
                indicator.textContent = '📡 Offline Mode';
                indicator.classList.remove('online');
                indicator.style.display = 'block';
            }
        }

        // Notifications
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === 'error') {
                notification.style.background = 'rgba(255, 107, 107, 0.95)';
            } else if (type === 'urgent') {
                notification.style.background = 'rgba(255, 107, 107, 0.95)';
                notification.style.color = 'white';
                notification.style.fontWeight = 'bold';
            } else if (type === 'reminder') {
                notification.style.background = 'rgba(255, 167, 38, 0.95)';
                notification.style.color = 'white';
            } else {
                notification.style.background = 'rgba(102, 187, 106, 0.95)';
                notification.style.color = 'white';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, type === 'urgent' ? 6000 : 4000);
        }

        // Modal close functionality
        window.onclick = function(event) {
            const taskModal = document.getElementById('taskModal');
            const messageModal = document.getElementById('messageModal');
            
            if (event.target === taskModal) {
                closeTaskModal();
            }
            if (event.target === messageModal) {
                closeMessageModal();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'n':
                        e.preventDefault();
                        openTaskModal();
                        break;
                    case 's':
                        e.preventDefault();
                        saveData();
                        showNotification('Data saved manually');
                        break;
                    case 'e':
                        e.preventDefault();
                        exportToPDF();
                        break;
                    case 'b':
                        e.preventDefault();
                        backupData();
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                closeTaskModal();
                closeMessageModal();
            }
        });

        // Add export and backup buttons to the interface
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.header');
            const exportButtons = document.createElement('div');
            exportButtons.style.marginTop = '15px';
            exportButtons.innerHTML = `
                <button class="action-btn" onclick="exportToPDF()" style="margin: 0 5px;">📄 Export Report</button>
                <button class="action-btn" onclick="backupData()" style="margin: 0 5px;">💾 Backup Data</button>
                <button class="action-btn" onclick="importData()" style="margin: 0 5px;">📥 Import Data</button>
            `;
            header.appendChild(exportButtons);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9871b4634666bc4b',t:'MTc1OTIxNDE3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
